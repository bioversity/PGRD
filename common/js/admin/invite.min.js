$.generate_invite_form=function(){$.fn.check_valid_email=function(){var e=$(this),s=e.closest(".form-group"),a=s.find("p.checker"),r=a.find("span.fa"),t=e.val(),l=/^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/;$.trim(t).length>5?(r.addClass("fa-refresh fa-spin text-muted"),s.removeClass("has-error"),a.removeClass("hidden"),l.test(t)?(r.removeClass("fa-times text-danger"),r.removeClass("fa-refresh fa-spin text-muted").addClass("fa-check text-success"),s.addClass("has-success"),$("#invite_btn").removeClass("disabled")):(r.removeClass("fa-refresh fa-spin text-muted").addClass("fa-times text-danger"),s.addClass("has-error"),$("#invite_btn").addClass("disabled"))):(r.removeClass("fa-refresh fa-spin text-muted").addClass("fa-times text-danger"),s.addClass("has-error"),$("#invite_btn").addClass("disabled"))},$.fn.check_empty=function(){var e=$(this),s=e.closest(".form-group"),a=s.find("p.checker"),r=a.find("span.fa"),t=e.val();r.addClass("fa-refresh fa-spin text-muted"),s.removeClass("has-error"),a.removeClass("hidden"),$.trim(t).length>0?(r.removeClass("fa-times text-danger"),r.removeClass("fa-refresh fa-spin text-muted").addClass("fa-check text-success"),s.addClass("has-success")):(r.removeClass("fa-refresh fa-spin text-muted").addClass("fa-times text-danger"),s.addClass("has-error")),$.check_all_empty()},$.check_all_empty=function(){var e=/^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,s=[];$.each($("#user_personal_data input"),function(){s.push($.trim($(this).val()).length>0?"new_user_mail_address"==$(this).attr("id")?$.trim($(this).val()).length>5&&e.test($(this).val())?!1:!0:!1:!0)}),-1!==$.inArray(!0,s)?$("#invite_btn").addClass("disabled"):$("#invite_btn").removeClass("disabled")};var e=$($("#invite_user").length>0?"#invite_user":'<div id="invite_user">'),s=$('<div class="row">'),a=$('<div class="col-xs-12 col-sm-5 col-lg-5 col-sm-offset-1 col-lg-offset-2">'),r=$("<a>").attr({href:"javascript:void(0);",id:"invite_btn",onclick:"$.invite_user();","class":"btn btn-default pull-right disabled"}).html(i18n[lang].interface.btns.invite+' <span class="fa fa-angle-right"></span>'),t=$('<div id="invite_container">').addClass("col-xs-12 col-sm-5 col-lg-5 col-sm-offset-1 col-lg-offset-2 well form"),l=$('<fieldset id="user_personal_data">'),i=$("<legend>").text("User personal data"),n=[{text:i18n[lang].interface.forms.full_name,"iput-type":"text",id:"new_user_full_name",placeholder:i18n[lang].interface.forms.full_name,check:"empty",separated:!1},{text:i18n[lang].interface.forms.work_title,"iput-type":"text",id:"new_user_work_title",placeholder:i18n[lang].interface.forms.work_title,check:"empty",separated:!1},{text:i18n[lang].interface.forms.email_address,"iput-type":"email",id:"new_user_mail_address",placeholder:i18n[lang].interface.forms.email_address,check:"email",separated:!0}];l.append(i),$.each(n,function(e,s){var a=$('<div class="form-group">'),r=$('<div class="row">'),t=$("<label>").addClass("control-label col-sm-3 control-label col-xs-12").attr("for",s.id).text(s.text),i=$('<div class="col-sm-9 col-xs-12 row">'),n=$('<div class="col-xs-1">'),o=$('<p class="checker form-control-static hidden">'),d=$('<span class="fa fa-refresh fa-spin text-muted fa-1_5x">'),_=$("<input>").attr({type:s["iput-type"],name:s.id,id:s.id,placeholder:s.placeholder,value:""}).addClass("form-control");""!==s.check&&_.on("keyup blur",function(){"email"==s.check?$(this).check_valid_email():$(this).check_empty()}),o.append(d),n.append(o),""!==s.check&&i.removeClass("col-sm-9 col-xs-12").addClass("col-sm-8 col-xs-11"),i.append(_),r.append(t),r.append(i),""!==s.check&&r.append(n),a.append(r),s.separated&&l.append("<br />"),l.append(a)}),t.append(l),t.roles_manager_box(),a.append(r),s.append(t),s.append(a),e.html(s),$.activate_roles_manager_box(),$("#loader").hide()},$.invite_user=function(e){if(""===$.trim($("#new_user_full_name").val()))$("#new_user_full_name").closest(".form-group").addClass("has-error"),$("#new_user_full_name").focus();else if(""===$.trim($("#new_user_work_title").val()))$("#new_user_full_name").closest(".form-group").removeClass("has-error"),$("#new_user_work_title").closest(".form-group").addClass("has-error"),$("#new_user_work_title").focus();else if(""===$.trim($("#new_user_mail_address").val()))$("#new_user_full_name").closest(".form-group").removeClass("has-error"),$("#new_user_work_title").closest(".form-group").removeClass("has-error"),$("#new_user_mail_address").closest(".form-group").addClass("has-error"),$("#new_user_mail_address").focus();else{$("#new_user_full_name").closest(".form-group").removeClass("has-error"),$("#new_user_work_title").closest(".form-group").removeClass("has-error"),$("#new_user_mail_address").closest(".form-group").removeClass("has-error");var s={};s[kAPI_REQUEST_USER]=null===e||void 0===e||""===e?$.get_manager_id():e,s[kTAG_NAME]=$.trim($("#new_user_full_name").val()),s[kTAG_AUTHORITY]="ITA046",s[kTAG_COLLECTION]="pgrdiversity.bioversityinternational.org",s[kTAG_ENTITY_TITLE]=$.trim($("#new_user_work_title").val()),s[kTAG_ENTITY_EMAIL]=$.trim($("#new_user_mail_address").val()),s[kTAG_ROLES]=[],$("#role-invite").is(":checked")?s[kTAG_ROLES].push(kTYPE_ROLE_INVITE):$.array_remove(s[kTAG_ROLES],kTYPE_ROLE_INVITE),$("#role-upload").is(":checked")?s[kTAG_ROLES].push(kTYPE_ROLE_UPLOAD):$.array_remove(s[kTAG_ROLES],kTYPE_ROLE_UPLOAD),$("#role-edit").is(":checked")?s[kTAG_ROLES].push(kTYPE_ROLE_EDIT):$.array_remove(s[kTAG_ROLES],kTYPE_ROLE_EDIT),$("#manage-users").is(":checked")?s[kTAG_ROLES].push(kTYPE_ROLE_USERS):$.array_remove(s[kTAG_ROLES],kTYPE_ROLE_USERS),s[kTAG_ROLES].push(kTYPE_ROLE_LOGIN),$.require_password(function(){$("#loader").show(),$.ask_cyphered_to_service({storage_group:"pgrdg_user_cache.user_data.invitations",data:s,dataType:"text",timeout:15e3,type:"invite_user"},function(e){return $("#loader").hide(),"The user already exists"==e?(apprise(i18n[lang].messages.the_user_already_exists.message,{title:i18n[lang].messages.the_user_already_exists.title,titleClass:"text-danger",icon:"fa-times"},function(){$("#new_user_mail_address").focus()}),!1):void 0}),$.log_activity("Invited the user "+$("#new_user_full_name").val()),apprise(i18n[lang].messages.user_invited.message.replace("{X}",$("#new_user_full_name").val()),{title:i18n[lang].messages.user_invited.title,icon:"success"},function(e){e&&document.location.reload()})})}},$.delete_invitation=function(e){apprise(i18n[lang].messages.delete_invitation.message,{title:i18n[lang].messages.delete_invitation.title,icon:"warning",confirm:!0,yesBtn:"Yes",noBtn:"No"},function(s){s&&$.log_activity("Delete invitation for user "+e)})};