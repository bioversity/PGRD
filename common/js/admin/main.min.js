$.require_password=function(e){var a=storage.get("pgrdg_user_cache.user_data.current");$.each(a,function(a,t){t[kTAG_CONN_CODE][kAPI_PARAM_RESPONSE_FRMT_DISP];apprise(i18n[lang].messages.insert_password.message,{title:i18n[lang].messages.insert_password.title,icon:"fa-lock",titleClass:"text-warning",input:!0,input_type:"password"},function(a){return a?void("function"==typeof e&&e.call($.sha1(a))):!1})})},$.add_storage_space_in_panel=function(e,a){$.get_localstorage_space=function(e){var a="";for(var t in window.localStorage)window.localStorage.hasOwnProperty(t)&&(a+=window.localStorage[e]);return a?3+Math.round(16*a.length/8192*100)/100+" Kb":"0 Kb"};var t=$.get_localstorage_space(a),s=parseInt($.get_localstorage_space(a)),_=100*s/1e3,n="progress-bar-success",i="txt-color-darken";_>33?(n="progress-bar-warning",i="text-warning"):_>66&&(n="progress-bar-danger",i="text-danger");var r=$("<li>"),l=$('<div class="padding-5">'),o=$('<p class="'+i+' font-sm no-margin">'),d=$('<div class="progress progress-micro no-margin">'),c=$('<div class="progress-bar '+n+'" style="width: '+_+'%">');o.html("<b>"+e+":</b><br /><small>"+t+"</small>"),d.append(c),l.append(o).append(d),r.append(l),$("#local_storage_space").append(r)},$.get_user=function(e,a,t){$.ask_user=function(e,a,t){$.ask_cyphered_to_service({storage_group:"pgrdg_user_cache.user_data.all",data:{user_id:null===e||void 0===e||""===e?$.get_manager_id():e,manager_id:$.get_manager_id()},type:"get_user",force_renew:a},function(a){"function"==typeof t&&$.each(a,function(a,s){storage.set("pgrdg_user_cache.user_data.all."+$.get_user_id(s),s),e==$.get_manager_id()&&(storage.set("pgrdg_user_cache.user_data.current."+$.get_user_id(s),s),storage.set("pgrdg_user_cache.user_data.current.id",$.get_user_id(s))),t.call(this,s)})})},$("#loader").show(),(void 0===a||null===a||""===a)&&(a=!1),a?$.ask_user(e,!0,t):$.storage_exists("pgrdg_user_cache.user_data.all."+e)?t.call(this,storage.get("pgrdg_user_cache.user_data.all."+e)):$.storage_exists("pgrdg_user_cache.user_data.current")?$.ask_user(e,!1,t):($.cookie("l",null,{path:"/"}),document.location="./Signin")},$.get_managed_users=function(e,a){$.storage_exists("pgrdg_user_cache.user_data.managed."+e)?a.call(this,storage.get("pgrdg_user_cache.user_data.managed."+e)):$.ask_cyphered_to_service({storage_group:"pgrdg_user_cache.user_data.managed",data:{user_id:null===e||void 0===e||""===e?$.get_manager_id():e,manager_id:$.get_manager_id()},type:"get_managed_users"},function(e){if("function"==typeof a){var t={};$.each(e,function(e,a){$.storage_exists("pgrdg_user_cache.user_data.all."+$.get_user_id(a))&&storage.set("pgrdg_user_cache.user_data.all."+$.get_user_id(a),a),t[$.get_user_id(a)]=a}),a.call(this,t)}$("#loader").hide()})},$.fn.getAttributes=function(){var e=this,a={};return e&&e.length&&$.each(e.get(0).attributes,function(t,s){s=s.nodeName||s.name,t=e.attr(s),void 0!==t&&t!==!1&&(a[s]=t)}),a},$.fn.check_input=function(e){$.fn.isWrong=function(){$(this).closest("div.line").addClass("has-error"),$(this).focus()},$.fn.isRight=function(){$(this).closest("div.line").removeClass("has-error")},$input=$(this),$input.prop("required")&&""===$.trim($input.val())?($input.isWrong(),"function"==jQuery.type(e)&&e.call(this,$input,!1)):($input.isRight(),"function"==jQuery.type(e)&&e.call(this,$input,!0))},$.get_current_user_data=function(){var e={};return $.each(storage.get("pgrdg_user_cache.user_data.current"),function(a,t){e=t}),e},$.get_user_id=function(e){return e[kTAG_IDENTIFIER][kAPI_PARAM_RESPONSE_FRMT_DISP]},$.get_current_user_id=function(){var e="",a=0;return $.storage_exists("pgrdg_user_cache.user_data.current.id")?e=storage.get("pgrdg_user_cache.user_data.current.id"):$.each(storage.get("pgrdg_user_cache.user_data.current"),function(t,s){0==a&&(e=$.get_user_id(s),storage.set("pgrdg_user_cache.user_data.current.id",e)),a++}),e},$.get_manager_id=function(){var e="";return $.each(storage.get("pgrdg_user_cache.user_data.current"),function(a,t){e=$.get_user_id(t)}),e},$.get_user_database=function(e){return e[kTAG_CONN_BASE][kAPI_PARAM_RESPONSE_FRMT_DISP]},$.get_user_authority=function(e){return e[kTAG_AUTHORITY][kAPI_PARAM_RESPONSE_FRMT_DISP]},$.get_user_full_name=function(e){return e[kTAG_NAME][kAPI_PARAM_RESPONSE_FRMT_DISP]},$.get_user_username=function(e){return e[kTAG_CONN_CODE][kAPI_PARAM_RESPONSE_FRMT_DISP]},$.get_user_name=function(e){return e[kTAG_ENTITY_FNAME][kAPI_PARAM_RESPONSE_FRMT_DISP]},$.get_user_last_name=function(e){return e[kTAG_ENTITY_LNAME][kAPI_PARAM_RESPONSE_FRMT_DISP]},$.get_user_pgp_fingerprint=function(e){return e[kTAG_ENTITY_PGP_FINGERPRINT][kAPI_PARAM_RESPONSE_FRMT_DISP]},$.fn.get_user_work_position=function(e,a){var t=$(this);sha=void 0===a?!0:a,$.get_authority(e[kTAG_ENTITY_AFFILIATION][kAPI_PARAM_RESPONSE_FRMT_VALUE][0][kTAG_UNIT_REF],function(a){var s=e[kTAG_ENTITY_TITLE][kAPI_PARAM_RESPONSE_FRMT_DISP];sha&&(s+=" at "+a),t.html(s)})},$.get_user_email=function(e){return e[kTAG_ENTITY_EMAIL][kAPI_PARAM_RESPONSE_FRMT_DISP][0][kAPI_PARAM_RESPONSE_FRMT_DISP]},$.get_user_img_src=function(e){return"./common/media/img/admin/"+(void 0===e[kTAG_ENTITY_ICON][kAPI_PARAM_RESPONSE_FRMT_NAME]?"user_rand_images/":"user_images/")+e[kTAG_ENTITY_ICON][kAPI_PARAM_RESPONSE_FRMT_DISP]},$.get_user_roles=function(e){return e[kTAG_ROLES]},$.get_user_roles_list=function(e){var a=[];return $.each(e[kTAG_ROLES][kAPI_PARAM_RESPONSE_FRMT_DISP],function(e,t){a.push(t[kAPI_PARAM_RESPONSE_FRMT_DISP])}),a.join(", ")},$.get_managed_users_count=function(e){return parseInt(e[kTAG_MANAGED_COUNT][kAPI_PARAM_RESPONSE_FRMT_DISP])},$.get_invited_users_count=function(e){return void 0===e[kTAG_INVITES]?0:$.obj_len(e[kTAG_INVITES][kAPI_PARAM_RESPONSE_FRMT_DOCU])},$.load_profile=function(){var e=$.url().fsegment();if(e.length>0)if("Edit"===e[0])$.get_user(e[1],!1,function(){$("#personal_data").load_user_data_in_form(e[1]),$("#managed_scroller_title").length>0&&$("#managed_scroller_title").hide(),$("#managed_scroller").length>0&&$("#managed_scroller").hide(),$("#invited_box_title").length>0&&$("#invited_box_title").hide(),$("#data_box").length>0&&$("#data_box").hide()});else{var a=e[0].length>0?e[0]:"";$("#personal_data").load_user_data(a),$("#managed_scroller_title").length>0&&$("#managed_scroller_title").show(),$("#managed_scroller").length>0&&$("#managed_scroller").show(),$("#invited_box_title").length>0&&$("#invited_box_title").show(),$("#data_box").length>0&&$("#data_box").show()}else $("#personal_data").load_user_data()},$.fn.generate_manager_profile=function(e){var a=$(this),t=$('<div id="managers" class="top_content_label">'),s=$("<h1>").text(i18n[lang].messages.managed_by),_=$('<div class="manager">'),n=$("<h2>"),i=$("<a>").attr({href:"./Profile#"+$.get_user_id(e)}),r=$('<small class="help-block">').html(i18n[lang].messages.loading_profile),l=$("<img>").attr({src:$.get_user_img_src(e),alt:"me"});r.get_user_work_position(e,!1),i.append(l),i.append($.get_user_full_name(e)),i.append(r),$.get_user_id(e)==$.get_manager_id()&&i.attr("title",i18n[lang].interface.btns.back_to_your_profile),n.append(i),_.append(n),t.append(s),t.append(_),0===$("#managers").length&&a.prepend(t)},$.fn.generate_profile=function(e){$.fn.display_contact=function(e,a){var t=$(this);if(void 0!==a[e]){var s=$("<dt>"+$.ucfirst(a[e][kAPI_PARAM_RESPONSE_FRMT_NAME].replace("Entity ",""))+":</dt>"),_=$("<dd>"),n=$('<dl class="dl-horizontal">');$.each(a[e][kAPI_PARAM_RESPONSE_FRMT_DISP],function(e,a){var t=$("<dt>").text(a[kAPI_PARAM_RESPONSE_FRMT_NAME]),s=$("<dd>").html($.linkify(a[kAPI_PARAM_RESPONSE_FRMT_DISP]));n.append(t),n.append(s)}),_.append(n),t.append(s),t.append(_)}},$.fn.display_roles=function(e){var a=$(this),t=$('<dl class="dl-horizontal roles">');$.each(e[kTAG_ROLES][kAPI_PARAM_RESPONSE_FRMT_DISP],function(a,s){var _=$("<dt>"),n=$("<dd>"),i="";switch(e[kTAG_ROLES][kAPI_PARAM_RESPONSE_FRMT_VALUE][a]){case kTYPE_ROLE_LOGIN:i="fa fa-fw fa-sign-in";break;case kTYPE_ROLE_INVITE:i="fa fa-fw fa-certificate";break;case kTYPE_ROLE_UPLOAD:i="fa fa-fw fa-upload";break;case kTYPE_ROLE_EDIT:i="fa fa-fw fa-file-text-o";break;case kTYPE_ROLE_USERS:i="fa fa-fw fa-group"}_.html('<span class="'+i+' fa-3x text-success"></span>'),n.html(s[kAPI_PARAM_RESPONSE_FRMT_DISP]+'<i class="help-block">'+s[kAPI_PARAM_RESPONSE_FRMT_INFO]+"</i>"),t.append(_),t.append(n)}),a.append(t)};var a=$(this);$.storage_exists("pgrdg_user_cache.user_data.current")&&($.get_manager_id()!==$.get_user_id(e)?$.storage_exists("pgrdg_user_cache.user_data.current")&&$.each(storage.get("pgrdg_user_cache.user_data.current"),function(e,a){$("#contents").generate_manager_profile(a)}):$("#managers").remove());var t=$('<div class="row">'),s=$('<div class="col-xs-12 col-sm-3 col-md-4 col-lg-2 pull-left">'),_=$('<div class="col-xs-12 col-sm-9 col-md-8 col-lg-9 pull-right">'),n=$('<div class="col-xs-12 col-sm-12 col-md-12 col-lg-6">'),r=$('<div class="col-xs-12 col-sm-12 col-md-12 col-lg-6">'),l=$("<h1>"),o=($('<div class="col-xs-10 col-sm-7 col-sm-8 col-lg-8 pull-left">'),$('<div class="col-xs-2 col-sm-5 col-lg-4 pull-right">'),$('<span class="text-left">')),d=$("<h3>").text(i18n[lang].messages.contacts),c=$("<h3>").text(($.get_manager_id()!==$.get_user_id(e)?i18n[lang].messages.user_permissions:i18n[lang].messages.you_can)+":"),p=$('<div class="user_data">'),A=$('<div class="user_data">'),u=$("<a>").attr({"class":"btn btn-default-white pull-right",href:"./Profile#Edit/"+$.get_user_id(e),title:i18n[lang].interface.btns.edit_profile,"data-toggle":"tooltip","data-placement":"right"}).html('<span class="hidden-xs">'+i18n[lang].interface.btns.edit_profile+'&nbsp;</span><span class="fa fa-edit"></span>'),g=$("<h2>"),E=$("<span>"),f=$("<img>").attr({src:$.get_user_img_src(e),alt:"me"}),P=$('<div id="picture">'),T=$('<small class="help-block hidden-xs hidden-sm">');s.append(P);var m=[{label:"invited on",value:$.right_date(e[kTAG_VERSION][kAPI_PARAM_RESPONSE_FRMT_DISP])},{label:"Subscribed on",value:$.right_date(e[kTAG_RECORD_CREATED][kAPI_PARAM_RESPONSE_FRMT_DISP])}];for(i=0;2>i;i++){var R=$("<dl>"),k=$("<dt>"),h=$("<dd>");k.text(m[i].label),h.text(m[i].value),R.append(k),R.append(h),T.append(R)}s.append(T),E.append(f),P.append(E),t.append(s),o.text($.get_user_full_name(e)),void 0!==e[kTAG_ENTITY_TITLE]&&g.get_user_work_position(e,!0),l.append(o),l.append(u),_.append(l),_.append(g),n.append(d);var I=$("<dl>");I.display_contact(kTAG_ENTITY_PHONE,e),I.display_contact(kTAG_ENTITY_FAX,e),I.display_contact(kTAG_ENTITY_EMAIL,e),p.append(I),n.append(p),_.append(n),r.append(c),A.display_roles(e),r.append(A),_.append(r),_.append("<hr />"),t.append(_),a.addClass("container-fluid").html(t),a.load_active_users(e),$("#managed_scroller").load_invited_users(e),$("#loader").hide()},$.fn.load_user_data=function(e){var a=$(this);void 0===e||null===e||""===e?$.storage_exists("pgrdg_user_cache.user_data.current")&&(window.location.hash=$.get_manager_id(),a.generate_profile(storage.get("pgrdg_user_cache.user_data.current."+$.get_manager_id()))):$.get_user(e,!1,function(e){a.generate_profile(e)})},$.fn.load_active_users=function(e){$.empty_scroller=function(e){var a=$("<p>"),t=$("<a>").attr({href:"javascript:void(0);"}).text(i18n[lang].interface.btns.invite_an_user);return-1!==$.inArray(kTYPE_ROLE_INVITE,e[kTAG_ROLES][kAPI_PARAM_RESPONSE_FRMT_VALUE])?(a.html('<span class="fa fa-times fa-2x"></span><br />'+i18n[lang].messages.no_active_users_yet),a.append("<br />"),a.append(t)):a.html('<span class="fa fa-times fa-2x"></span><br />'+i18n[lang].messages.no_created_users),a};var a=$(this),t=$(0===$("#managed_scroller").length?'<div id="managed_scroller">':"#managed_scroller"),s=$('<small class="text-info">').text($.get_managed_users_count(e)),_=$("<sup>").append(s),n=$(0===$("#managed_scroller_title").length?'<h2 id="managed_scroller_title">':"#managed_scroller_title"),i=$.get_user_id(e);n.html(e[kTAG_MANAGED_COUNT][kAPI_PARAM_RESPONSE_FRMT_NAME]+" "),n.append(_),0===$.get_managed_users_count(e)?(t.removeClass("has_data").html($.empty_scroller(e)),i!==$.get_manager_id()&&t.find("p").html('<span class="fa fa-times fa-2x"></span><br />'+i18n[lang].messages.no_created_users)):(t.html(""),t.addClass("has_data"),$.get_managed_users($.get_user_id(e),function(e){var a=$.url().fsegment(),s=$('<ul class="managed_picture list-inline">'),_=$("<li>");$.each(e,function(e,a){var t=$("<h1>"),n=$("<a>").attr({href:"./Profile#"+$.get_user_id(a)});$span=$("<span>"),$user_img=$("<img>").attr({src:$.get_user_img_src(a),alt:$.get_user_full_name(a)}),$span.text($.get_user_full_name(a)),n.append($user_img).append($span),t.append(n),_.attr("maged-user-id",$.get_user_id(a)).append(t),s.append(_)}),t.append(s),"Edit"!==a[0]&&t.fadeIn(300)})),t.insertAfter(a),n.insertBefore(t)},$.fn.load_invited_users=function(e){$.fn.load_invited_roles_icon=function(e){var a=$(this);$.each(e[kTAG_ROLES][kAPI_PARAM_RESPONSE_FRMT_VALUE],function(e,t){var s=$('<span class="fa fa-fw text-info">&nbsp;');switch(t){case kTYPE_ROLE_LOGIN:s.addClass("fa-sign-in");break;case kTYPE_ROLE_INVITE:s.addClass("fa-certificate");break;case kTYPE_ROLE_UPLOAD:s.addClass("fa-upload");break;case kTYPE_ROLE_EDIT:s.addClass("fa-edit");break;case kTYPE_ROLE_USERS:s.addClass("fa-group")}a.append(s)})};var a=$(this),t=$.get_user_id(e),s=$(0===$("#data_box").length?'<div id="data_box">':"#data_box"),_=$('<small class="text-info">').text($.get_invited_users_count(e)),n=$("<sup>").append(_),i=$(0===$("#invited_box_title").length?'<h2 id="invited_box_title">':"#invited_box_title"),r=$('<ul class="list-group">'),l=$(0===$("#invited_box").length?'<div id="invited_box" class="col-xs-12 col-sm-12 col-md-6 col-lg-6">':"#invited_box"),o=$("<a>").attr({href:"./Invite#"+t,"class":"btn btn-default pull-right"});o.html(t==$.get_manager_id()?i18n[lang].interface.btns.invite_an_user+' <span class="fa fa-plus"></span>':i18n[lang].interface.btns.invite_an_user_as.replace("{X}",$.get_user_name(e))+' <span class="fa fa-plus"></span>'),i.html(i18n[lang].messages.invited_users+" "),i.append(n),$.get_invited_users_count(e)>0?($.each(e[kTAG_INVITES][kAPI_PARAM_RESPONSE_FRMT_DOCU],function(e,a){var t=$.get_user_full_name(a[kAPI_PARAM_RESPONSE_FRMT_DOCU]),s=($.get_user_email(a[kAPI_PARAM_RESPONSE_FRMT_DOCU]),$('<li class="list-group-item">')),_=$('<div class="row">'),n=$('<div class="col-xs-7">'),i=$('<div class="col-xs-3">'),l=$('<div class="col-xs-2 text-right">'),o=$("<a>").attr({href:"mailto:"+t}),d=$("<p>"),c=$("<p>");o.text(t),d.html('<span class="fa fa-user-secret fa-fw text-muted"></span> '),d.append(o),n.html(d),c.attr("title",i18n[lang].messages.this_user_will_be_able_to+" "+$.get_user_roles_list(a[kAPI_PARAM_RESPONSE_FRMT_DOCU])),c.load_invited_roles_icon(a[kAPI_PARAM_RESPONSE_FRMT_DOCU]),c.tooltip(),i.html(c),l.html('<a class="btn btn-default-white" href="javascript:void(0);" onclick="$.delete_invitation(\''+$.get_user_pgp_fingerprint(a[kAPI_PARAM_RESPONSE_FRMT_DOCU])+'\')"><span class="fa fa-trash"></span></span>'),_.append(n).append(i).append(l),s.append(_),r.append(s)}),l.html(r),l.append(o),s.html(l)):(l.html('<p class="pull-left text-muted"><i>'+i18n[lang].messages.no_invited_users_yet+"</i></p>").append(o),s.append(l)),s.addClass("row").insertAfter(a),i.insertBefore(s)},$.cancel_user_editing=function(){apprise(i18n[lang].messages.undo_user_profile.message,{title:i18n[lang].messages.undo_user_profile.title,icon:"fa-warning",titleClass:"text-warning",confirm:!0},function(e){if(e){var a=$.url().fsegment();document.location="./Profile#"+a[1]}})},$.fn.load_user_data_in_form=function(e){$.fn.add_typed=function(){var e=$(this).closest(".form-group"),a=e.find("div.line"),t=($.trim(e.attr("class").replace("form-group","")),0),s=$('<div class="line clearfix">'),_=($('<div class="form-group">'),$('<div class="col-sm-5">'),$('<div class="input-group">')),n=$('<div class="input-group-btn">'),i=($('<div class="col-sm-5 control-label text-muted text-left">'),$('<div class="col-sm-5 control-label text-muted text-left">')),r=$('<div class="col-sm-5 control-label text-muted text-left">'),l=($('<label class="col-sm-3 control-label">'),$('<label class="col-sm-3 control-label">')),o=($('<div class="col-sm-3 control-label text-muted">'),$("<input>")),d=$("<input>"),c=($("<a>").attr({href:"javascript:void(0);",onclick:"$(this).add_typed();","class":"btn btn-default-white"}),$("<a>").attr({href:"javascript:void(0);",onclick:"$(this).remove_typed();","class":"btn btn-default-white"}).html('<span class="fa fa-minus text-center">'));return i.attr("class","col-sm-4 col-xs-6"),r.attr("class","col-sm-4 col-xs-6 row"),$.each(e.find("input"),function(){return 0===$(this).val().length?(t++,$(this).focus(),!1):void 0}),0===t?(o.attr({type:"text","class":"form-control",required:"required","data-item":e.find("input:first").attr("data-item"),"data-tag":e.find("input:first").attr("data-tag"),"data-type":e.find("input:first").attr("data-type"),"data-struct":"k","data-count":a.length,id:e.find("input:first").attr("data-item"),name:e.find("input:first").attr("data-item"),placeholder:e.find("input:first").attr("placeholder"),value:""}),d.attr({type:"text","class":"form-control",required:"required","data-item":e.find("input:first").attr("data-item"),"data-tag":e.find("input:first").attr("data-tag"),"data-type":e.find("input:first").attr("data-type"),"data-struct":"v","data-count":a.length,id:e.find("input:first").attr("data-item"),name:e.find("input:first").attr("data-item"),placeholder:e.find("input:last").attr("placeholder"),value:""}),i.append(o),_.append(d),n.append(c),_.append(n),r.append(_),s.append(l).append(i).append(r),e.append(s),s.find("input[value='']:not(:checkbox,:button):visible:first").focus(),!1):void 0},$.fn.remove_typed=function(){var e=$(this).closest(".line");e.fadeOut(300,function(){e.remove()})},(void 0===e||null===e||""===e)&&(e=$.get_manager_id()),$.storage_exists("pgrdg_user_cache.user_data.current")&&($.get_manager_id()!==e?$.storage_exists("pgrdg_user_cache.user_data.current")&&$.each(storage.get("pgrdg_user_cache.user_data.current"),function(e,a){$("#contents").generate_manager_profile(a)}):$("#managers").remove());var a=$(this),t={},s=0;t[kTAG_RECORD_CREATED]={},t[kTAG_VERSION]={},t[kTAG_ENTITY_AFFILIATION]={},t[kTAG_ENTITY_FNAME]={},t[kTAG_ENTITY_FNAME]={},t[kTAG_ENTITY_LNAME]={},t[kTAG_NAME]={},t[kTAG_CONN_CODE]={},t[kTAG_ENTITY_EMAIL]={},t[kTAG_ENTITY_PHONE]={},t[kTAG_ENTITY_ICON]={},$.get_user(e,!1,function(_){$.each(_,function(){t[kTAG_VERSION][kAPI_PARAM_DATA_TYPE]="static",t[kTAG_VERSION][kAPI_RESULT_ENUM_LABEL]="Invited on",t[kTAG_VERSION][kAPI_PARAM_DATA]=_[kTAG_VERSION],t[kTAG_VERSION][kAPI_RESULT_ENUM_LABEL]="Subscribed on",t[kTAG_RECORD_CREATED][kAPI_PARAM_DATA_TYPE]="static",t[kTAG_RECORD_CREATED][kAPI_PARAM_DATA]=_[kTAG_RECORD_CREATED],t[kTAG_ENTITY_AFFILIATION][kAPI_PARAM_DATA_TYPE]="read",t[kTAG_ENTITY_AFFILIATION][kAPI_PARAM_DATA]=_[kTAG_ENTITY_AFFILIATION],t[kTAG_ENTITY_FNAME][kAPI_PARAM_DATA_TYPE]="edit",t[kTAG_ENTITY_FNAME][kAPI_PARAM_INPUT_TYPE]="text",t[kTAG_ENTITY_FNAME][kAPI_PARAM_DATA_KIND]="required",t[kTAG_ENTITY_FNAME][kAPI_PARAM_ID]=_[kTAG_ENTITY_FNAME][kAPI_PARAM_RESPONSE_FRMT_NAME].replace(/\s+/g,"_").toLowerCase(),t[kTAG_ENTITY_FNAME][kAPI_PARAM_DATA]=_[kTAG_ENTITY_FNAME],t[kTAG_ENTITY_LNAME][kAPI_PARAM_DATA_TYPE]="edit",t[kTAG_ENTITY_LNAME][kAPI_PARAM_INPUT_TYPE]="text",t[kTAG_ENTITY_LNAME][kAPI_PARAM_DATA_KIND]="required",t[kTAG_ENTITY_LNAME][kAPI_PARAM_ID]=_[kTAG_ENTITY_LNAME][kAPI_PARAM_RESPONSE_FRMT_NAME].replace(/\s+/g,"_").toLowerCase(),t[kTAG_ENTITY_LNAME][kAPI_PARAM_DATA]=_[kTAG_ENTITY_LNAME],t[kTAG_NAME][kAPI_RESULT_ENUM_LABEL]="Full name",t[kTAG_NAME][kAPI_PARAM_DATA_TYPE]="edit",t[kTAG_NAME][kAPI_PARAM_INPUT_TYPE]="text",t[kTAG_NAME][kAPI_PARAM_DATA_KIND]="required",t[kTAG_NAME][kAPI_PARAM_ID]=_[kTAG_NAME][kAPI_PARAM_RESPONSE_FRMT_NAME].replace(/\s+/g,"_").toLowerCase(),t[kTAG_NAME][kAPI_PARAM_DATA]=_[kTAG_NAME],t[kTAG_CONN_CODE][kAPI_PARAM_DATA_TYPE]="edit",t[kTAG_CONN_CODE][kAPI_PARAM_INPUT_TYPE]="text",t[kTAG_CONN_CODE][kAPI_PARAM_DATA_KIND]="required",t[kTAG_CONN_CODE][kAPI_RESULT_ENUM_LABEL]="Username",t[kTAG_CONN_CODE][kAPI_PARAM_ID]=_[kTAG_CONN_CODE][kAPI_PARAM_RESPONSE_FRMT_NAME].replace(/\s+/g,"_").toLowerCase(),t[kTAG_CONN_CODE][kAPI_PARAM_DATA]=_[kTAG_CONN_CODE],t[kTAG_ENTITY_EMAIL][kAPI_PARAM_DATA_TYPE]="read_edit",t[kTAG_ENTITY_EMAIL][kAPI_PARAM_INPUT_TYPE]="email",t[kTAG_ENTITY_EMAIL][kAPI_PARAM_ID]=_[kTAG_ENTITY_EMAIL][kAPI_PARAM_RESPONSE_FRMT_NAME].replace(/\s+/g,"_").toLowerCase(),t[kTAG_ENTITY_EMAIL][kAPI_PARAM_DATA]=_[kTAG_ENTITY_EMAIL],t[kTAG_ENTITY_PHONE][kAPI_PARAM_DATA_TYPE]="edit",t[kTAG_ENTITY_PHONE][kAPI_PARAM_INPUT_TYPE]="text",t[kTAG_ENTITY_PHONE][kAPI_PARAM_ID]=_[kTAG_ENTITY_PHONE][kAPI_PARAM_RESPONSE_FRMT_NAME].replace(/\s+/g,"_").toLowerCase(),t[kTAG_ENTITY_PHONE][kAPI_PARAM_DATA]=_[kTAG_ENTITY_PHONE],t[kTAG_ENTITY_ICON][kAPI_PARAM_DATA_TYPE]="hide",t[kTAG_ENTITY_ICON][kAPI_PARAM_DATA]=_[kTAG_ENTITY_ICON]});var n=$('<div class="row">'),i=$('<div class="col-xs-12 col-sm-3 col-lg-2 pull-left" id="picture_container">'),r=$('<div class="col-xs-12 col-sm-8 col-lg-6 well form" id="user_data_container">'),l=$("<fieldset>"),o=$("<legend>").text("Personal data"),d=$("<div>"),c=$('<span class="fa fa-pencil"></span>'),p=$('<a id="upload_btn" href="javascript:void(0);">'),A=$('<input style="display: none;" type="file" multiple="" class="upload_btn_input" href="javascript:void(0);">'),u=$("<img>").attr({src:$.get_user_img_src(_),alt:"me"}),g=$('<div id="picture">'),E=$('<small class="help-block">');d.append(c),p.append(d),p.append(u),g.append(p),g.append(A),i.append(g),l.append(o),a.html(""),$.each(t,function(a,o){s++;var d=$('<div class="line clearfix">'),c=$('<div class="form-group">'),p=$('<div class="col-sm-5">'),A=$('<div class="input-group">'),u=$('<div class="input-group-btn">'),g=$('<div class="col-sm-5 control-label text-muted text-left">'),f=$('<div class="col-sm-5 control-label text-muted text-left">'),P=$('<div class="col-sm-5 control-label text-muted text-left">'),T=$('<label class="col-sm-3 control-label">'),m=($('<label class="col-sm-3 control-label">'),""),R=$('<div class="col-sm-3 control-label text-muted">'),k=$("<input>"),h=$("<input>"),I=$("<a>").attr({href:"javascript:void(0);",onclick:"$(this).add_typed();","class":"btn btn-default-white"}),S=$("<a>").attr({href:"javascript:void(0);",onclick:"$.cancel_user_editing();","class":"btn btn-default-white pull-left"}).html('<span class="fa fa-angle-left"></span> '+i18n[lang].interface.btns.cancel),v=$("<a>").attr({href:"javascript:void(0);",onclick:"$.save_user_data('"+e+"');","class":"btn btn-default pull-right"}).html(i18n[lang].interface.btns.save+' <span class="fa fa-angle-right"></span>');n.prepend(i);var N="";switch(o[kAPI_PARAM_DATA_TYPE]){case"static":var M=$('<dl class="visible-sm visible-md visible-lg">'),b=$("<dt>"),O=$("<dd>");b.text(void 0!==o[kAPI_RESULT_ENUM_LABEL]?o[kAPI_RESULT_ENUM_LABEL]:$.ucfirst(o[kAPI_PARAM_DATA][kAPI_PARAM_RESPONSE_FRMT_NAME].replace("Record ",""))),O.text($.right_date(o[kAPI_PARAM_DATA][kAPI_PARAM_RESPONSE_FRMT_DISP])),M.append(b),M.append(O),E.append(M),i.append(E);break;case"read":if($.is_obj(o[kAPI_PARAM_DATA][kAPI_PARAM_RESPONSE_FRMT_DISP])||$.is_array(o[kAPI_PARAM_DATA][kAPI_PARAM_RESPONSE_FRMT_DISP])){m=void 0!==o[kAPI_RESULT_ENUM_LABEL]?o[kAPI_RESULT_ENUM_LABEL]:$.ucfirst(o[kAPI_PARAM_DATA][kAPI_PARAM_RESPONSE_FRMT_NAME].replace("Record ","")),R.text(m);var x=$('<ul class="list-unstyled">');$.each(o[kAPI_PARAM_DATA][kAPI_PARAM_RESPONSE_FRMT_VALUE],function(e,a){$.is_obj(a)||$.is_array(a)?kTAG_UNIT_REF in a&&(x.append('<li id="'+$.trim(a[kTAG_TYPE])+'"><i>Loading...</li>'),$.get_authority(a[kTAG_UNIT_REF],function(e){$("#"+$.trim(a[kTAG_TYPE])).html(e)})):x.html("<li><i>none</i></li>")}),f.html(x),d.addClass($.md5(m)),d.append(R),d.append(f),l.append(d)}else m=void 0!==o[kAPI_RESULT_ENUM_LABEL]?o[kAPI_RESULT_ENUM_LABEL]:$.ucfirst(o[kAPI_PARAM_DATA][kAPI_PARAM_RESPONSE_FRMT_NAME].replace("Record ","")),R.text(m),f.text($.right_date(o[kAPI_PARAM_DATA][kAPI_PARAM_RESPONSE_FRMT_DISP])),d.addClass($.md5(m)),c.append(R),c.append(f);l.append(c),r.append(l),n.append(r);break;case"read_edit":$.is_obj(o[kAPI_PARAM_DATA][kAPI_PARAM_RESPONSE_FRMT_DISP])||$.is_array(o[kAPI_PARAM_DATA][kAPI_PARAM_RESPONSE_FRMT_DISP])?(m=void 0!==o[kAPI_RESULT_ENUM_LABEL]?o[kAPI_RESULT_ENUM_LABEL]:$.ucfirst(o[kAPI_PARAM_DATA][kAPI_PARAM_RESPONSE_FRMT_NAME]),T.attr("for",o[kAPI_PARAM_ID]),T.text(m),d.append(T),$.each(o[kAPI_PARAM_DATA][kAPI_PARAM_RESPONSE_FRMT_DISP],function(e,t){$.each(t,function(){$.each(t,function(){N=t[kAPI_PARAM_RESPONSE_FRMT_DISP]})}),g.attr("class","col-sm-9 col-xs-12").append('<span class="help-block">'+t[kAPI_PARAM_RESPONSE_FRMT_NAME]+": "+$.linkify(N)+"</span>"),k.attr({type:"text","class":"form-control typed_key","data-item":o[kAPI_PARAM_ID],"data-tag":a,"data-type":o.data[kAPI_PARAM_DATA_TYPE],"data-struct":"k","data-count":0,id:o[kAPI_PARAM_ID]+"_k",name:o[kAPI_PARAM_ID]+"_k",placeholder:$.ucfirst(kAPI_RESULT_ENUM_LABEL),value:""}),h.attr({type:void 0!==o[kAPI_PARAM_INPUT_TYPE]?o[kAPI_PARAM_INPUT_TYPE]:"text","class":"form-control typed_value","data-item":o[kAPI_PARAM_ID],"data-tag":a,"data-type":o.data[kAPI_PARAM_DATA_TYPE],"data-struct":"v","data-count":0,id:o[kAPI_PARAM_ID]+"_v",name:o[kAPI_PARAM_ID]+"_v",placeholder:o[kAPI_PARAM_DATA][kAPI_PARAM_RESPONSE_FRMT_NAME],value:""}),d.addClass($.md5(m)),f.attr("class","col-sm-4 col-xs-6 col-sm-offset-3").append(k),P.attr("class","col-sm-4 col-xs-6 row"),I.html('<span class="fa fa-plus text-center">'),u.append(I),A.append(h)}),A.append(u),p.append(f),p.append(P),P.append(A),d.append(g).append(f).append(P),c.append(d)):(m=void 0!==o[kAPI_RESULT_ENUM_LABEL]?o[kAPI_RESULT_ENUM_LABEL]:$.ucfirst(o[kAPI_PARAM_DATA][kAPI_PARAM_RESPONSE_FRMT_NAME].replace("Record ","")),R.text(m),f.text($.right_date(o[kAPI_PARAM_DATA][kAPI_PARAM_RESPONSE_FRMT_DISP])),k.attr({type:"hidden","class":"form-control","data-item":o[kAPI_PARAM_ID],"data-tag":a,"data-type":o.data[kAPI_PARAM_DATA_TYPE],"data-struct":"v","data-count":0,id:o[kAPI_PARAM_ID]+"_k",name:o[kAPI_PARAM_ID]+"_k",placeholder:o[kAPI_PARAM_DATA][kAPI_PARAM_RESPONSE_FRMT_NAME],value:""}),d.addClass($.md5(m)),c.append(R),c.append(f)),c.addClass(o[kAPI_PARAM_DATA_TYPE]+"_item"),l.append(c),r.append(l),n.append(r);break;case"edit":m=void 0!==o[kAPI_RESULT_ENUM_LABEL]?o[kAPI_RESULT_ENUM_LABEL]:$.ucfirst(o[kAPI_PARAM_DATA][kAPI_PARAM_RESPONSE_FRMT_NAME].replace("Entity ","")),T.addClass("col-xs-12").attr("for",o[kAPI_PARAM_ID]),T.text(m),$.is_obj(o[kAPI_PARAM_DATA][kAPI_PARAM_RESPONSE_FRMT_DISP])||$.is_array(o[kAPI_PARAM_DATA][kAPI_PARAM_RESPONSE_FRMT_DISP])?(d.append(T),$.each(o[kAPI_PARAM_DATA][kAPI_PARAM_RESPONSE_FRMT_DISP],function(e,t){($.is_obj(t)||$.is_array(t))&&$.each(t,function(e){k.attr({type:"text","class":"form-control","data-item":o[kAPI_PARAM_ID],"data-tag":a,"data-type":o.data[kAPI_PARAM_DATA_TYPE],"data-struct":"k","data-count":0,id:o[kAPI_PARAM_ID]+"_k",name:o[kAPI_PARAM_ID]+"_k",placeholder:$.ucfirst(kAPI_RESULT_ENUM_LABEL),value:t[kAPI_PARAM_RESPONSE_FRMT_NAME]}),h.attr({type:void 0!==o[kAPI_PARAM_INPUT_TYPE]?o[kAPI_PARAM_INPUT_TYPE]:"text","class":"form-control","data-item":o[kAPI_PARAM_ID],"data-tag":a,"data-type":o.data[kAPI_PARAM_DATA_TYPE],"data-struct":"v","data-count":0,id:o[kAPI_PARAM_ID]+"_v",name:o[kAPI_PARAM_ID]+"_v",placeholder:o[kAPI_PARAM_DATA][kAPI_PARAM_RESPONSE_FRMT_NAME],value:t[e]}),f.attr("class","col-sm-4 col-xs-6").append(k),P.attr("class","col-sm-4 col-xs-6 row"),I.html('<span class="fa fa-plus text-center">'),u.append(I),A.append(h)})}),A.append(u),p.append(f),p.append(P),P.append(A),d.append(f).append(P),c.append(d)):(d.append(T),k.attr({type:void 0!==o[kAPI_PARAM_INPUT_TYPE]?o[kAPI_PARAM_INPUT_TYPE]:"text","class":"form-control",id:o[kAPI_PARAM_ID],name:o[kAPI_PARAM_ID],"data-tag":a,"data-type":o.data[kAPI_PARAM_DATA_TYPE],"data-struct":"k","data-count":0,placeholder:o[kAPI_PARAM_DATA][kAPI_PARAM_RESPONSE_FRMT_NAME],value:o[kAPI_PARAM_DATA][kAPI_PARAM_RESPONSE_FRMT_DISP]}),"required"==o[kAPI_PARAM_DATA_KIND]&&k.attr("required","required"),p.attr("class","col-sm-5 col-xs-12").append(k),d.append(p)),d.addClass($.md5(m)),c.addClass(o[kAPI_PARAM_DATA_TYPE]+"_item"),"required"==o[kAPI_PARAM_DATA_KIND]&&c.addClass("required"),c.append(d),l.append(c),r.append(l),n.append(r)}s===$.obj_len(t)&&(f.attr("class","col-xs-12 col-sm-8 col-md-8 col-lg-6 col-xs-offest-3 col-sm-offset-3 col-lg-offset-2").append(S).append(v),d.append(f),c.addClass("btns-group"),r.append(l),r.roles_manager_box(e,_[kTAG_ROLES]),n.append(r),n.append(d))}),a.html(n),$.activate_roles_manager_box(),$("#loader").hide()})},$.save_user_data=function(e){var a={},t={},s="",_=0;a[kTAG_ROLES]=[],$.each($(".well.form :input"),function(e,t){$(t).check_input(function(e,n){if(!n)return _++,!1;var i=e.getAttributes();if(s=i["data-tag"],""!==$.trim($(t).val()))switch(i["data-type"]){case kTYPE_TYPED_LIST:var r=[];$.each(e.closest("div.form-group").find("div.line"),function(e,t){var _={},n=$(t).find("input").serializeArray();a[s]=[],a[s][e]={},$.each(n,function(){_[kTAG_TYPE]=n[0].value,_[kTAG_TEXT]=n[1].value}),n.length>0&&(r[e]=_)}),a[s]=r;break;case kTYPE_ROLE_LOGIN:case kTYPE_ROLE_INVITE:case kTYPE_ROLE_UPLOAD:case kTYPE_ROLE_EDIT:case kTYPE_ROLE_USERS:e.is(":checked")&&a[kTAG_ROLES].push(i.value);break;default:a[s]=i.value}})}),t[kAPI_PARAM_OBJECT]=a,0===_&&$.require_password(function(){$("#loader").show(),t[kAPI_REQUEST_USER]=$.get_manager_id(),t[kAPI_PARAM_ID]=e,$.ask_cyphered_to_service({storage_group:"pgrdg_user_cache.user_data.all."+e,data:t,type:"save_user_data"},function(a){$.obj_len(a)>0&&"ok"==a[kAPI_STATUS_STATE]?($.log_activity("Updated user data"),$.get_user(e,!0,function(){$("#loader").hide(),apprise(i18n[lang].messages.data_saved.message,{title:i18n[lang].messages.data_saved.title,icon:"fa-check",titleClass:"text-success"},function(e){if(e){var a=$.url().fsegment();document.location="./Profile#"+a[1]}})})):($("#loader").hide(),apprise(i18n[lang].messages.errors.theres_an_error.message,{title:i18n[lang].messages.errors.theres_an_error.title,icon:"fa-times",titleClass:"text-danger"}))})})},$.generate_invite_form=function(){var e=$($("#invite_user").length>0?"#invite_user":'<div id="invite_user">'),a=$('<div class="row">'),t=$('<div class="col-xs-12 col-sm-5 col-lg-5 col-sm-offset-1 col-lg-offset-2">'),s=$("<a>").attr({href:"javascript:void(0);",onclick:"$.invite_user();","class":"btn btn-default pull-right"}).html(i18n[lang].interface.btns.invite+' <span class="fa fa-share"></span>'),_=$('<div id="invite_container">').addClass("col-xs-12 col-sm-5 col-lg-5 col-sm-offset-1 col-lg-offset-2 well form"),n=$("<fieldset>"),i=$("<legend>").text("User personal data"),r=[{text:"Full name","iput-type":"text",id:"new_user_full_name",placeholder:"Full name",separated:!1},{text:"Work title","iput-type":"text",id:"new_user_work_title",placeholder:"Work title",separated:!1},{text:"E-mail address","iput-type":"email",id:"new_user_mail_address",placeholder:"E-mail address",separated:!0}];n.append(i),$.each(r,function(e,a){var t=$('<div class="form-group">'),s=$('<div class="row">'),_=$("<label>").addClass("control-label col-sm-3 control-label col-xs-12").attr("for",a.id).text(a.text),i=$('<div class="col-sm-9 col-xs-12 row">'),r=$("<input>").attr({type:a["iput-type"],name:a.id,id:a.id,placeholder:a.placeholder,value:""}).addClass("form-control");i.append(r),s.append(_),s.append(i),t.append(s),a.separated&&n.append("<br />"),n.append(t)}),_.append(n),_.roles_manager_box(),t.append(s),a.append(_),a.append(t),e.html(a),e.append("<br /><br />"),$.activate_roles_manager_box(),$("#loader").hide()},$.fn.roles_manager_box=function(e,a){if(void 0===e||null===e)if(void 0===a){var t=$.get_current_user_data();e=$.get_user_id(t),a=$.get_user_roles(t)}else e="";var s=$(this),_=$("<fieldset>"),n=$("<legend>").text("Roles"),i=$("<ul>").addClass("list-group roles"),r=[{text:"Active",icon:"fa-lock",description:"The ability to login.",id:"role-login",value:kTYPE_ROLE_LOGIN,"data-type":kTYPE_ROLE_LOGIN,checked:$.inArray(kTYPE_ROLE_LOGIN,a[kAPI_PARAM_RESPONSE_FRMT_VALUE])>-1?"checked":"",danger:!0,"data-content":"If this field is set to off, the user will be unable to login"},{text:"Invite users",icon:"fa-user-plus",description:"The ability to compile a user profile and send an invitation.",id:"role-invite",value:kTYPE_ROLE_INVITE,"data-type":kTYPE_ROLE_INVITE,checked:$.inArray(kTYPE_ROLE_INVITE,a[kAPI_PARAM_RESPONSE_FRMT_VALUE])>-1?"checked":"",danger:!1},{text:"Upload data",icon:"fa-upload",description:"The ability to upload data templates.",id:"role-upload",value:kTYPE_ROLE_UPLOAD,"data-type":kTYPE_ROLE_UPLOAD,checked:$.inArray(kTYPE_ROLE_UPLOAD,a[kAPI_PARAM_RESPONSE_FRMT_VALUE])>-1?"checked":"",danger:!1},{text:"Edit pages",icon:"fa-file-text-o",description:"The ability to login.",id:"role-edit",value:kTYPE_ROLE_EDIT,"data-type":kTYPE_ROLE_EDIT,checked:$.inArray(kTYPE_ROLE_EDIT,a[kAPI_PARAM_RESPONSE_FRMT_VALUE])>-1?"checked":"",danger:!1},{text:"Manage users",icon:"fa-group",description:"The ability to login.",id:"manage-users",value:kTYPE_ROLE_USERS,checked:$.inArray(kTYPE_ROLE_USERS,a[kAPI_PARAM_RESPONSE_FRMT_VALUE])>-1?"checked":"",danger:!1}];
$.each(r,function(a,t){var s=$('<li class="list-group-item">'),_=$('<div class="pull-right">'),n=$("<input>").attr({type:"checkbox","data-type":t.value,id:t.id,value:t.value}),r=$("<label>").attr("for",t.id).addClass("text-left"),l=$("<h3>"),o=$("<p>").addClass("list-group-item-text").text(t.description),d=$("<span>").addClass("fa fa-fw text-muted "+t.icon);l.append(d).append(t.text).addClass("list-group-item-heading"),r.append(l),r.append(o),void 0!==t.checked&&""!==t.checked&&"checked"==t.checked?(s.addClass("list-group-item-success"),n.attr("checked",t.checked)):n.attr("checked",!1),t.danger&&(n.attr({"data-off-color":"danger","data-content":t.title}),l.append(' <sup><small class="fa fa-exclamation-triangle text-warning" style="font-size: 12px;"></small></sup>'),s.popover({placement:"top",trigger:"hover",title:'<span class="text-warning"><span class="fa fa-exclamation-triangle"></span> Warning</span>',html:!0,content:t["data-content"],viewport:"#invite_user"})),s.append(r),_.append(n),s.append(_),t.value==kTYPE_ROLE_LOGIN?e!==$.get_manager_id()&&i.append(s):i.append(s)}),_.append(n),_.append(i),s.append(_)},$.activate_roles_manager_box=function(){$("[type='checkbox']").bootstrapSwitch({size:"small",labelText:"⋮",onText:"Yes",offText:"No"}).on("switchChange.bootstrapSwitch",function(e,a){if("role-login"==e.target.id){var t=$("#role-invite, #role-upload, #role-edit, #manage-users"),s=t.closest("li.list-group-item");a?($(this).closest("li.list-group-item").removeClass("list-group-item-danger"),s.removeClass("disabled"),$.each(s,function(){$(this).hasClass("list-group-item-not-success")&&$(this).switchClass("list-group-item-not-success","list-group-item-success")}),t.bootstrapSwitch("toggleIndeterminate",!1),t.bootstrapSwitch("toggleDisabled",!1)):($(this).closest("li.list-group-item").addClass("list-group-item-danger"),s.addClass("disabled"),$.each(s,function(){$(this).hasClass("list-group-item-success")&&$(this).switchClass("list-group-item-success","list-group-item-not-success")}),t.bootstrapSwitch("toggleIndeterminate",!0),t.bootstrapSwitch("toggleDisabled",!0))}else a?($(this).attr("checked",!0),$(this).closest("li.list-group-item").addClass("list-group-item-success")):($(this).attr("checked",!1),$(this).closest("li.list-group-item").removeClass("list-group-item-success"))})},$.invite_user=function(e,a){if(""===$.trim($("#new_user_full_name").val()))$("#new_user_full_name").closest(".form-group").addClass("has-error"),$("#new_user_full_name").focus();else if(""===$.trim($("#new_user_work_title").val()))$("#new_user_full_name").closest(".form-group").removeClass("has-error"),$("#new_user_work_title").closest(".form-group").addClass("has-error"),$("#new_user_work_title").focus();else if(""===$.trim($("#new_user_mail_address").val()))$("#new_user_full_name").closest(".form-group").removeClass("has-error"),$("#new_user_work_title").closest(".form-group").removeClass("has-error"),$("#new_user_mail_address").closest(".form-group").addClass("has-error"),$("#new_user_mail_address").focus();else{$("#loader").show(),$("#new_user_full_name").closest(".form-group").removeClass("has-error"),$("#new_user_work_title").closest(".form-group").removeClass("has-error"),$("#new_user_mail_address").closest(".form-group").removeClass("has-error");var t={};t[kAPI_REQUEST_USER]=null===e||void 0===e||""===e?$.get_manager_id():e,t[kTAG_NAME]=$.trim($("#new_user_full_name").val()),t[kTAG_AUTHORITY]="ITA046",t[kTAG_COLLECTION]="pgrdiversity.bioversityinternational.org",t[kTAG_ENTITY_TITLE]=$.trim($("#new_user_work_title").val()),t[kTAG_ENTITY_EMAIL]=$.trim($("#new_user_mail_address").val()),t[kTAG_ROLES]=[],$("#role-invite").is(":checked")?t[kTAG_ROLES].push(kTYPE_ROLE_INVITE):$.array_remove(t[kTAG_ROLES],kTYPE_ROLE_INVITE),$("#role-upload").is(":checked")?t[kTAG_ROLES].push(kTYPE_ROLE_UPLOAD):$.array_remove(t[kTAG_ROLES],kTYPE_ROLE_UPLOAD),$("#role-edit").is(":checked")?t[kTAG_ROLES].push(kTYPE_ROLE_EDIT):$.array_remove(t[kTAG_ROLES],kTYPE_ROLE_EDIT),$("#manage-users").is(":checked")?t[kTAG_ROLES].push(kTYPE_ROLE_USERS):$.array_remove(t[kTAG_ROLES],kTYPE_ROLE_USERS),$("#role-login").is(":checked")?t[kTAG_ROLES].push(kTYPE_ROLE_LOGIN):t[kTAG_ROLES]=[],$.ask_cyphered_to_service({storage_group:"pgrdg_user_cache.user_data.invitations",data:t,type:"invite_user"},function(e){console.warn(e),"function"==typeof a&&$.each(e,function(e,a){$.log_activity("Invited an user with id: "+$.get_user_id(a))}),$("#loader").hide()})}},$.delete_invitation=function(e){apprise(i18n[lang].messages.delete_invitation.message,{title:i18n[lang].messages.delete_invitation.title,icon:"warning",confirm:!0,yesBtn:"Yes",noBtn:"No"},function(a){a&&$.log_activity("Delete invitation for user "+e)})},$.add_menu=function(){var e=!0,a={};if($.each($("#menu_management_stage .list-group-item"),function(t,s){return 0===$(s).find(".menu_name").html().length?(a=$(s),e=!1,!1):void 0}),e){var t=($.url().attr("host"),$('<li id="'+$.md5("new_node"+$.now())+'" class="list-group-item">')),s=$('<div class="title_row">'),_=$('<div class="move-handle"></div>'),n=$('<div class="move-handle"></div>'),i=$('<div class="menu_data">'),r=$('<h4 class="list-group-item-heading">'),l=$('<span class="fa fa-indent menu_icon">'),o=$('<span class="menu_name">'),d=$('<span class="menu_link">').text("javascript:void(0);"),c=$('<span class="fa fa-fw">').html("&rsaquo;"),p=$("<tt>"),A=$('<div class="btn-group pull-right">'),u=$("<button>").attr({"data-placement":"top","data-toggle":"tooltip",title:i18n[lang].messages.edit,onclick:"$(this).edit_menu();","class":"btn btn-default-white edit_menu_btn"}).html('<span class="fa fa-fw fa-edit"></span>'),g=$("<button>").attr({"data-placement":"top","data-toggle":"tooltip",title:i18n[lang].messages.hide,onclick:"$(this).hide_menu();","class":"btn btn-default-white"}).html('<span class="fa fa-fw fa-eye-slash"></span>'),E=$('<small class="">'),f=$("<p>").attr({"class":"list-group-item-text list-group-item-body clearfix menu_title"}).html("<br />");p.append(E).append(d),A.append(u).append(g),r.append(l).append(" ").append(o).append(c).append(p).append(A),i.append(r).append(f),s.append(_).append(i).append(n),t.append(s),$("#menu_management_stage > ul.list-group").prepend(t),u.edit_menu(i18n[lang].messages.new_menu_item)}else a.find(".edit_menu_btn").edit_menu(i18n[lang].messages.new_menu_item)},$.fn.hide_menu=function(){var e=$(this),a=e.closest(".list-group-item").first();a.find(".title_row h4").first().find("span").toggleClass("not-visible"),a.find(".title_row h4").first().find("tt").toggleClass("not-visible"),a.find(".title_row p").first().toggleClass("not-visible"),e.toggleClass("active")},$.fn.edit_menu=function(e){$.generate_available_icons=function(e){$.storage_exists("pgrdg_user_cache.local.available_icons")?"function"==typeof e&&e(storage.get("pgrdg_user_cache.local.available_icons")):$.ajax({url:"common/include/funcs/_ajax/available_icons.php",DataType:"json",crossDomain:!0,type:"GET",timeout:1e4,success:function(a){storage.set("pgrdg_user_cache.local.available_icons",a.icons),"function"==typeof e&&e(a.icons)}})},$.fn.generate_available_icons_preview=function(e){$.fn.set_icon=function(e){var a=$(this).closest(".icon_box"),t=$("input#menu_icon");t.val(e),a.find("a.selected").removeClass("selected"),$(this).addClass("selected")};var a=$('<ul class="list-inline">');$.generate_available_icons(function(t){for(var s=0;s<t.length;s++){var _=$("<li>"),n=t[s],i=$("<a>").attr({href:"javascript:void(0);",onclick:"$(this).set_icon('fa "+n+"');",id:n,title:$.ucfirst(n.replace("fa-","").replace("-o-","-").replace("-o","").replace(/\-/g," ")),"class":e.replace("fa ","")==n?"selected":""}),r=$("<span>").addClass("fa fa-fw "+n);i.append(r),_.append(i),a.append(_)}}),$(this).append(a)},$("#loader").show();var a=$(this),t=a.closest(".menu_data").first(),s=a.closest(".list-group-item").find(".title_row").first(),_=t.find(".menu_title:first").text()!==i18n[lang].messages.no_title?t.find(".menu_title:first").text():"",n=t.find(".menu_name:first").text(),i=$.trim(t.find(".menu_icon:first").attr("class").replace("menu_icon","")),r=$.local_link_to_str(t.find(".menu_link:first").text()),l=$('<form class="form-horizontal">'),o=$('<div class="form-group">'),d=$('<div class="form-group">'),c=$('<div class="form-group">'),p=$('<div class="icon_box_container">'),A=$('<div class="row icon_box_header">'),u=$('<div class="col-sm-6">'),g=$('<div class="input-group">'),E=$('<span class="input-group-addon">').html('<span class="fa fa-search"></span>'),f=$('<div class="icon_box">'),P=$('<label class="control-label col-sm-2" for="menu_name">').text(i18n[lang].interface.forms.label_menu_text),T=$('<label class="control-label col-sm-2" for="menu_title">').text(i18n[lang].interface.forms.label_menu_title),m=$('<label class="control-label col-sm-2" for="menu_link">').text(i18n[lang].interface.forms.label_menu_link),R=$('<label class="control-label col-sm-6 text-left" for="menu_icon">').text(i18n[lang].interface.forms.label_menu_icon),k=$('<div class="col-sm-6">'),h=$('<div class="col-sm-10">'),I=$('<div class="col-sm-10">'),S=($('<div class="col-sm-10">'),$('<div class="input-group">')),v=$('<span class="input-group-btn">'),N=$('<button class="btn btn-default-grey" title="'+i18n[lang].interface.btns.empty_link+"\" onclick=\"$('#menu_link').val('javascript:void(0);'); return false;\">").html('<span class="fa fa-code">'),M=$('<input type="text" id="icon_search" class="form-control pull-right" placeholder="Search icon..." />'),b=$('<input type="text" class="form-control" id="menu_name" name="menu_name" required value="'+n+'" tabindex="1" />'),O=$('<input type="text" class="form-control" id="menu_title" name="menu_title" required value="'+_+'" tabindex="2" />'),x=$('<input type="url" class="form-control" id="menu_link" name="menu_link" required disabled value="'+r.replace(/\_/g," ")+'" tabindex="3" />');$input_icon=$('<input type="hidden" id="menu_icon" name="menu_icon" value="'+i+'" tabindex="4" />'),k.append(b),o.append(P),o.append(k),h.append(O),d.append(T),d.append(h),S.append(x),S.append(v),v.append(N),I.append(S),c.append(m),c.append(I),A.append(R),g.append(M),g.append(E),u.append(g),A.append(u),p.append(A),p.append($input_icon),f.generate_available_icons_preview(i),p.append(f),l.html(""),l.append(o),l.append(d),l.append(c),l.append(p),s.addClass("selected"),apprise(l[0].outerHTML,{title:void 0!==e&&null!==e&&""!==e?e:i18n[lang].messages.edit_menu,form:!0,allowExit:!1,cancelBtnClass:"btn-default-white",okBtnClass:"btn-default",onShown:function(){$.ajax({url:"common/include/funcs/_ajax/get_all_pages.php",DataType:"json",crossDomain:!0,type:"GET",timeout:1e4,success:function(e){var a=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.obj.whitespace("title"),queryTokenizer:Bloodhound.tokenizers.whitespace,local:e});a.initialize(),$("#menu_link").attr("disabled",!1),$("#menu_link").typeahead({hint:!0,highlight:!0,minLength:2},{name:"pages",displayKey:"title",source:a.ttAdapter()}).bind("typeahead:selected, typeahead:cursorchanged",function(e,a){$(this).on("blur",function(){$(this).val(a.link.replace(/\_/g," ").replace(/\//g,""))})})}}),$("#icon_search").on("keyup",function(){$("#icon_search").closest(".input-group").find(".fa").switchClass("fa-times","fa-search"),$("#icon_search").closest(".input-group").removeClass("has-error");var e=this,a=($("#icon_search").closest(".input-group"),$(".icon_box")),t=a.find("ul.list-inline li");$(".search-sf").remove(),$.each(t,function(a,s){var _=$(s).find("a").attr("data-original-title").toLowerCase(),n=$(e).val().toLowerCase();""!==n&&(-1==_.indexOf(n)?t.eq(a).hide():($(".search-sf").remove(),t.eq(a).show()))}),0===t.children(":visible").length&&($("#icon_search").closest(".input-group").find(".fa").switchClass("fa-search","fa-times"),$("#icon_search").closest(".input-group").addClass("has-error"),0===$("h1.search-sf").length&&a.append('<h1 class="search-sf" unselectable="true">No entries found.</h1>'))}),$(".icon_box").scrollTo("#"+i.replace("fa ",""),800,{offset:function(){return{top:-70}}})},onSave:function(e){e!==!1&&$.each(e,function(e,a){switch(a.name){case"menu_icon":s.find("."+a.name).attr("class","fa "+a.value+" menu_icon");break;case"menu_link":console.info($.str_to_local_link(a.value)),s.find("."+a.name).html($.str_to_local_link(a.value));break;default:s.find("."+a.name).text(a.value)}})},onHidden:function(){s.removeClass("selected")}})},$.save_menu=function(){$.fn.get_row_data=function(){var e={},a=$(this),t=a.find(".menu_data:first"),s=$.trim(t.find(".menu_name").text()),_=s.replace(/\s/g,"_"),n=t.find(".menu_icon").hasClass("not-visible")?!1:!0,i=$.trim(t.find(".menu_title").text().replace(i18n[lang].messages.no_title,"").replace("not-visible","")),r=$.trim(t.find("span.menu_icon").attr("class").replace("fa ","").replace("menu_icon","").replace("not-visible","")),l=$.local_link_to_str(t.find(".menu_link").html());return e[_]={},e[_].content={icon:"fa "+r,text:s},e[_].attributes={href:l,title:i,"class":"btn btn-link"+(n?"":" hidden")},$.obj_len(a.find(".list-group"))>0&&(e[_].childs=[],$.each(a.find(".list-group > .subpanel-body > .list-group-item"),function(a,t){e[_].childs.push($(t).get_row_data())})),e};var e={};e.menu={},e.menu.top=[],$.each($("#menu_management_stage > .list-group > .list-group-item"),function(a,t){e.menu.top.push($(t).get_row_data())}),$.ask_cyphered_to_service({storage_group:"pgrdg_user_cache.local.menu",data:e,type:"save_menu"},function(e){"ok"==e&&alert("Menu saved"),$("#loader").hide()})},$.edit_page=function(e,a){p_data=$.parseJSON(e),i=$.parseJSON(a),$("#page_management").hide(),$("#page_management_edit").append('<h1 unselectable="on"><span class="fa fa-gear fa-spin"></span> '+i18n[lang].messages.loading_form+"</h1>").show();var t=$('<div class="row">'),s=$('<div id="page_management_form_container" class="col-xs-offset-1 col-sm-offset-1 col-xs-12 col-sm-8 col-lg-10 well form">'),_=$("<fieldset>"),n=$("<legend>").text('Editing page "'+p_data.title+'"'),r=$('<form class="form-horizontal">'),l=$('<textarea id="text_editor" class="form-control">').text("### Ok");$btn_div=$('<div class="col-xs-offset-1 col-sm-offset-1 col-xs-12 col-sm-8 col-lg-10">'),$cancel_btn=$('<a href="javascript:void(0);" onclick="$.cancel_page_editing();" class="btn btn-default-white pull-left">').html('<span class="fa fa-angle-left"></span> '+i18n[lang].interface.btns.cancel),$save_btn=$('<a href="javascript:void(0);" onclick="$.save_page_data();" class="btn btn-default pull-right">').html(i18n[lang].interface.btns.save+' <span class="fa fa-angle-right"></span>'),$.each(p_data,function(e,t){if("_id"!==e&&"title_class"!==e&&"subpages"!==e&&"is_system_page"!=e&&"is_main_page"!=e){$.is_array(t)&&(t=t.join(", "));var s=$('<div class="form-group">'),_=($("<div>"),$('<label class="col-sm-3 control-label col-xs-12" for="'+$.md5(e)+'">'+$.ucfirst($.trim(e.replace("is","").replace(/\_/g," ")))+"</label>")),n=$('<div class="col-sm-5 col-xs-12">');switch($input=$("<input>"),"boolean"==$.type(t)?($input.attr({type:"checkbox",id:$.md5(e)}),t===!0&&$input.attr({checked:"true"})):$input.attr({type:"text","class":"form-control",value:t.replace(/\_/g," "),placeholder:$.obj_len(a)>0&&void 0!==i[e]?i[e]:""}),e){case"title":$input.css("width","50%");break;case"address":$input.on("blur",function(){var e=$(this).val();$(this).val($.trim(e))}).attr("id","address")}n.append($input),s.append(_),s.append(n),r.append(s)}}),$.ajax({url:"common/include/funcs/_ajax/get_all_pages.php",DataType:"json",crossDomain:!0,type:"GET",timeout:1e4,success:function(e){var a=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.obj.whitespace("title"),queryTokenizer:Bloodhound.tokenizers.whitespace,local:e});a.initialize(),$("#address").typeahead({hint:!0,highlight:!0,minLength:2},{name:"pages",displayKey:"title",source:a.ttAdapter()}).bind("typeahead:selected, typeahead:cursorchanged",function(e,a){$(this).on("blur",function(){$(this).val(a.link.replace(/\_/g," ").replace(/\//g,""))})})}}),$.ajax({url:"common/md/"+p_data.address.replace(/\_/g," ")+".md",context:this,type:"GET",dataType:"text",success:function(e){console.warn(e)},error:function(){console.warn("The file do not exists")}}),r.append("<hr />"),r.append('<div class="alert alert-info"><b>Note:</b> For collaborative editing, you can also work on <a href="https://stackedit.io/" target="_blank">StackEdit</a> and paste the Markdown content here</div>'),r.append(l),_.append(n),_.append(r),$btn_div.append($cancel_btn).append($save_btn),s.append(_),t.append(s),t.append($btn_div),$("#page_management_edit").html(t),$("[type='checkbox']").bootstrapSwitch({size:"small",labelText:"⋮",onText:"Yes",offText:"No"}),$("#text_editor").markItUp(mySettings)},$.upload_user_status=function(e){var a={};a[kAPI_REQUEST_USER]=$.get_current_user_id(),$.ask_cyphered_to_service({data:a,type:"upload_user_status",force_renew:!0},function(a){"function"==typeof e&&e.call(this,a)})},$.fn.added_file=function(){var e=$(this),a=$("<h1>").text("Template upload"),t=$('<div class="row">'),s=$('<div class="col-xs-6 col-sm-7 col-md-6 col-lg-10">'),_=$('<div class="col-xs-6 col-sm-5 col-md-4 col-lg-3 col-lg-2 text-right">'),n=$('<div id="details_row" class="row hidden">'),i=$('<dl id="dl_left" class="dl-horizontal">'),r=$('<dl id="dl_right" class="dl-horizontal">'),l=$('<div id="progress_supercontainer">'),o=$("<h2>").text("Template upload"),d=$('<div id="progress_container" class="progress">'),c=$("<div>").attr({style:"width: 100%;","aria-valuemax":"100","aria-valuemin":"0","aria-valuenow":"100",role:"progressbar","class":"progress-bar progress-bar-warning progress-bar-striped active",id:"progress_bar"}).text("Processing file..."),p=$('<div class="col-sm-12">'),A=$('<div id="transactions" class="col-sm-12 panel-collapse collapse in">'),u=$("<a>").attr({href:"javascript:void(0);",onclick:"$(this).collapse_details();",id:"details_btn"}).html("Details"),g=$('<div class="panel-body">'),E=$('<div id="detail_list_group" class="list-group">');p.append('<span class="fa fa-fw fa-caret-down"></span> ').append(u),d.append(c),l.append(o),l.append(d),s.append(i),_.append(r),t.append(s),t.append(_),t.append(s),t.append(_),g.append(E),A.append(g),n.append(p),n.append(A),e.html(""),e.append(a).append(t).append(l).append(n),$("#dropzone").remove()},$.set_progress_bar=function(e,a){(null===a||void 0===a||""===a)&&(a="progress-bar-info"),"pending"==e?$("#progress_bar").attr("class","progress-bar progress-bar-striped progress-bar-warning active").css("width","100%").attr("aria-valuenow",100).text("Processing file..."):$("#progress_bar").addClass("active").switchClass("progress-bar-warning",a).css("width",e+"%").attr("aria-valuenow",e).text(e+"%")},$.inform_upload_was_done=function(e,a){var t={};t[kAPI_REQUEST_USER]=$.get_current_user_id(),t[kAPI_PARAM_FILE_PATH]=e,$.ask_cyphered_to_service({data:t,type:"upload_file"},function(e){var t=e["session-id"];"function"==typeof a&&a.call(this,t)})},$.get_session_status=function(e,a){var t={};t[kAPI_REQUEST_USER]=$.get_current_user_id(),t[kAPI_PARAM_ID]=e,console.log(t),$.ask_cyphered_to_service({data:t,type:"upload_session_status",force_renew:!0},function(e){"function"==typeof a&&a.call(this,e)})},$.get_errors=function(e,a){var t=$.extend({session_id:null},e),s={};s[kAPI_REQUEST_USER]=$.get_current_user_id(),s[kAPI_PARAM_ID]=t.session_id,$.ask_cyphered_to_service({data:s,type:"upload_group_transaction",force_renew:!0},function(e){console.info(e),"function"==typeof a&&a.call(this,e)})},$.fn.collapse_details=function(){var e=$(this);e.hasClass("disabled")||(e.prev().toggleClass("fa-caret-right fa-caret-down"),$("#transactions").collapse("toggle"))},$.build_interface=function(e){var a="",t="",s="",_="",n="",i="",r="";$.get_session_status(e,function(l){var o=l[kAPI_SESSION];switch($.trim(o[kTAG_SESSION_STATUS][kAPI_PARAM_RESPONSE_FRMT_VALUE])){case kTYPE_STATUS_FAILED:case kTYPE_STATUS_ERROR:case kTYPE_STATUS_FATAL:case kTYPE_STATUS_EXCEPTION:session_status_class="progress-bar-danger",t="fa-caret fa-1_5x",_="text-danger",s=o[kTAG_SESSION_STATUS][kAPI_PARAM_RESPONSE_FRMT_DISP][kAPI_PARAM_RESPONSE_FRMT_DISP],a="danger";break;case kTYPE_STATUS_EXECUTING:session_status_class="progress-bar-info",t="fa-refresh fa-spin",_="text-muted",s=o[kTAG_SESSION_STATUS][kAPI_PARAM_RESPONSE_FRMT_DISP][kAPI_PARAM_RESPONSE_FRMT_DISP]+"...",a="";break;case kTYPE_STATUS_OK:session_status_class="progress-bar-success",t="fa-check",_="text-success",s=o[kTAG_SESSION_STATUS][kAPI_PARAM_RESPONSE_FRMT_DISP][kAPI_PARAM_RESPONSE_FRMT_DISP],a="success";break;case kTYPE_STATUS_MESSAGE:session_status_class="progress-bar-info",t="fa-info fa-1_5x",_="text-info ",s=o[kTAG_SESSION_STATUS][kAPI_PARAM_RESPONSE_FRMT_DISP][kAPI_PARAM_RESPONSE_FRMT_DISP],a="info";break;case kTYPE_STATUS_WARNING:session_status_class="progress-bar-warning",t="fa-warning",_="text-warning",s=o[kTAG_SESSION_STATUS][kAPI_PARAM_RESPONSE_FRMT_DISP][kAPI_PARAM_RESPONSE_FRMT_DISP],a="warning"}$("#details_row").removeClass("hidden");var d=new Date(1e3*o[kTAG_SESSION_START][kAPI_PARAM_RESPONSE_FRMT_VALUE].sec),c=$("<dt>").text(o[kTAG_SESSION_START][kAPI_PARAM_RESPONSE_FRMT_NAME]),p=$("<dd>").text($.epoch2locale(d)),A=$("<dt>"),u=$("<dd>");if($.obj_len(o[kTAG_SESSION_END])>0){var g=new Date(1e3*o[kTAG_SESSION_END][kAPI_PARAM_RESPONSE_FRMT_VALUE].sec);A.text(o[kTAG_SESSION_END][kAPI_PARAM_RESPONSE_FRMT_NAME]),u.text($.epoch2locale(g))}var E=$("<dt>").text(o[kTAG_SESSION_STATUS][kAPI_PARAM_RESPONSE_FRMT_NAME]);if($dd_status=$("<dd>").html('<b class="'+_+'"><span class="fa '+t+'"></span> '+s+"</b>"),$("#dl_left").html(c).append(p),$.obj_len(o[kTAG_SESSION_END])>0&&$("#dl_left").append(A).append(u),$("#dl_left").append("<br />").append(E).append($dd_status),$.obj_len(o[kTAG_COUNTER_PROCESSED])>0){var f=$('<dt class="text-muted">').text(i18n[lang].messages.upload.summary.total.replace("%",o[kTAG_COUNTER_PROCESSED][kAPI_PARAM_RESPONSE_FRMT_NAME])),P=$('<dd class="text-muted">').text(o[kTAG_COUNTER_PROCESSED][kAPI_PARAM_RESPONSE_FRMT_VALUE]);$("#dl_right").html(f).append(P)}$.obj_len(o[kTAG_COUNTER_VALIDATED])>0&&($dt_validated=$('<dt class="text-success">').text(i18n[lang].messages.upload.summary.total.replace("%",o[kTAG_COUNTER_VALIDATED][kAPI_PARAM_RESPONSE_FRMT_NAME])),$dd_validated=$('<dd class="text-success">').text(o[kTAG_COUNTER_VALIDATED][kAPI_PARAM_RESPONSE_FRMT_VALUE]),$("#dl_right").append($dt_validated).append($dd_validated)),$.obj_len(o[kTAG_COUNTER_REJECTED])>0&&($dt_rejected=$('<dt class="text-danger">').text(i18n[lang].messages.upload.summary.total.replace("%",o[kTAG_COUNTER_REJECTED][kAPI_PARAM_RESPONSE_FRMT_NAME])),$dd_rejected=$('<dd class="text-danger">').text(o[kTAG_COUNTER_REJECTED][kAPI_PARAM_RESPONSE_FRMT_VALUE]),$("#dl_right").append($dt_rejected).append($dd_rejected)),$.obj_len(o[kTAG_COUNTER_SKIPPED])>0&&($dt_skipped=$('<dt class="text-warning">').text(i18n[lang].messages.upload.summary.total.replace("%",o[kTAG_COUNTER_SKIPPED][kAPI_PARAM_RESPONSE_FRMT_NAME])),$dd_skipped=$('<dd class="text-warning">').text(o[kTAG_COUNTER_SKIPPED][kAPI_PARAM_RESPONSE_FRMT_VALUE]),$("#dl_right").append($dt_skipped).append($dd_skipped)),$.obj_len(o[kTAG_COUNTER_RECORDS])>0&&($dt_records=$('<dt class="total">').text(i18n[lang].messages.upload.summary.total.replace("%",o[kTAG_COUNTER_RECORDS][kAPI_PARAM_RESPONSE_FRMT_NAME])),$dd_records=$('<dd class="total">').text(o[kTAG_COUNTER_RECORDS][kAPI_PARAM_RESPONSE_FRMT_VALUE]),$("#dl_right").append("<hr />").append($dt_records).append($dd_records));var T=void 0!==o[kTAG_COUNTER_PROGRESS]?parseInt(o[kTAG_COUNTER_PROGRESS][kAPI_PARAM_RESPONSE_FRMT_DISP]):100;$.set_progress_bar(T,session_status_class),console.warn(l),$.each(o[kAPI_PARAM_RESPONSE_FRMT_DOCU],function(e,t){console.info(e,t);var s=void 0!==t[kTAG_COUNTER_PROGRESS]?parseInt(t[kTAG_COUNTER_PROGRESS][kAPI_PARAM_RESPONSE_FRMT_DISP]):100,_="",l="fa-2x";switch($.trim(t[kTAG_TRANSACTION_STATUS][kAPI_PARAM_RESPONSE_FRMT_VALUE])){case kTYPE_STATUS_FAILED:case kTYPE_STATUS_ERROR:case kTYPE_STATUS_FATAL:case kTYPE_STATUS_EXCEPTION:i="list-group-item-danger",n="danger",r="fa-times";break;case kTYPE_STATUS_EXECUTING:i="",r="fa-refresh fa-spin text-muted";break;case kTYPE_STATUS_OK:i="list-group-item-success",n="success",r="fa-check";break;case kTYPE_STATUS_MESSAGE:i="list-group-item-info",n="info",r="fa-info";break;case kTYPE_STATUS_WARNING:i="list-group-item-warning",n="warning",r="fa-exclamation-triangle"}var o;$.obj_len(t[kTAG_COUNTER_SKIPPED])>0&&(i="list-group-item-warning",_="progress-bar-warning",r="fa-exclamation-triangle",l="fa-1_5x"),$.obj_len(t[kTAG_COUNTER_REJECTED])>0&&(i="list-group-item-danger",_="progress-bar-danger",r="fa-times"),o=$(0===$("#"+$.md5(t[kTAG_TRANSACTION_TYPE][kAPI_PARAM_RESPONSE_FRMT_DISP][kAPI_PARAM_RESPONSE_FRMT_DISP])).length?'<div id="'+$.md5(t[kTAG_TRANSACTION_TYPE][kAPI_PARAM_RESPONSE_FRMT_DISP][kAPI_PARAM_RESPONSE_FRMT_DISP])+'">':"#"+$.md5(t[kTAG_TRANSACTION_TYPE][kAPI_PARAM_RESPONSE_FRMT_DISP][kAPI_PARAM_RESPONSE_FRMT_DISP])),o.attr("class","list-group-item"+(""!==i?" "+i:""));var d,c=new Date(1e3*t[kTAG_TRANSACTION_START][kAPI_PARAM_RESPONSE_FRMT_VALUE].sec),p=0,A="",u=0,g="",E=0,f="",P=0,T="",m=0,R="";$.obj_len(t[kTAG_TRANSACTION_END])>0&&(d=new Date(1e3*t[kTAG_TRANSACTION_END][kAPI_PARAM_RESPONSE_FRMT_VALUE].sec)),$.obj_len(t[kTAG_COUNTER_PROCESSED])&&(p=t[kTAG_COUNTER_PROCESSED][kAPI_PARAM_RESPONSE_FRMT_VALUE],A=t[kTAG_COUNTER_PROCESSED][kAPI_PARAM_RESPONSE_FRMT_NAME]),$.obj_len(t[kTAG_COUNTER_VALIDATED])&&(u=t[kTAG_COUNTER_VALIDATED][kAPI_PARAM_RESPONSE_FRMT_VALUE],g=t[kTAG_COUNTER_VALIDATED][kAPI_PARAM_RESPONSE_FRMT_NAME]),$.obj_len(t[kTAG_COUNTER_REJECTED])&&(E=t[kTAG_COUNTER_REJECTED][kAPI_PARAM_RESPONSE_FRMT_VALUE],f=t[kTAG_COUNTER_REJECTED][kAPI_PARAM_RESPONSE_FRMT_NAME]),$.obj_len(t[kTAG_COUNTER_SKIPPED])&&(P=t[kTAG_COUNTER_SKIPPED][kAPI_PARAM_RESPONSE_FRMT_VALUE],T=t[kTAG_COUNTER_SKIPPED][kAPI_PARAM_RESPONSE_FRMT_NAME]),$.obj_len(t[kTAG_COUNTER_RECORDS])&&(m=t[kTAG_COUNTER_RECORDS][kAPI_PARAM_RESPONSE_FRMT_VALUE],R=t[kTAG_COUNTER_RECORDS][kAPI_PARAM_RESPONSE_FRMT_NAME]);var k=s>=100?""!==_?_:"progress-bar-success":"danger"==a?"progress-bar-danger":"progress-bar-info progress-bar-striped active";$item_row_container=$("<div>"),$item_row=$('<div class="row">'),$item_col1=$('<div class="col-sm-1">'),$item_col2=$('<div class="col-sm-5">'),$item_col2a=$('<div class="col-sm-1 text-right">'),$item_col2b=$('<div class="col-sm-2 text-right text-muted">'),$item_col3=$('<div class="col-sm-3">'),$item_title=$('<h4 class="list-group-item-heading">').text(t[kTAG_TRANSACTION_TYPE][kAPI_PARAM_RESPONSE_FRMT_DISP][kAPI_PARAM_RESPONSE_FRMT_DISP]),$item_processed=$('<p class="text-muted" title="'+i18n[lang].messages.upload.summary.processed+'">').html('<span class="fa fa-cogs"></span> '+p+" "+A),$item_validated=$('<p class="text-success" title="'+i18n[lang].messages.upload.summary.validated+'">').html('<span class="fa fa-fw fa-check-circle-o"></span> '+u+" "+g),$item_rejected=$('<p class="text-danger" title="'+i18n[lang].messages.upload.summary.rejected+'">').html('<span class="fa fa-fw fa-times-circle"></span> '+E+" "+f),$item_skipped=$('<p class="text-warning" title="'+i18n[lang].messages.upload.summary.skipped+'">').html('<span class="fa fa-fw fa-exclamation-circle"></span> '+P+" "+T),$item_records=$('<p class="total" title="'+i18n[lang].messages.upload.summary.records+'">').html('<span class="fa fa-fw fa-list-alt"></span> '+m+" "+R),$item_status=$("<small>"),$item_time_data=$("<small>").html('<span title="Start date"><span class="fa fa-clock-o"></span> '+$.epoch2locale(c)+"</span><br />"),$.obj_len(t[kTAG_TRANSACTION_END])>0&&$item_time_data.append('<span title="End date"><span class="fa fa-clock-o"></span> '+d.toLocaleString()+"</span>");var h=$('<div class="progress">'),I=$('<div style="width: '+s+'%;" aria-valuemax="100" aria-valuemin="0" aria-valuenow="'+s+'" role="progressbar" class="progress-bar '+k+'">').text(s+"%");$item_col1.append('<span class="fa '+r+" "+l+'"></span>'),$item_col1.find("span").addClass(""),$item_col2.append($item_title),$.obj_len(t[kTAG_COUNTER_PROCESSED])&&$item_status.append($item_processed),$.obj_len(t[kTAG_COUNTER_VALIDATED])&&$item_status.append($item_validated),$.obj_len(t[kTAG_COUNTER_REJECTED])&&$item_status.append($item_rejected),$.obj_len(t[kTAG_COUNTER_SKIPPED])&&$item_status.append($item_skipped),$.obj_len(t[kTAG_COUNTER_RECORDS])&&$item_status.append("<hr />").append($item_records),$item_col2a.append($item_status),$item_col2b.append($item_time_data),h.append(I),$item_col3.append(h),$item_row.append($item_col1),$item_row.append($item_col2),$item_row.append($item_col2a),$item_row.append($item_col2b),$item_row.append($item_col3),$item_row_container.append($item_row),o.html($item_row_container.html()),$("#detail_list_group").append(o),$("#transactions").hasClass("in")}),100>T&&"danger"!==a?setTimeout(function(){$.build_interface(e)},1e3):($("#progress_bar").removeClass("progress-bar-striped").removeClass("progress-bar-info").removeClass("active").addClass("progress-bar-success"),"success"==a&&($("#details_btn").collapse_details(),alert("Completed!")))});var l=$("#progress_supercontainer"),o=l.offset().top-parseFloat(l.css("marginTop").replace(/auto/,0))-70;$("#content").scroll(function(){var e=$(this).scrollTop();e>=o?l.addClass("fixed"):l.removeClass("fixed")})},$.fn.add_previous_upload_session=function(){var e=$(this),a=$('<div class="top_content_label">'),t=$("<h1>").text(i18n[lang].messages.last_upload);$.get_errors(function(e){console.log(e)}),a.append(t),e.prepend(a)},$.log_activity=function(e){var a=[],t={};$.storage_exists("pgrdg_user_cache.user_activity")&&(a=storage.get("pgrdg_user_cache.user_activity")),t[e]=$.now(),a.push(t),storage.set("pgrdg_user_cache.user_activity",a),$("span.timeago").timeago()},$.last_activity=function(e){e=void 0===e?!1:e;var a="";if($.storage_exists("pgrdg_user_cache.user_activity")){a=storage.get("pgrdg_user_cache.user_activity");var t=a[a.length-1];$.each(t,function(t,s){a=e?$.ucfirst(t)+": "+s:s})}else a=e?"Loaded page (no registered previous data): "+$.now():$.now();return a},$.set_breadcrumb=function(){$.fn.set_user_name=function(e){$(this).text($.get_user_full_name(e))};var e=$.url().fsegment(),a=$(0===$("#ribbon > ol.breadcrum").length?'<ol class="breadcrumb">':"#ribbon > ol.breadcrum"),t=$("<li>").addClass("home"),s=$("Profile"==current_path?'<a href="./Profile#'+$.get_manager_id()+'">':'<a href="./'+current_path+'">'),_=$("<li>");$("#ribbon > ol.breadcrum").remove(),s.text(current_path),t.html(s),a.html(t),$.each(e,function(t,s){40==s.length&&($.storage_exists("pgrdg_user_cache.user_data.all."+s)?_.set_user_name(storage.get("pgrdg_user_cache.user_data.all."+s)):$.get_user(s,!1,function(e){_.set_user_name(e)}),void 0!==e[1]&&40==e[1].length&&(hash_title=e[1]),a.append(_))}),$("#ribbon").html(a)},$(document).ready(function(){switch($.set_breadcrumb(),$(window).on("hashchange",function(){$.set_breadcrumb()}).trigger("hashchange"),current_path){case"Profile":{$("<button/>").addClass("btn btn-primary").prop("disabled",!0).text("Processing...").on("click",function(){var e=$(this),a=e.data();e.off("click").text("Abort").on("click",function(){e.remove(),a.abort()}),a.submit().always(function(){e.remove()})})}$("#loader").addClass("decrypt").show(),$.load_profile(),$(window).on("hashchange",function(){$.load_profile()}).trigger("hashchange"),$("span.timeago").attr("title",$.last_activity()).text($.last_activity(!0)).timeago(),$.add_storage_space_in_panel("Non-logged memory","pgrdg_cache"),$.add_storage_space_in_panel("User memory","pgrdg_user_cache"),$("#upload_btn").hover(function(){$("#upload_btn div").css("visibility","visible")},function(){$("#upload_btn div").css("visibility","hidden")});break;case"Invite":$("#loader").show(),$.generate_invite_form();break;case"Menu":break;case"Pages":$.fn.cyclate_pages=function(e,a,t){$.random_colour=function(){return Math.floor(256*Math.random())+","+Math.floor(156*Math.random())+","+Math.floor(156*Math.random())
};var s;storage.isSet("pgrdg_cache.local.info")&&(s=storage.get("pgrdg_cache.local.info")),(void 0===a||null===a||""===a)&&(a=!1),(void 0===t||null===t||""===t)&&(t=""),$.obj_len(e.subpages)>0&&(colour=$.random_colour());var _=$(this),n=$('<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">'),i=$("<a>").attr({href:"javascript:void(0);",onclick:"$.edit_page('"+JSON.stringify(e)+"', '"+JSON.stringify(s)+"');","class":"big_btn","data-content":"",style:function(){return $.obj_len(e.subpages)>0?"box-shadow: 0 0 9px rgb("+colour+") inset;":a?"":"box-shadow: 0 0 9px rgba("+colour+", 0.35) inset;"},title:"Edit this page"}),r=$('<div class="folded">'),l=$("<img>").attr({src:"data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs%3D"}),o=$('<div class="big_btn_title">'),d=$('<span class="title fittext">').html(e.title+(a?"":"<small>subpage of "+t+"</small>")).fitText(1.2,{minFontSize:"20px",maxFontSize:"40px"}),c=$('<div class="icons_list">'),p=$('<span class="fa fa-'+(e.need_login?"lock":"unlock")+'">'),A=$('<span class="fa fa-'+(e.is_visible?"eye":"eye-slash")+'">'),u=$('<span class="fa fa-'+(e.subpages?"files-o":"file-o")+'">');c.append(p),c.append(A),a||c.append('<span class="fa fa-indent"></span>'),c.append(u),o.append(d),o.append(c),r.append(l),i.append(r),i.append(o),n.append(i),_.append(n),$.obj_len(e.subpages)>0&&$.each(e.subpages,function(a,t){_.cyclate_pages(t,!1,e.title)}),$.ajax({url:"https://www.googleapis.com/pagespeedonline/v1/runPagespeed?url=http://pgrdiversity.bioversityinternational.org/"+e.address+"&screenshot=true",context:this,type:"GET",dataType:"json",success:function(e){e=e.screenshot.data.replace(/_/g,"/").replace(/-/g,"+"),l.attr("src","data:image/jpeg;base64,"+e)}})},$.get_all_pages_config(function(e){var a=$('<div class="row">');$.each(e.pages,function(e,t){void 0===t.is_backend||t.is_backend||(a.cyclate_pages(t,!0),$("#page_management").html(a))})});break;case"Upload":$.upload_user_status(function(e){if(console.log("OK",e),e[kAPI_SESSION_RUNNING])$("#upload").added_file(),$.build_interface(e[kAPI_SESSION_ID]);else{void 0!==e[kAPI_SESSION_ID]&&null!==e[kAPI_SESSION_ID]&&""!==e[kAPI_SESSION_ID]&&$("#contents").add_previous_upload_session(e[kAPI_SESSION_ID]),storage.remove("pgrdg_user_cache.user_data.undefined"),$.clean_file_name=function(e){return e=e.replace(/\./g,""),e.replace(/\//g,"-").replace(/\:/g,"~").replace(/\s/g,"_")};var a=$("<div>"),t=$("<form>").attr({action:"","class":"dropzone",id:"dropzone"}),s=$("<input>").attr({type:"hidden",name:"user_id",value:$.get_current_user_id()});t.append(s),a.append(t),$("#upload").html(a.html()),$("#upload form").dropzone({autoDiscover:!1,sendingmultiple:!1,acceptedFiles:".xls,.xlsx,.ods",autoProcessQueue:!0,clickable:!0,dictDefaultMessage:'<span class="fa fa-cloud-upload fa-5x text-muted"></span><br /><br />Drop file here to upload',init:function(){this.on("processing",function(e){var a=e.name.split(".").pop().toLowerCase(),t=$.trim($.clean_file_name(e.name.replace(a,"")))+"."+a;this.options.url="/API/?upload="+t})},addedfile:function(){$("#upload").added_file()},uploadprogress:function(e,a){$.set_progress_bar(a)},success:function(e){var a=e.name.split(".").pop().toLowerCase(),t=$.trim($.clean_file_name(e.name.replace(a,"")))+"."+a,s="/var/www/pgrdg/"+config.service.path.gpg+$.get_current_user_id()+"/uploads/"+t;$.set_progress_bar("pending"),$.inform_upload_was_done(s,function(e){$.build_interface(e)})}})}})}});