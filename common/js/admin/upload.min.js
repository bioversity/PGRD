$.get_current_session_id=function(){return $.storage_exists("pgrdg_user_cache.user_data.current.last_upload_session_id")?storage.get("pgrdg_user_cache.user_data.current.last_upload_session_id"):void 0},$.get_records=function(e){return e[kTAG_COUNTER_RECORDS][kAPI_PARAM_RESPONSE_FRMT_VALUE]},$.get_processed=function(e){return void 0!==e[kTAG_COUNTER_PROCESSED]?e[kTAG_COUNTER_PROCESSED][kAPI_PARAM_RESPONSE_FRMT_VALUE]:0},$.get_validated=function(e){return void 0!==e[kTAG_COUNTER_VALIDATED]?e[kTAG_COUNTER_VALIDATED][kAPI_PARAM_RESPONSE_FRMT_VALUE]:0},$.get_skipped=function(e){return void 0!==e[kTAG_COUNTER_SKIPPED]?e[kTAG_COUNTER_SKIPPED][kAPI_PARAM_RESPONSE_FRMT_VALUE]:0},$.get_rejected=function(e){return void 0!==e[kTAG_COUNTER_REJECTED]?e[kTAG_COUNTER_REJECTED][kAPI_PARAM_RESPONSE_FRMT_VALUE]:0},$.get_records_name=function(e){return e[kTAG_COUNTER_RECORDS][kAPI_PARAM_RESPONSE_FRMT_NAME]},$.get_processed_name=function(e){return void 0!==e[kTAG_COUNTER_PROCESSED]?e[kTAG_COUNTER_PROCESSED][kAPI_PARAM_RESPONSE_FRMT_NAME]:""},$.get_validated_name=function(e){return void 0!==e[kTAG_COUNTER_VALIDATED]?e[kTAG_COUNTER_VALIDATED][kAPI_PARAM_RESPONSE_FRMT_NAME]:""},$.get_skipped_name=function(e){return void 0!==e[kTAG_COUNTER_SKIPPED]?e[kTAG_COUNTER_SKIPPED][kAPI_PARAM_RESPONSE_FRMT_NAME]:""},$.get_rejected_name=function(e){return void 0!==e[kTAG_COUNTER_REJECTED]?e[kTAG_COUNTER_REJECTED][kAPI_PARAM_RESPONSE_FRMT_NAME]:""},$.get_progress=function(e){return void 0!==e[kTAG_COUNTER_PROGRESS]?e[kTAG_COUNTER_PROGRESS][kAPI_PARAM_RESPONSE_FRMT_VALUE]:""},$.has_validated=function(e){return $.get_validated(e)>0?!0:!1},$.has_skipped=function(e){return $.get_skipped(e)>0?!0:!1},$.has_rejected=function(e){return $.get_rejected(e)>0?!0:!1},$.get_filename=function(e){var a=e.split("/").pop(),s=a.split(".").pop().toLowerCase();return $.trim($.clean_file_name(a.replace(s,"")))+"."+s},$.force_download=function(e){window.location="API/?download="+$.utf8_to_b64(e),$.log_activity({action:"Downloaded file "+$.get_filename(e),icon:"fa-download"})},$.download_last_uploaded_file=function(e){"object"!==$.type(e);var a=e.filename[kAPI_PARAM_RESPONSE_FRMT_VALUE].split("/").pop(),s=a.split(".").pop().toLowerCase();a=$.trim($.clean_file_name(a.replace(s,"")))+"."+s;var t=$.get_current_user_id()+"/uploads/"+a;file_content_type=e.contentType[kAPI_PARAM_RESPONSE_FRMT_VALUE],file_length=e.length[kAPI_PARAM_RESPONSE_FRMT_VALUE],$.log_activity({action:"Downloaded file "+a,icon:"fa-download"}),window.location="API/?download_template="+$.utf8_to_b64(t)},$.fn.update_btn=function(e){$(this).dropzone({autoDiscover:!1,sendingmultiple:!1,acceptedFiles:".xls,.xlsx,.ods",autoProcessQueue:!0,clickable:"#update_btn",dictDefaultMessage:'<span class="fa fa-cloud-upload fa-5x text-muted"></span><br /><br />'+i18n[lang].messages.drop_file_here,init:function(){this.on("processing",function(e){var a=e.name.split(".").pop().toLowerCase(),s=$.trim($.clean_file_name(e.name.replace(a,"")))+"."+a;this.options.url="/API/?upload="+s})},addedfile:function(){$.log_activity({action:"Started update of session: "+e,icon:"fa-upload"}),$("#upload").added_file()},uploadprogress:function(e,a){$.set_progress_bar(a)},success:function(e){var a=e.name.split(".").pop().toLowerCase(),s=$.trim($.clean_file_name(e.name.replace(a,"")))+"."+a,t="/var/www/pgrdg/"+config.service.path.gpg+$.get_current_user_id()+"/uploads/"+s;$.set_progress_bar("pending"),$.inform_upload_was_done(t,function(e){$.build_interface(e)})}})},$.upload_user_status=function(e){var a={};a[kAPI_REQUEST_USER]=$.get_current_user_id(),$.ask_cyphered_to_service({data:a,type:"upload_user_status",force_renew:!0},function(a){null!==a&&($.storage_exists("pgrdg_user_cache.user_data.current.last_upload_session_id")&&$.get_current_session_id()===a[kAPI_SESSION_ID]||storage.set("pgrdg_user_cache.user_data.current.last_upload_session_id",a["session-id"])),"function"==typeof e&&e.call(this,a)})},$.get_session_status=function(e,a){if("string"==$.type(e)){var s={};s[kAPI_REQUEST_USER]=$.get_current_user_id(),s[kAPI_PARAM_ID]=e,$.ask_cyphered_to_service({data:s,type:"upload_session_status",force_renew:!0},function(e){"function"==typeof a&&a.call(this,e)})}else{if(void 0===a||null===a||""===a)return e[kTAG_SESSION_STATUS][kAPI_PARAM_RESPONSE_FRMT_VALUE];"function"==$.type(a)}},$.set_progress_bar=function(e,a){(null===a||void 0===a||""===a)&&(a="progress-bar-info"),"pending"==e?$("#progress_bar").attr("class","progress-bar progress-bar-striped progress-bar-warning active").css("width","100%").attr("aria-valuenow",100).text("Processing file..."):$("#progress_bar").addClass("active").switchClass("progress-bar-warning",a).css("width",e+"%").attr("aria-valuenow",e).text(e+"%")},$.fn.added_file=function(){var e=$(this),a=$("<h1>"),s=$("<a>").attr({href:"javascript:void(0);",onclick:"$.init_upload();","class":"back_btn text-default",title:i18n[lang].interface.btns.back_to_main_upload}).tooltip({placement:"bottom"}).text(i18n[lang].messages.template_upload);$info_row=$('<div class="row">'),$left_col=$('<div class="col-xs-6 col-sm-7 col-md-6 col-lg-10">'),$righ_col=$('<div class="col-xs-6 col-sm-5 col-md-4 col-lg-3 col-lg-2 text-right">'),$details_row=$('<div id="details_row" class="row hidden">'),$dl_left=$('<dl id="dl_left" class="dl-horizontal">'),$dl_right=$('<dl id="dl_right" class="dl-horizontal">'),$progress_supercontainer=$('<div id="progress_supercontainer">'),$progrtess_container_title=$("<h2>").text(i18n[lang].messages.template_upload),$progress_container=$('<div id="progress_container" class="progress">'),$progress_bar=$("<div>").attr({style:"width: 100%;","aria-valuemax":"100","aria-valuemin":"0","aria-valuenow":"100",role:"progressbar","class":"progress-bar progress-bar-warning progress-bar-striped active",id:"progress_bar"}).text("Processing file..."),$detail_link_col=$('<div class="col-sm-12">'),$detail_col=$('<div id="transactions" class="col-sm-12 panel-collapse collapse in">'),$detail_link=$("<a>").attr({href:"javascript:void(0);",onclick:"$(this).collapse_details();",id:"details_btn"}).html("Details"),$transaction_content=$('<div class="panel-body">'),$detail_list_group=$('<div id="detail_list_group" class="list-group">'),$detail_link_col.append('<span class="fa fa-fw fa-caret-down"></span> ').append($detail_link),$progress_container.append($progress_bar),$progress_supercontainer.append($progrtess_container_title),$progress_supercontainer.append($progress_container),$left_col.append($dl_left),$righ_col.append($dl_right),$info_row.append($left_col),$info_row.append($righ_col),$info_row.append($left_col),$info_row.append($righ_col),$transaction_content.append($detail_list_group),$detail_col.append($transaction_content),$details_row.append($detail_link_col),$details_row.append($detail_col),e.html(""),a.append(s),e.append(a).append($info_row).append($progress_supercontainer).append($details_row),$(".top_content_label").remove(),$("#contents").removeClass("upload"),$("#dropzone").remove()},$.inform_upload_was_done=function(e,a){var s={};s[kAPI_REQUEST_USER]=$.get_current_user_id(),s[kAPI_PARAM_FILE_PATH]=e,$.ask_cyphered_to_service({data:s,type:"upload_file",force_renew:!0},function(e){var s=e[kAPI_SESSION_ID];storage.set("pgrdg_user_cache.user_data.current.last_upload_session_id",e[kAPI_SESSION_ID]),"function"==typeof a&&a.call(this,s)})},$.publish_data=function(){$.require_password(function(){storage.remove("pgrdg_user_cache.user_data.current.last_upload_session_id"),$("#upload .back_btn").text(i18n[lang].messages.data_publishing),$("#detail_list_group").html(""),$("#dl_left").html(""),$("#dl_right").html(""),$("#progress_container > #progress_bar").switchClass("progress-bar-success","progress-bar-info").addClass("progress-bar-striped active").attr({style:"width: 0%;","aria-valuenow":0}).text("0%"),$("#finished_upload").remove();var e={};e[kAPI_REQUEST_USER]=$.get_current_user_id(),$.ask_cyphered_to_service({data:e,type:"upload_publish_data",force_renew:!0},function(e){$.build_interface(e[kAPI_SESSION_ID],!0);var a=config;a.site.timestamp=(new Date).getTime(),$.update_config(a),$.log_activity({action:"Published data for the upload session id: "+status[kAPI_SESSION_ID],icon:"fa-certificate"})})})},$.group_transaction=function(e,a){var s=$.extend({session_id:$.get_current_session_id(),user_id:$.get_current_user_id(),params:[]},e),t={};t[kAPI_REQUEST_USER]=s.user_id,t[kAPI_PARAM_ID]=s.session_id,void 0!==s.session_id&&(t[kAPI_PARAM_ID]=s.session_id),$.obj_len(s.params)>0&&(t[kAPI_PARAM_GROUP_TRANS]=s.params),$.ask_cyphered_to_service({data:t,type:"upload_group_transaction",force_renew:!0},function(e){"function"==typeof a&&a.call(this,e)})},$.fn.nest_collapsible=function(e,a){var s=$.extend({id:$.makeid(),k:0,v:{},string_class:"text-default",session_id:$.get_current_session_id(),params:{}},e),t=$(this),_=(s.id,t.closest("li")),n=$("<a>").attr({href:"javascript:void(0);","class":"text-default","data-target":"#"+s.id,title:s.v[kAPI_PARAM_RESPONSE_FRMT_INFO]}).on("click",function(){0===$("#"+s.id).html().length&&$("#"+s.id).addClass("text-muted").html('<span class="fa fa-fw fa-refresh fa-spin"></span> '+i18n[lang].messages.loading_session_status),$("#"+s.id).prev("h4").toggleClass("hidden"),$("#"+s.id).collapse("toggle"),_.find("span.fa-li:first").toggleClass("fa-caret-right fa-caret-down"),0===$("#"+s.id).find("li").length&&"function"==typeof a&&a.call(this,s)}).html($.highlight(s.v[kAPI_PARAM_RESPONSE_FRMT_DOCU][s.k][kAPI_PARAM_RESPONSE_FRMT_DISP])+' <sup class="'+s.string_class+'"><b>'+s.v[kAPI_PARAM_RESPONSE_FRMT_DOCU][s.k][kAPI_PARAM_RESPONSE_COUNT]+"</b></sup>").tooltip({placement:"right"}),i=$('<ul id="'+s.id+'" class="collapse fa-ul empty" aria-expanded="false">');_=$("<li>").html('<span class="fa fa-li fa-caret-right"></span>').append(n).append(i),t.append(_)},$.fn.collapse_details=function(){var e=$(this);e.hasClass("disabled")||(e.prev().toggleClass("fa-caret-right fa-caret-down"),$("#transactions").collapse("toggle"))},$.fn.add_session_progress_row=function(e){$.readable_time=function(e){if(void 0!==e){return void 0!==e[kAPI_PARAM_RESPONSE_FRMT_VALUE]?new Date(1e3*e[kAPI_PARAM_RESPONSE_FRMT_VALUE].sec):void 0!==e[kAPI_PARAM_RESPONSE_FRMT_DISP]?e[kAPI_PARAM_RESPONSE_FRMT_DISP]:""}return""};var a=$(this),s=void 0!==e[kAPI_PARAM_RESPONSE_FRMT_DOCU]?e[kAPI_PARAM_RESPONSE_FRMT_DOCU]:e;$.each(s,function(e,s){var t=void 0!==s[kTAG_COUNTER_PROGRESS]?parseInt(s[kTAG_COUNTER_PROGRESS][kAPI_PARAM_RESPONSE_FRMT_DISP]):100,_="",n="fa-1_5x";if(void 0!==s[kTAG_TRANSACTION_STATUS]){switch($.trim(s[kTAG_TRANSACTION_STATUS][kAPI_PARAM_RESPONSE_FRMT_VALUE])){case kTYPE_STATUS_FAILED:case kTYPE_STATUS_ERROR:case kTYPE_STATUS_FATAL:case kTYPE_STATUS_EXCEPTION:current_status_class="list-group-item-danger",current_status="danger",current_status_icon="fa-times";break;case kTYPE_STATUS_EXECUTING:current_status_class="",current_status_icon="fa-refresh fa-spin text-muted";break;case kTYPE_STATUS_OK:current_status_class="list-group-item-success",current_status="success",current_status_icon="fa-check";break;case kTYPE_STATUS_MESSAGE:current_status_class="list-group-item-info",current_status="info",current_status_icon="fa-info";break;case kTYPE_STATUS_WARNING:current_status_class="list-group-item-warning",current_status="warning",current_status_icon="fa-exclamation-triangle"}"Fatal error"==s[kTAG_TRANSACTION_STATUS][kAPI_PARAM_RESPONSE_FRMT_DISP][kAPI_PARAM_RESPONSE_FRMT_DISP]&&(current_status_class="list-group-item-danger",current_status="danger",current_status_icon="fa-times");var i;$.obj_len(s[kTAG_COUNTER_SKIPPED])>0&&(current_status_class="list-group-item-warning",_="progress-bar-warning",current_status_icon="fa-exclamation-triangle",n="fa-1_5x"),$.obj_len(s[kTAG_COUNTER_REJECTED])>0&&(current_status_class="list-group-item-danger",_="progress-bar-danger",current_status_icon="fa-times"),i=$(0===$("#"+$.md5(s[kTAG_TRANSACTION_TYPE][kAPI_PARAM_RESPONSE_FRMT_DISP][kAPI_PARAM_RESPONSE_FRMT_DISP])).length?'<div id="'+$.md5(s[kTAG_TRANSACTION_TYPE][kAPI_PARAM_RESPONSE_FRMT_DISP][kAPI_PARAM_RESPONSE_FRMT_DISP])+'">':"#"+$.md5(s[kTAG_TRANSACTION_TYPE][kAPI_PARAM_RESPONSE_FRMT_DISP][kAPI_PARAM_RESPONSE_FRMT_DISP])),i.attr("class","list-group-item"+(""!==current_status_class?" "+current_status_class:""));var l=$.readable_time(s[kTAG_TRANSACTION_START]),r=$.readable_time(s[kTAG_TRANSACTION_END]),o=0,d="",p=0,c="",A=0,S="",T=0,E="",u=0,R="";$.obj_len(s[kTAG_COUNTER_PROCESSED])&&(o=$.get_processed(s),d=$.get_processed_name(s)),$.obj_len(s[kTAG_COUNTER_VALIDATED])&&(p=$.get_validated(s),c=$.get_validated_name(s)),$.obj_len(s[kTAG_COUNTER_REJECTED])&&(A=$.get_rejected(s),S=$.get_rejected_name(s)),$.obj_len(s[kTAG_COUNTER_SKIPPED])&&(T=$.get_skipped(s),E=$.get_skipped_name(s)),$.obj_len(s[kTAG_COUNTER_RECORDS])&&(u=$.get_records(s),R=$.get_records_name(s));var P=t>=100?""!==_?_:"progress-bar-success":"danger"==status?"progress-bar-danger":"progress-bar-info progress-bar-striped active";$item_row_container=$("<div>"),$item_row=$('<div class="row">'),$item_col1=$('<div class="col-sm-1">'),$item_col2=$('<div class="col-sm-4">'),$item_col2a=$('<div class="col-sm-2 text-right">'),$item_col2b=$('<div class="col-sm-2 text-right text-muted">'),$item_col3=$('<div class="col-sm-3">'),$item_title=$('<h4 class="list-group-item-heading">').text(s[kTAG_TRANSACTION_TYPE][kAPI_PARAM_RESPONSE_FRMT_DISP][kAPI_PARAM_RESPONSE_FRMT_DISP]),$item_processed=$('<p class="text-muted" title="'+i18n[lang].messages.upload.summary.processed+'">').html('<span class="fa fa-cogs"></span> '+o+" "+d),$item_validated=$('<p class="text-success" title="'+i18n[lang].messages.upload.summary.validated+'">').html('<span class="fa fa-fw fa-check-circle-o"></span> '+p+" "+c),$item_rejected=$('<p class="text-danger" title="'+i18n[lang].messages.upload.summary.rejected+'">').html('<span class="fa fa-fw fa-times-circle"></span> '+A+" "+S),$item_skipped=$('<p class="text-warning" title="'+i18n[lang].messages.upload.summary.skipped+'">').html('<span class="fa fa-fw fa-exclamation-circle"></span> '+T+" "+E),$item_records=$('<p class="total" title="'+i18n[lang].messages.upload.summary.records+'">').html('<span class="fa fa-fw fa-list-alt"></span> '+u+" "+R),$item_status=$("<small>"),$item_time_data=$("<small>").html('<span title="Start date"><span class="fa fa-clock-o"></span> '+$.epoch2locale(l)+"</span><br />"),$.obj_len(s[kTAG_TRANSACTION_END])>0&&$item_time_data.append('<span title="End date"><span class="fa fa-clock-o"></span> '+r.toLocaleString()+"</span>");var f=$('<div class="progress">'),g=$('<div style="width: '+t+'%;" aria-valuemax="100" aria-valuemin="0" aria-valuenow="'+t+'" role="progressbar" class="progress-bar '+P+'">').text(t+"%");$item_col1.append('<span class="fa '+current_status_icon+" "+n+'"></span>'),$item_col1.find("span").addClass(""),$item_col2.append($item_title),$.obj_len(s[kTAG_COUNTER_PROCESSED])&&$item_status.append($item_processed),$.obj_len(s[kTAG_COUNTER_VALIDATED])&&$item_status.append($item_validated),$.obj_len(s[kTAG_COUNTER_REJECTED])&&$item_status.append($item_rejected),$.obj_len(s[kTAG_COUNTER_SKIPPED])&&$item_status.append($item_skipped),$.obj_len(s[kTAG_COUNTER_RECORDS])&&$item_status.append("<hr />").append($item_records),$item_col2a.append($item_status),$item_col2b.append($item_time_data),f.append(g),$item_col3.append(f),$item_row.append($item_col1),$item_row.append($item_col2),$item_row.append($item_col2a),$item_row.append($item_col2b),$item_row.append($item_col3),$item_row_container.append($item_row),i.append($item_row_container),a.append(i)}if(void 0!==s[kTAG_TRANSACTION_LOG]&&$.obj_len(s[kTAG_TRANSACTION_LOG])>0&&$.each(s[kTAG_TRANSACTION_LOG][kAPI_PARAM_RESPONSE_FRMT_DOCU],function(e,s){var t=s[kAPI_PARAM_RESPONSE_FRMT_DOCU],_=void 0!==t[kTAG_TRANSACTION_ALIAS]?t[kTAG_TRANSACTION_ALIAS][kAPI_PARAM_RESPONSE_FRMT_INFO]:"",n=void 0!==t[kTAG_TRANSACTION_ALIAS]?t[kTAG_TRANSACTION_ALIAS][kAPI_PARAM_RESPONSE_FRMT_DISP]:"";console.log(t),k=$('<div class="list-group subgroup_log">'),$list_subgroup_item=$('<div class="list-group-item">'),$h4=$('<h4 class="list-group-item-heading">'),$icon_info=$('<span class="fa fa-info-circle fa-fw fa-1_5x text-muted pull-left"></span>'),$alias=$('<span class="text-info" title="'+_+'">').text(n+": "),$message=$("<span>").text(t[kTAG_TRANSACTION_MESSAGE][kAPI_PARAM_RESPONSE_FRMT_DISP]),$p=$('<small class="help-block">').html("[error: "+t[kTAG_ERROR_CODE][kAPI_PARAM_RESPONSE_FRMT_DISP]+"] <i>"+t[kTAG_ERROR_TYPE][kAPI_PARAM_RESPONSE_FRMT_DISP]+"</i>"),$h4.append($icon_info).append($alias).append($message).append($p),$list_subgroup_item.append($h4),k.append($list_subgroup_item),a.append(k)}),void 0!==s[kAPI_PARAM_RESPONSE_FRMT_DOCU]&&$.obj_len(s[kAPI_PARAM_RESPONSE_FRMT_DOCU])>0){var k=$('<div class="list-group subgroup">');k.add_session_progress_row(s[kAPI_PARAM_RESPONSE_FRMT_DOCU],1),a.append(k)}}),$("#transactions").hasClass("in")&&$("#content").scrollTo("100%",300)},$.build_interface=function(e,a){(void 0===a||null===a||""===a)&&(a=!1);var s="",t="",_="",n="";if($.get_session_status(e,function(i){var l=i[kAPI_SESSION];switch($.trim(l[kTAG_SESSION_STATUS][kAPI_PARAM_RESPONSE_FRMT_VALUE])){case kTYPE_STATUS_FAILED:case kTYPE_STATUS_ERROR:case kTYPE_STATUS_FATAL:case kTYPE_STATUS_EXCEPTION:session_status_class="progress-bar-danger",t="fa-times fa-1_5x",n="text-danger",_=l[kTAG_SESSION_STATUS][kAPI_PARAM_RESPONSE_FRMT_DISP][kAPI_PARAM_RESPONSE_FRMT_DISP],s="danger";break;case kTYPE_STATUS_EXECUTING:session_status_class="progress-bar-info",t="fa-refresh fa-spin",n="text-muted",_=l[kTAG_SESSION_STATUS][kAPI_PARAM_RESPONSE_FRMT_DISP][kAPI_PARAM_RESPONSE_FRMT_DISP]+"...",s="";break;case kTYPE_STATUS_OK:session_status_class="progress-bar-success",t="fa-check",n="text-success",_=l[kTAG_SESSION_STATUS][kAPI_PARAM_RESPONSE_FRMT_DISP][kAPI_PARAM_RESPONSE_FRMT_DISP],s="success";break;case kTYPE_STATUS_MESSAGE:session_status_class="progress-bar-info",t="fa-info fa-1_5x",n="text-info ",_=l[kTAG_SESSION_STATUS][kAPI_PARAM_RESPONSE_FRMT_DISP][kAPI_PARAM_RESPONSE_FRMT_DISP],s="info";break;case kTYPE_STATUS_WARNING:session_status_class="progress-bar-warning",t="fa-warning",n="text-warning",_=l[kTAG_SESSION_STATUS][kAPI_PARAM_RESPONSE_FRMT_DISP][kAPI_PARAM_RESPONSE_FRMT_DISP],s="warning"}l[kTAG_SESSION_STATUS][kAPI_PARAM_RESPONSE_FRMT_VALUE]!=kTYPE_STATUS_EXECUTING||i[kAPI_SESSION_RUNNING]||(session_status_class="progress-bar-danger",t="fa-times fa-1_5x",n="text-danger",_=l[kTAG_SESSION_STATUS][kAPI_PARAM_RESPONSE_FRMT_DISP][kAPI_PARAM_RESPONSE_FRMT_DISP],s="danger"),$("#details_row").removeClass("hidden");var r=new Date(1e3*l[kTAG_SESSION_START][kAPI_PARAM_RESPONSE_FRMT_VALUE].sec),o=$("<dt>").text(l[kTAG_SESSION_START][kAPI_PARAM_RESPONSE_FRMT_NAME]),d=$("<dd>").text($.epoch2locale(r)),p=$("<dt>"),c=$("<dd>");if($.obj_len(l[kTAG_SESSION_END])>0){var A=new Date(1e3*l[kTAG_SESSION_END][kAPI_PARAM_RESPONSE_FRMT_VALUE].sec);p.text(l[kTAG_SESSION_END][kAPI_PARAM_RESPONSE_FRMT_NAME]),c.text($.epoch2locale(A))}var S=$("<dt>").text(l[kTAG_SESSION_STATUS][kAPI_PARAM_RESPONSE_FRMT_NAME]);if($dd_status=$("<dd>").html('<b class="'+n+'"><span class="fa '+t+'"></span> '+_+"</b>"),$("#dl_left").html(o).append(d),$.obj_len(l[kTAG_SESSION_END])>0&&$("#dl_left").append(p).append(c),$("#dl_left").append("<br />").append(S).append($dd_status),$.obj_len(l[kTAG_COUNTER_PROCESSED])>0){var T=$('<dt class="text-muted">').text(i18n[lang].messages.upload.summary.total.replace("%",$.get_processed_name(l))),E=$('<dd class="text-muted">').text($.get_processed(l));$("#dl_right").html(T).append(E)}$.obj_len(l[kTAG_COUNTER_VALIDATED])>0&&($dt_validated=$('<dt class="text-success">').text(i18n[lang].messages.upload.summary.total.replace("%",$.get_validated_name(l))),$dd_validated=$('<dd class="text-success">').text($.get_validated(l)),$("#dl_right").append($dt_validated).append($dd_validated)),$.obj_len(l[kTAG_COUNTER_REJECTED])>0&&($dt_rejected=$('<dt class="text-danger">').text(i18n[lang].messages.upload.summary.total.replace("%",$.get_rejected_name(l))),$dd_rejected=$('<dd class="text-danger">').text($.get_rejected(l)),$("#dl_right").append($dt_rejected).append($dd_rejected)),$.obj_len(l[kTAG_COUNTER_SKIPPED])>0&&($dt_skipped=$('<dt class="text-warning">').text(i18n[lang].messages.upload.summary.total.replace("%",$.get_skipped_name(l))),$dd_skipped=$('<dd class="text-warning">').text($.get_skipped(l)),$("#dl_right").append($dt_skipped).append($dd_skipped)),$.obj_len(l[kTAG_COUNTER_RECORDS])>0&&($dt_records=$('<dt class="total">').text(i18n[lang].messages.upload.summary.total.replace("%",$.get_records_name(l))),$dd_records=$('<dd class="total">').text($.get_records(l)),$("#dl_right").append("<hr />").append($dt_records).append($dd_records));var u=void 0!==l[kTAG_COUNTER_PROGRESS]?parseInt(l[kTAG_COUNTER_PROGRESS][kAPI_PARAM_RESPONSE_FRMT_DISP]):100;if($.set_progress_bar(u,session_status_class),!(l[kAPI_PARAM_RESPONSE_FRMT_DOCU].length>0))return $("#details_row").html('<h1 unselectable="on"><span class="fa fa-fw fa-times text-danger"></span>Not enought data to display</h1>'),!1;if($("#detail_list_group").add_session_progress_row(l,0),100>u&&"danger"!==s)setTimeout(function(){$.build_interface(e)},1e3);else if($("#progress_bar").removeClass("progress-bar-striped").removeClass("progress-bar-info").removeClass("active").addClass("progress-bar-success"),"success"==s){$("#details_btn").collapse_details();var R=$('<div class="clearfix" id="finished_upload">'),P=$('<div class="btn-group pull-right">'),f=$("<a>").attr({"class":"btn btn-default-white",href:"javascript:void(0)"}).on("click",function(){$.download_last_uploaded_file(i[kAPI_SESSION][kTAG_FILE][0])}).html(i18n[lang].interface.btns.download+' <span class="fa fa-download"></span>'),g=$("<a>").attr({"class":"btn btn-orange",href:"javascript:void(0)",id:"update_btn"}).html(i18n[lang].interface.btns.update+' <span class="fa fa-upload"></span>'),k=$("<a>").attr({"class":"btn btn-success",disabled:"disabled",href:"javascript:void(0)",id:"publish_btn"}).on("click",function(){$.publish_data()}).html(i18n[lang].interface.btns.publish+"<sup>"+$.get_validated(l)+'</sup> <span class="fa fa-chevron-right"></span>'),m=$('<form action="" class="dropzone hidden" id="dropzone"></form>');a||(P.append(f),$.has_validated(l)&&k.attr("disabled",!1),P.append(g),P.append(k),R.append(P).append(m),$("#upload").append(R)),$("#finished_upload form").update_btn(e)}else{var I=$('<div class="col-sm-12">'),N=$('<div class="clearfix">'),O=$('<div class="btn-group pull-right">'),h=$("<a>").attr({"class":"btn btn-default-white"}).html('Download the file <span class="fa fa-download"></span>');O.append(h),I.append(O).append(N),$("#details_row").append(I)}}),$("#progress_supercontainer").length>0){var i=$("#progress_supercontainer"),l=i.offset().top-parseFloat(i.css("marginTop").replace(/auto/,0))-70;$("#content").scroll(function(){var e=$(this).scrollTop();e>=l?i.addClass("fixed"):i.removeClass("fixed")})}},$.view_last_upload_errors=function(e){var a=$("<a>").attr({href:"javascript:void(0);",onclick:"$.init_upload();","class":"back_btn",title:i18n[lang].interface.btns.back_to_main_upload}).tooltip({placement:"bottom"});if(0===$("#contents > .top_content_label").length){var s=$('<div class="top_content_label">'),t=$("<h1>").append(a).append(i18n[lang].messages.last_upload),_=$('<div class="row">'),n=$('<div class="col-xs-4" id="last_session_menu">'),i=$("<span>");s.append(t),i.addClass("text-muted").html('<span class="fa fa-fw fa-refresh fa-spin"></span> '+i18n[lang].messages.loading_session_status),n.append(i),_.append(n),s.append(_),$("#contents").prepend(s)}var l={};l[kTAG_TRANSACTION_STATUS]="@null@",$.group_transaction({session_id:e,params:l},function(s){$.log_activity({action:"Displaying last upload with session id: "+e,icon:"fa-eye-slash"});{var t=$('<div id="errors_summary">'),_="",n="",i="";$(".top_content_label > h1")}a.append(i18n[lang].messages.last_upload+" "+s[kAPI_PARAM_RESPONSE_FRMT_NAME].toLowerCase()),$(".top_content_label > h1").html("").append(a),$(".top_content_label > .row > .col-xs-4:last").html(""),$("#last_session_menu").html('<span class="text-muted">'+s[kAPI_PARAM_RESPONSE_FRMT_INFO]+"</span>"),$.each(s[kAPI_PARAM_RESPONSE_FRMT_DOCU],function(e,a){switch($.trim(a[kAPI_PARAM_RESPONSE_FRMT_VALUE])){case kTYPE_STATUS_FAILED:case kTYPE_STATUS_ERROR:case kTYPE_STATUS_FATAL:case kTYPE_STATUS_EXCEPTION:i="fa-times",n="text-danger",_="danger";break;case kTYPE_STATUS_EXECUTING:i="fa-refresh fa-spin",n="text-muted",_="";break;case kTYPE_STATUS_OK:i="fa-check",n="text-success",_="success";break;case kTYPE_STATUS_MESSAGE:i="fa-info",n="text-info",_="info";break;case kTYPE_STATUS_WARNING:i="fa-warning",n="text-warning",_="warning"}var s=$('<h4 class="'+n+'">'),l=$('<span class="fa pull-left fa-3x '+i+'"></span>'),r=$("<a>").attr({href:"javascript:void(0);","data-target":"details_"+e,"data-status":a[kAPI_PARAM_RESPONSE_FRMT_VALUE],"data-class":n,"class":"btn-link btn-details"}).html(i18n[lang].interface.btns.details+' <span class="fa fa-caret-right"></span>'),o=$('<p class="help-block">').append(a[kAPI_PARAM_RESPONSE_FRMT_DISP][kAPI_PARAM_RESPONSE_FRMT_INFO]+"&emsp;").append(r),d=$('<span class="pull-left">').append(a[kAPI_PARAM_RESPONSE_FRMT_DISP][kAPI_PARAM_RESPONSE_FRMT_NAME]).append(" <sup><b>"+a[kAPI_PARAM_RESPONSE_COUNT]+"</b></sup>").append(o),p=$('<div class="clearfix">'),c=$('<div class="collapse" id="details_'+e+'">'),A=$('<div class="well">');c.append(A),s.append(l).append(d),t.append(s).append(p).append(c)}),$("#contents").removeClass("upload"),$("#upload").html("").append(t),$(".btn-details").on("click",function(){var a=($(this),$("#"+$(this).attr("data-target"))),s=$(this).attr("data-status"),t=$(this).attr("data-class"),_=a.find(".well"),n=$('<div class="row">'),i=$('<div id="worksheets_col" class="col-xs-12 col-sm-6 col-lg-4">');n.append(i),_.append(n),$(".btn-details").find("span.fa").toggleClass("fa-caret-right fa-caret-down"),""===$.trim($("#worksheets_col").html())&&$("#worksheets_col").html('<span class="text-muted"><span class="fa fa-refresh fa-spin fa-fw"></span> '+i18n[lang].messages.loading_details+"</span>"),a.collapse("toggle").on("show.bs.collapse",function(){}).on("shown.bs.collapse",function(){var a=$("<h5>").attr({"class":"root-title"});if(0===$("#worksheets_col > h5.root-title").length){var _={};_[kTAG_TRANSACTION_STATUS]=s,_[kTAG_TRANSACTION_COLLECTION]="@null@",$.group_transaction({session_id:e,params:_},function(_){var n=$('<ul class="collapse fa-ul" id="upload_error_worksheets" aria-expanded="false" style="height: 0px;">');$.each(_[kAPI_PARAM_RESPONSE_FRMT_DOCU],function(a,i){var l=$.makeid(),r={};r[kTAG_TRANSACTION_STATUS]=s,r[kTAG_TRANSACTION_COLLECTION]=i[kAPI_PARAM_RESPONSE_FRMT_VALUE],r[kTAG_TRANSACTION_ALIAS]="@null@",n.nest_collapsible({id:l,k:a,v:_,string_class:t,session_id:e,params:r},function(a){$.group_transaction({session_id:a.session_id,params:a.params},function(_){0===$.obj_len(_[kAPI_PARAM_RESPONSE_FRMT_DOCU])?$("#"+l).removeClass("empty").html('<i class="text-muted">'+i18n[lang].messages.no_data+"</i>"):($('<h4 id="'+l+'_title">').text(_[kAPI_PARAM_RESPONSE_FRMT_NAME]).insertBefore($("#"+l)),$("#"+l).html(""),$("#"+l).hasClass("empty")?($("#"+l).removeClass("empty"),$.each(_[kAPI_PARAM_RESPONSE_FRMT_DOCU],function(n,r){var o=$.makeid(),d={};d[kTAG_TRANSACTION_STATUS]=s,d[kTAG_TRANSACTION_COLLECTION]=i[kAPI_PARAM_RESPONSE_FRMT_VALUE],d[kTAG_TRANSACTION_ALIAS]=r[kAPI_PARAM_RESPONSE_FRMT_VALUE],d[kTAG_TRANSACTION_VALUE]="@null@",$("#"+l).nest_collapsible({id:o,k:n,v:_,string_class:t,session_id:e,params:d},function(_){$.group_transaction({session_id:a.session_id,params:_.params},function(_){0===$.obj_len(_[kAPI_PARAM_RESPONSE_FRMT_DOCU])?$("#"+o).removeClass("empty").html('<i class="text-muted">'+i18n[lang].messages.no_data+"</i>"):($('<h4 id="'+o+'_title">').text(_[kAPI_PARAM_RESPONSE_FRMT_NAME]).insertBefore($("#"+o)),$("#"+o).html(""),$("#"+o).hasClass("empty")?($("#"+o).removeClass("empty"),$.each(_[kAPI_PARAM_RESPONSE_FRMT_DOCU],function(n,l){var d=$.makeid(),p={};p[kTAG_TRANSACTION_STATUS]=s,p[kTAG_TRANSACTION_COLLECTION]=i[kAPI_PARAM_RESPONSE_FRMT_VALUE],p[kTAG_TRANSACTION_ALIAS]=r[kAPI_PARAM_RESPONSE_FRMT_VALUE],p[kTAG_TRANSACTION_VALUE]=l[kAPI_PARAM_RESPONSE_FRMT_VALUE],p[kTAG_TRANSACTION_MESSAGE]="@null@",$("#"+o).nest_collapsible({id:d,k:n,v:_,string_class:t,session_id:e,params:p},function(t){$.group_transaction({session_id:a.session_id,params:t.params},function(t){0===$.obj_len(t[kAPI_PARAM_RESPONSE_FRMT_DOCU])?$("#"+d).removeClass("empty").html('<i class="text-muted">'+i18n[lang].messages.no_data+"</i>"):($('<h4 id="'+d+'_title">').text(t[kAPI_PARAM_RESPONSE_FRMT_NAME]).insertBefore($("#"+d)),$("#"+d).html(""),$("#"+d).hasClass("empty")?($("#"+d).removeClass("empty"),$.each(t[kAPI_PARAM_RESPONSE_FRMT_DOCU],function(_,n){var o=$.makeid(),p={};p[kTAG_TRANSACTION_STATUS]=s,p[kTAG_TRANSACTION_COLLECTION]=i[kAPI_PARAM_RESPONSE_FRMT_VALUE],p[kTAG_TRANSACTION_ALIAS]=r[kAPI_PARAM_RESPONSE_FRMT_VALUE],p[kTAG_TRANSACTION_VALUE]=l[kAPI_PARAM_RESPONSE_FRMT_VALUE],p[kTAG_TRANSACTION_MESSAGE]=n[kAPI_PARAM_RESPONSE_FRMT_VALUE],p[kTAG_TRANSACTION_RECORD]="@null@",$("#"+d).nest_collapsible({id:o,k:_,v:t,string_class:"text-danger",session_id:e,params:p},function(e){$.group_transaction({session_id:a.session_id,params:e.params},function(e){$('<h4 id="'+o+'_title">').text(e[kAPI_PARAM_RESPONSE_FRMT_NAME]).insertBefore($("#"+o)),$("#"+o).addClass("last_level").html(""),$.each(e[kAPI_PARAM_RESPONSE_FRMT_DOCU],function(e,a){var s=$("<li>");s.html(a[kAPI_PARAM_RESPONSE_FRMT_DISP]),$("#"+o).append(s)})})})})):$("#"+d).collapse("toggle"))})})})):$("#"+o).collapse("toggle"))})})})):$("#"+l).collapse("toggle"))})})}),a.html('<span class="fa fa-files-o fa-fw fa-2x"></span> '+i18n[lang].messages.worksheets+' <sup class="'+t+'"><small class="text-warning">'+$.obj_len(_[kAPI_PARAM_RESPONSE_FRMT_DOCU])+"</small></sup>"),$("#worksheets_col").html("").append(a).append(n),$("#upload_error_worksheets").collapse("show")})}})}),1===$.obj_len(s[kAPI_PARAM_RESPONSE_FRMT_DOCU])&&$(".btn-details").click()})},$.fn.add_previous_upload_session=function(e){var a=$(this),s=$('<div class="top_content_label">'),t=$("<h1>").text(i18n[lang].messages.last_upload),_=$('<div class="row">'),n=$('<div class="col-xs-8" id="last_session_menu">'),i=$('<div class="col-xs-4">'),l=$('<div class="progress">'),r=$("<span>"),o=$("<div>").attr({"class":"progress-bar progress-bar-striped progress-bar-warning active",role:"progressbar","aria-valuenow":"100","aria-valuemin":"0","aria-valuemax":"100",style:"width: 100%;"}),d=$('<div class="btn-group">'),p=$("<a>").attr({href:"javascript:void(0);",onclick:'$("#upload").added_file(); $.build_interface(\''+e+"');",title:i18n[lang].interface.btns.view_status}),c=$('<form action="" class="dropzone hidden" id="dropzone"></form>'),A=$("<a>").attr({href:"javascript:void(0);",title:i18n[lang].interface.btns.view_errors_summary}).on("click",function(){$.view_last_upload_errors(e)}),S=$("<a>").attr({href:"javascript:void(0);","class":"btn btn-transparent btn-orange",title:i18n[lang].interface.btns.update,id:"update_btn"}).html(i18n[lang].interface.btns.update+' <span class="fa fa-upload fa-fw"></span>'),T=$("<a>").attr({href:"javascript:void(0);","class":"btn btn-transparent btn-default-white disabled",title:i18n[lang].interface.btns.delete}).html(i18n[lang].interface.btns.delete+' <span class="fa fa-trash-o fa-fw"></span>');$link_download=$("<a>").attr({href:"javascript:void(0);","class":"btn btn-transparent btn-default-white",title:i18n[lang].interface.btns.download}).html('<span class="fa fa-download fa-fw"></span> '+i18n[lang].interface.btns.download),$link_download_template=$("<a>").attr({href:"javascript:void(0)","class":"btn btn-transparent btn-default dropdown-toggle","data-toggle":"dropdown",title:i18n[lang].interface.btns.download_template}).html('<span class="fa fa-download"></span> '+i18n[lang].interface.btns.download_template+' <span class="fa fa-caret-down"></span>'),$link_download_dropdown=$('<ul class="dropdown-menu pull-right">'),$li_checklist=$("<li>"),$li_inventory=$("<li>"),$btn_checklist=$("<a>").attr({href:"javascript:void(0);",onclick:"$.force_download('xls/CWR_Checklist_Template.xlsx')",id:"cwr_checklist_btn"}).html('<span class="fa fa-file-excel-o text-success"></span><span class="text-default">CWR Checklist</span>'),$btn_inventory=$("<a>").attr({href:"javascript:void(0);",onclick:"$.force_download('xls/CWR_Inventory_Template.xlsx')",id:"cwr_inventory_btn"}).html('<span class="fa fa-file-excel-o text-success"></span><span class="text-default">CWR Inventory</span>'),$li_checklist.append($btn_checklist),$li_inventory.append($btn_inventory),$link_download_dropdown.append($li_checklist).append($li_inventory),$.get_session_status(e,function(a){var s="",t="",_="",r="",E="",u=a[kAPI_SESSION],R=void 0!==u[kTAG_FILE]?u[kTAG_FILE][0].filename[kAPI_PARAM_RESPONSE_FRMT_VALUE]:i18n[lang].messages.no_file_uploaded;
switch($link_download.on("click",function(){$.download_last_uploaded_file(u[kTAG_FILE][0])}),$.trim(u[kTAG_SESSION_STATUS][kAPI_PARAM_RESPONSE_FRMT_VALUE])){case kTYPE_STATUS_FAILED:case kTYPE_STATUS_ERROR:case kTYPE_STATUS_FATAL:case kTYPE_STATUS_EXCEPTION:session_status_class="progress-bar-danger",t="fa-times fa-1_5x",r="text-danger",_=u[kTAG_SESSION_STATUS][kAPI_PARAM_RESPONSE_FRMT_DISP][kAPI_PARAM_RESPONSE_FRMT_DISP],s="danger";break;case kTYPE_STATUS_EXECUTING:session_status_class="progress-bar-info",t="fa-refresh fa-spin",r="text-muted",_=u[kTAG_SESSION_STATUS][kAPI_PARAM_RESPONSE_FRMT_DISP][kAPI_PARAM_RESPONSE_FRMT_DISP]+"...",s="";break;case kTYPE_STATUS_OK:session_status_class="progress-bar-success",t="fa-check",r="text-success",_=u[kTAG_SESSION_STATUS][kAPI_PARAM_RESPONSE_FRMT_DISP][kAPI_PARAM_RESPONSE_FRMT_DISP],s="success";break;case kTYPE_STATUS_MESSAGE:E="list-group-item-info",t="fa-info fa-1_5x",r="text-info",_=u[kTAG_SESSION_STATUS][kAPI_PARAM_RESPONSE_FRMT_DISP][kAPI_PARAM_RESPONSE_FRMT_DISP],s="info";break;case kTYPE_STATUS_WARNING:session_status_class="progress-bar-warning",t="fa-warning",r="text-warning",_=u[kTAG_SESSION_STATUS][kAPI_PARAM_RESPONSE_FRMT_DISP][kAPI_PARAM_RESPONSE_FRMT_DISP],s="warning"}$.has_skipped(u)&&(session_status_class="progress-bar-warning",t="fa-warning",r="text-warning",_=u[kTAG_SESSION_STATUS][kAPI_PARAM_RESPONSE_FRMT_DISP][kAPI_PARAM_RESPONSE_FRMT_DISP],s="warning"),$.has_rejected(u)&&(session_status_class="progress-bar-danger",t="fa-times",r="text-danger",_=u[kTAG_SESSION_STATUS][kAPI_PARAM_RESPONSE_FRMT_DISP][kAPI_PARAM_RESPONSE_FRMT_DISP],s="danger"),void 0!==u[kTAG_FILE]?(p.html('<span class="fa fa-file-excel-o fa-1_5x fa-fw text-success"></span>'+R.split("/").pop()),p.tooltip(),o.attr({"aria-valuenow":$.get_progress(u),style:"width: "+(0===$.get_progress(u)?$.get_progress(u):100)+"%;"}).html($.get_progress(u)+"%"),l.addClass("pull-left").attr("style","width: 93%;"),i.append(' <span class="fa '+t+" "+r+' fa-1_5x pull-right"></span>'),o.removeClass("active").removeClass("progress-bar-striped"),o.removeClass("progress-bar-warning").addClass(session_status_class),void 0!==u[kTAG_FILE]?A.append($.get_processed(u)+" "+$.get_processed_name(u)+'<span class="fa fa-angle-right fa-fw"></span> ').append($.get_validated(u)+" "+$.get_validated_name(u)+" - ").append("<b>"+$.get_skipped(u)+" "+$.get_skipped_name(u)+"</b> - ").append("<u><b>"+$.get_rejected(u)+" "+$.get_rejected_name(u)+"</b></u>"):A.html(i18n[lang].messages.no_progress_for_this_session),A.tooltip(),o.html(A),d.append(S).append(T).append($link_download).append($link_download_template).append($link_download_dropdown),n.html("").append(p).append(d).append(c),$("#last_session_menu form").update_btn(e)):$("#contents > .top_content_label").remove()}),s.append(t),r.addClass("text-muted").html('<span class="fa fa-fw fa-refresh fa-spin"></span> '+i18n[lang].messages.loading_session_status),n.append(r),_.append(n),l.append(o),i.append(l),_.append(i),s.append(_),a.prepend(s)},$.init_upload=function(){$.log_activity({action:"Displaying main upload interface",icon:"fa-eye-slash"}),$.upload_user_status(function(e){if($("#contents").hasClass("upload")||$("#contents").addClass("upload"),$("#contents .top_content_label").length>0&&$("#contents .top_content_label").remove(),null!==e&&e[kAPI_SESSION_RUNNING])$.log_activity({action:"Displaying upload status with session id: "+e[kAPI_SESSION_ID],icon:"fa-eye-slash"}),$("#upload").added_file(),$.build_interface(e[kAPI_SESSION_ID]);else{var a="";null!==e&&void 0!==e[kAPI_SESSION_ID]&&null!==e[kAPI_SESSION_ID]&&""!==e[kAPI_SESSION_ID]&&(a=e[kAPI_SESSION_ID],$("#contents").add_previous_upload_session(e[kAPI_SESSION_ID])),storage.remove("pgrdg_user_cache.user_data.undefined");var s=$("<div>"),t=$("<form>").attr({action:"","class":"dropzone",id:"dropzone"}),_=$("<input>").attr({type:"hidden",name:"user_id",value:$.get_current_user_id()});t.append(_),s.append(t),$("#upload").html(s.html()),$("#upload form").dropzone({autoDiscover:!1,sendingmultiple:!1,acceptedFiles:".xls,.xlsx,.ods",autoProcessQueue:!0,clickable:!0,dictDefaultMessage:'<span class="fa fa-cloud-upload fa-5x text-muted"></span><br /><br />'+i18n[lang].messages.drop_file_here,init:function(){this.on("processing",function(e){var a=e.name.split(".").pop().toLowerCase(),s=$.trim($.clean_file_name(e.name.replace(a,"")))+"."+a;this.options.url="/API/?upload="+s})},addedfile:function(){$.log_activity(null!==e?{action:"Displaying last upload with session id: "+e[kAPI_SESSION_ID],icon:"fa-eye-slash"}:{action:"Uploading first file",icon:"fa-eye-slash"}),$("#upload").added_file()},uploadprogress:function(e,a){$.set_progress_bar(a)},success:function(e){var a=e.name.split(".").pop().toLowerCase(),s=$.trim($.clean_file_name(e.name.replace(a,"")))+"."+a,t="/var/www/pgrdg/"+config.service.path.gpg+$.get_current_user_id()+"/uploads/"+s;$.set_progress_bar("pending"),$.inform_upload_was_done(t,function(e){$.build_interface(e)})}})}})};