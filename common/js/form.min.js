$.get_title=function(e){return void 0!==e[kAPI_RESULT_ENUM_DESCR]&&e[kAPI_RESULT_ENUM_DESCR].length>0?void 0!==e[kAPI_RESULT_ENUM_DESCR]&&e[kAPI_RESULT_ENUM_DESCR].length>0?e[kAPI_RESULT_ENUM_DESCR]:"":void 0!==e.definition&&e.definition.length>0?e.definition:""},$.create_form=function(e,a){$.fn.change_offsets=function(e,a,t){var s=[],r=0,i=0,n=0;if($.each($(this).closest("ul").find("a:not(.select_all)"),function(){$item=$(this),$item.find("span:first-child").hasClass("fa-check-square-o")&&s.push($item.attr("data-offset"))}),$(this).find("span:first").hasClass("fa-check-square-o")){var _=-1,l=-1;$.each($(this).closest("ul").find("a:not(.select_all) > span:first-child"),function(){$(this).hasClass("fa-check-square-o")?_++:l++}),_>0&&($(this).find("span:first").removeClass("fa-check-square-o").addClass("fa-square-o"),s.splice($.inArray($(this).attr("data-offset"),s),1))}else $(this).find("span:first").removeClass("fa-square-o").addClass("fa-check-square-o"),s.push($(this).attr("data-offset"));s=$.array_unique(s),$("#"+$.md5(t)+"_offset_input").val(s),i==r?$(this).closest("ul").find("a.select_all > span:first-child").removeClass("fa-square-o").addClass("fa-check-square-o"):$(this).closest("ul").find("a.select_all > span:first-child").removeClass("fa-check-square-o").addClass("fa-square-o"),$.each($(this).closest("ul").find("a:not(.select_all) > span:first-child"),function(){r=$(this).closest("ul").find("a:not(.select_all)").length,$(this).hasClass("fa-check-square-o")?i++:n++})},$.fn.change_all_offsets=function(e,a,t){var s=[];$(this).on("click",function(e){e.stopPropagation()}),$(this).find("span:first").hasClass("fa-check-square-o")?($(this).find("span:first").removeClass("fa-check-square-o").addClass("fa-square-o"),$.each($(this).closest("ul").find("a:not(.select_all)"),function(){$item=$(this),$(this).find("span:first").removeClass("fa-check-square-o").addClass("fa-square-o"),s=[]})):($(this).find("span:first").removeClass("fa-square-o").addClass("fa-check-square-o"),$.each($(this).closest("ul").find("a:not(.select_all)"),function(){$item=$(this),$item.find("span:first").removeClass("fa-square-o").addClass("fa-check-square-o"),s.push($item.attr("data-offset"))})),s=$.array_unique(s),$("#"+$.md5(t)+"_offset_input").val(s)},$.fn.load_splice=function(a,t){if(0===$("#"+$(this).attr("id")+"_ul").length){var s=$(this).attr("id"),r=$("<div>").addClass("dropdown-menu dropdown-menu-right").attr({role:"menu","aria-labelledby":s,id:s+"_ul"}),i=($("<div>").addClass("dropdown-header"),$("<div>").addClass("dropdown-content")),n=$("<ul>").addClass("list-group"),_=e[kAPI_RESULTS_DICTIONARY],l=_[kAPI_DICTIONARY_TAGS],o=_[kAPI_DICTIONARY_IDS],c=e[kAPI_RESPONSE_RESULTS][kAPI_PARAM_COLLECTION_TAG],d=a.split(","),p=($("<li>").addClass("list-group-item"),$("<li>").addClass("divider"),$("<span>").addClass("fa fa-fw fa-check-square-o text-muted")),A=$("<span>").addClass("text-muted").html(i18n[lang].interface.btns.select_all);$a_select_all=$("<a>").addClass("select_all").attr({href:"javascript: void(0);",onclick:"$(this).change_all_offsets('"+d+"', '"+s+"', '"+t+"')"}).append(p).append(A),$a_item=$("<a>").attr({href:"javascript:void(0);",onclick:"$(this).change_offsets('"+d+"', '"+s+"', '"+t+"')"}),$.each(d,function(e,a){var r=$("<li>").addClass("list-group-item"),i=$("<a>").addClass("offset_item").attr({href:"javascript:void(0);",onclick:"$(this).change_offsets('"+d+"', '"+s+"', '"+t+"')","data-offset":a}),_=$("<span>").addClass("fa fa-fw fa-check-square-o"),p="",A="";if(-1==a.indexOf("."))p=c[o[e]][kTAG_LABEL],A=void 0!==c[o[e]][kTAG_DESCRIPTION]?c[l[a]][kTAG_DESCRIPTION]:"",i.append(_).append(" "+p),r.append(i);else{{var g=a.split("."),h=g.slice(0,1);$('<ul class="fa-ul">')}h.length>0&&(i.append(_),$.each(h,function(e,a){$("<li>").addClass("sub");p=c[l[a]][kTAG_LABEL],A=void 0!==c[l[a]][kTAG_DESCRIPTION]?c[l[a]][kTAG_DESCRIPTION]:"",r.addClass("sub"),i.append(p)})),r.append(i)}n.append(r)}),i.append(n),r.append(i),r.insertAfter($(this))}},(void 0===a||null===a||""===a)&&(a=!1);var t=e[kAPI_RESULTS_DICTIONARY],s=t[kAPI_DICTIONARY_COLLECTION],r=(t[kAPI_DICTIONARY_IDS],t[kAPI_DICTIONARY_CLUSTER]),i=(t[kAPI_DICTIONARY_TAGS],e[kAPI_RESPONSE_RESULTS][kAPI_PARAM_COLLECTION_TAG]),n=!1,_="",l={},o="",c=function(e,a){var t={};return $.each(a,function(e,a){e==kTAG_DATA_TYPE&&(t.type=a),e==kTAG_DATA_KIND&&(t.kind=a),e==kTAG_LABEL&&(t.label=a),e==kTAG_DESCRIPTION&&(t.description=a),e==kTAG_DEFINITION&&(t.definition=a),e==kTAG_UNIT_COUNT&&(t.count=a),e==kTAG_MIN_VAL&&(t.min=a),e==kTAG_MAX_VAL&&(t.max=a)}),t},d=function(){return 0===$.inArray(kTYPE_QUANTITATIVE,l.kind)?!0:!1},p=function(a){var t;return $.each(r,function(a,r){$.each(r,function(a,r){var p=i[r][kTAG_UNIT_OFFSETS];if(l=c(a,e.results[s][r]),l.size="double",d())_=$.add_range({type:l.type,placeholder:[l.min,l.max],min:l.min,max:l.max}),l.size="double";else switch(l.type){case kTYPE_FLOAT:case kTYPE_INT:n=!1,_=$.add_range({type:l.type,placeholder:[l.min,l.max],min:l.min,max:l.max,return_key:n}),l.size="double";break;case kTYPE_URL:case kTYPE_STRING:n=!1,_=$.add_input({return_key:n});break;case kTYPE_ENUM:case kTYPE_SET:n=!0,_=$.add_multiselect({tree_checkbox:!0},function(){});break;case kTYPE_BOOLEAN:n=!1,_=$.add_switch({return_key:n});break;default:n=!1,_=$.add_simple_input({return_key:n})}switch(l.size){case"double":t="col-lg-6 col-md-8 col-sm-12";break;case"single":t="col-lg-3 col-md-6 col-sm-12";break;default:t="col-lg-3 col-md-6 col-sm-12"}var A=$("<a>").attr({href:"javascript:void(0);",onclick:"$.toggle_form_item($(this), '"+r+"');","class":"pull-left",title:i18n[lang].messages.enable_item}).html('<span class="fa fa-square-o"></span>'),g=$("<sup>").addClass("text-danger").html("<b>"+(void 0!==l.count&&l.count>0?l.count:0)+"</b>"),h=$("<a>").attr({title:i18n[lang].interface.btns.contained_in+" ("+i18n[lang].messages.offsets.replace("{X}",p.length)+")",href:"javascript:void(0);",onclick:"$(this).load_splice('"+p+"', '"+r+"');",id:$.md5(r)+"_offsets","data-toggle":"dropdown"}).addClass("btn btn-xs btn-default-white").html(i18n[lang].interface.btns.contained_in+' <sup class="text-info">'+i18n[lang].messages.offsets.replace("{X}",p.length)+' </sup>&emsp;<span class="fa fa-caret-down"></span>'),P=$("<div>").attr("id",$.md5(r)+"_offsets_container").addClass("dropdown keep-open pull-right").append(h),u=$("<div>");if(void 0!==l.count&&l.count>0){var m=$("<span>").addClass("fa fa-check");u.attr({id:$.md5(r),onclick:"$.toggle_form_item($('#"+$.md5(r)+"'), '"+r+"');","class":"panel-mask"}).html(m[0].outerHTML+"<small>"+i18n[lang].interface.btns.activate+"</small>")}else u.addClass("panel-mask unselectable");var f=$("<small>").attr({"class":"help-block",style:"color: #999; margin-bottom: -3px;"}).html("<br />"+$.get_title(l)),E=$("<input />").attr({type:"hidden",name:"type",value:l.type}),R=$("<input />").attr({type:"hidden",name:"kind",value:l.kind}),I=$("<input />").attr({type:"hidden",name:"tags",value:r}),k=$("<input />").attr({type:"hidden",id:$.md5(r)+"_offset_input",name:"offsets",value:p}),S=$("<input />").attr({type:"hidden",id:$.md5(r)+"_default_offset_input",name:"default_offsets_input",value:p}),T=$("<div>").addClass("panel panel-success disabled").attr({title:i18n[lang].messages.forms.item_disabled}),b=$("<div>").addClass(t+" "+$.md5(r)+" vcenter").append(u),v=$("<span>").addClass("disabled").append(l.label+" ").append(g);p.length>1&&v.append(P),v.append(f);var M=$("<h3>").addClass("panel-title").append(v),N=$("<div>").addClass("panel-heading").append(A).append(M),y=$("<form>").attr("onsubmit","return false;").append(E).append(R).append(I).append(k).append(S).append(_),O=$("<div>").addClass("panel-body").append(y);T.append(N).append(O),b.append(T),o+=b[0].outerHTML})}),a?o:'<div class="row">'+o+"</div>"};return p(a)},$.restore_form=function(){$.storage_exists("pgrdg_cache.search.criteria")?($.storage_exists("pgrdg_cache.search.criteria.forms")||$.storage_exists("pgrdg_cache.search.criteria.fulltext")||$.storage_exists("pgrdg_cache.search.criteria.select_map_area"))&&($.storage_exists("pgrdg_cache.search.criteria.traitAutocomplete")&&$("#main_search").val(storage.get("pgrdg_cache.search.criteria.traitAutocomplete.text")),$.exec_autocomplete("restore")):$("#advanced_search_home").fadeIn(300)},$.fn.activate_treeselect=function(e){var a=$(this).find("a.treeselect"),t=a.closest("form"),s=($(this).find("a.treeselect").attr("id"),'<div class="dropdown-header"><div class="input-group"><input type="text" class="form-control" placeholder="'+i18n[lang].interface.btns.filter+'" /><span class="input-group-addon"><span class="fa fa-search"></span></span></div></div>'),r='<div class="dropdown-content"><ul class="list-group"></ul></div>';a.addClass("disabled"),t.find(".dropdown-menu").html(s+r);var i={};i.storage_group="pgrdg_cache.local.forms_data",i.loaderType=$(this).find("a.pull-left, a.pull-right"),i[kAPI_REQUEST_OPERATION]=kAPI_OP_GET_TAG_ENUMERATIONS,i.parameters={},i.parameters[kAPI_REQUEST_LANGUAGE]=lang,i.parameters[kAPI_REQUEST_PARAMETERS]={},i.parameters[kAPI_REQUEST_PARAMETERS][kAPI_PAGING_LIMIT]=300,i.parameters[kAPI_REQUEST_PARAMETERS][kAPI_PARAM_TAG]=e,i.parameters[kAPI_REQUEST_PARAMETERS][kAPI_PARAM_REF_COUNT]=kAPI_PARAM_COLLECTION_UNIT,$.ask_to_service(i,function(e){$.each(e[kAPI_RESPONSE_RESULTS],function(e,s){t.find(".dropdown-menu .dropdown-content > ul").append($.create_tree(s,a))}),a.removeClass("disabled"),t.find(".dropdown-toggle").dropdown("toggle"),t.find(".dropdown-menu > *").click(function(e){e.stopPropagation()}),t.find(".dropdown-menu").is(":visible")&&(t.find(".dropdown-menu .dropdown-header input").focus(),t.find(".dropdown-menu .dropdown-header input.form-control").focus(),t.find(".dropdown-menu .dropdown-header input.form-control").keyup(function(){var e=this,a=t.find(".dropdown-menu .dropdown-content > ul"),s=t.find(".dropdown-menu .dropdown-content > ul li");s.each(function(a,t){var r=$(t).text().toLowerCase(),i=$(e).val().toLowerCase();-1==r.indexOf(i)?s.eq(a).hide():($(".search-sf").remove(),s.eq(a).show())}),0===s.children(":visible").length&&0===a.find(".search-sf").length&&a.prepend('<div class="search-sf"><span class="text-muted">'+i18n[lang].messages.no_entries_found+"</span></div>")})),t.on("submit",function(){return!1})})},$.toggle_form_item=function(e,a){var t,s,r=e,i=r.closest("div.panel-collapse").parent().attr("id");if(r.hasClass("panel-mask")?(t=r.next(".panel"),s=r):(t=r.closest(".panel"),s=t.prev(".panel-mask")),t.find("a.pull-left span, a.pull-right span").hasClass("fa-square-o"))$("."+$.md5(a)+" > div.panel-mask").addClass("unselectable").attr("noclick",$("."+$.md5(a)+" > div.panel-mask").attr("onclick")).attr("onclick",""),r.closest("vcenter").removeClass("unselectable").attr("onclick",$("."+$.md5(a)+" > div.panel-mask").attr("noclick")).attr("noclick",""),t.find("a.pull-left, a.pull-right").tooltip("hide").find("span").removeClass("fa-square-o").addClass("fa-check-square-o"),t.find("a.pull-left").attr("data-original-title",i18n[lang].messages.disable_item),t.removeClass("disabled").attr("data-original-title","").tooltip("destroy").find(".panel-heading h3 > span, .panel-body").removeClass("disabled"),t.find("input").attr("disabled",!1).closest(".panel").find("input:not([type=hidden])").first().focus(),t.find("button").attr("disabled",!1),t.find(".chosen-select").length>0&&t.find(".chosen-select").prop("disabled",!1).trigger("chosen:updated"),t.find("a.treeselect").length>0&&t.activate_treeselect(a),s.fadeOut(300),$(".save_btn").removeClass("disabled");else{$("."+$.md5(a)+" > div.panel-mask").removeClass("unselectable").attr("onclick",$("."+$.md5(a)+" > div.panel-mask").attr("noclick")).attr("noclick","");var n=0;s.fadeIn(300),t.find("a.pull-left, a.pull-right").attr("data-original-title","Enable this item").tooltip("hide").find("span").removeClass("fa-check-square-o").addClass("fa-square-o"),t.addClass("disabled").attr("data-original-title","This item is disable").tooltip().find(".panel-heading h3 > span, .panel-body").addClass("disabled"),t.find("input").attr("disabled",!0),t.find("button").attr("disabled",!0),t.find(".chosen-select").length>0&&t.find(".chosen-select").prop("disabled",!0).trigger("chosen:updated"),t.find("a.treeselect").length>0&&t.find("a.treeselect").addClass("disabled"),$.each($("#accordion > div.panel-default"),function(){$.each($(this).find("div.panel-success:not(.disabled)"),function(){n++})}),$("#accordion .fulltext_search").length>0&&n++,0===n&&$(".save_btn").addClass("disabled"),t.prev(".panel-mask").css("display: block"),$.remove_storage("pgrdg_cache.search.criteria.selected_forms."+i)}},$.selected_form_menu=function(e,a,t){var s=a.replace("$","");$("#"+e+"_operator").attr("class","").addClass(s).text(t),"main_search"==e?($("#autocomplete ul.dropdown-menu li").removeClass("active"),$("#autocomplete ul.dropdown-menu li."+s).addClass("active")):($("#"+e+"_operator_type_ul li").removeClass("active"),$("#"+e+"_operator_type_ul li."+s).addClass("active"),$("#"+e+"_operator_type").val(a)),$("#"+e).focus()},$.get_operators_list=function(e,a){$.list_operators=function(e,a){"string"==jQuery.type(e)&&(e=jQuery.parseJSON(e)),void 0!==e[kAPI_RESPONSE_RESULTS].kAPI_OP_LIST_OPERATORS&&$.ask_to_service(e[kAPI_RESPONSE_RESULTS].kAPI_OP_LIST_OPERATORS,function(e){$.each(e.results,function(e,a){void 0!==a.label?operators.push({label:a.label,key:a.key,selected:a.selected,type:a.type,main:a.main,title:a.title}):"label"==e?operators.push({label:a}):"title"==e&&operators.push({title:a})}),"function"==$.type(a)&&a.call(this,e)})},void 0===e?$.check_storage(kAPI_OP_LIST_CONSTANTS,current_path,function(){$.check_storage(kAPI_OP_LIST_REF_COUNTS,current_path)}):$.list_operators(e,a)},$.get_static_forms=function(){$("#static_forms").html('<div class="list-group"></div>');var e={};e.storage_group="pgrdg_cache.local.forms_data",e[kAPI_REQUEST_OPERATION]=kAPI_OP_GET_NODE_FORM,e.parameters={},e.parameters[kAPI_REQUEST_LANGUAGE]=lang,e.parameters[kAPI_REQUEST_PARAMETERS]={},e.parameters[kAPI_REQUEST_PARAMETERS][kAPI_PARAM_NODE]="form::forms",e.parameters[kAPI_REQUEST_PARAMETERS][kAPI_PARAM_REF_COUNT]=kAPI_PARAM_COLLECTION_UNIT,$.ask_to_service(e,function(e){if("ok"==e[kAPI_RESPONSE_STATUS][kAPI_STATUS_STATE]&&$.obj_len(e[kAPI_RESPONSE_RESULTS])>0){var a=e[kAPI_RESPONSE_RESULTS];$.each(a,function(e,a){$("#static_forms").closest(".panel-body.contents").find("h4").html(a[kAPI_PARAM_RESPONSE_FRMT_NAME]+'<small class="help-block">'+a[kAPI_PARAM_RESPONSE_FRMT_INFO]+"</small>"),$.each(a.children,function(e,a){var t=$("<a>"),s=$("<span>");t.attr({href:"javascript: void(0);","data-node":a.node,id:a.node+"_link",onclick:"if(!$('#static_forms_list > ul#"+a.node+"').is(':visible')) { $(this).select_static_form('"+a.node+"'); }","data-toggle":"popover",title:void 0===a[kAPI_PARAM_RESPONSE_FRMT_INFO]?"":a[kAPI_PARAM_RESPONSE_FRMT_NAME],"data-content":void 0!==a[kAPI_PARAM_RESPONSE_FRMT_INFO]?a[kAPI_PARAM_RESPONSE_FRMT_INFO]:a[kAPI_PARAM_RESPONSE_FRMT_NAME]}).addClass("list-group-item").popover({placement:$(window).width()>420?"right":"top",container:"body",trigger:"hover"}),t.html('<span data-info="'+a[kAPI_PARAM_RESPONSE_FRMT_INFO]+'">'+a[kAPI_PARAM_RESPONSE_FRMT_NAME]+"</span>"+s.html()),s.addClass("fa fa-angle-right pull-right help-block"),$("#static_forms > div.list-group").append(t)})})}else $("#loader").addClass("text-warning").html('<span class="fa fa-times"></span> '+i18n[lang].messages.search.no_search_results.message)})},$.fn.select_static_form=function(e){$.generate_link=function(e,a,t){var s=$("#static_forms_list > ul.static_root").attr("data-storage"),r=$("<div>");if("object"==$.type(e)||"array"==$.type(e)){if(void 0!==e[kAPI_PARAM_RESPONSE_FRMT_NAME])if(void 0===e[kAPI_PARAM_TAG]||0===$.obj_len(e[kAPI_PARAM_TAG]))text=e[kAPI_PARAM_RESPONSE_FRMT_NAME];else{var i=$("<a>");i.attr({href:"javascript: void(0);",id:$.md5(e[kAPI_PARAM_TAG])+"_link","class":"btn btn-text"+(0===e[kAPI_PARAM_RESPONSE_COUNT]?" disabled text-muted":""),onclick:"$.generate_static_form('"+e[kAPI_PARAM_TAG]+"', '"+s+"')",title:void 0===e[kAPI_PARAM_RESPONSE_FRMT_INFO]?"":e[kAPI_PARAM_RESPONSE_FRMT_NAME],"data-toggle":"popover","data-content":void 0!==e[kAPI_PARAM_RESPONSE_FRMT_INFO]?e[kAPI_PARAM_RESPONSE_FRMT_INFO]:e[kAPI_PARAM_RESPONSE_FRMT_NAME],"data-parent":a,"data-storage":s}).text(e[kAPI_PARAM_RESPONSE_FRMT_NAME]).popover({container:"body",placement:$(window).width()>420?"right":"top",trigger:"hover"}),r.html(i),text=t?r.html():r.text()}}else"string"==$.type(e)&&(text=e);return(void 0===text||null===text||""===text)&&(text=i18n[lang].messages.static_forms.no_data),text},$.fn.generate_tree=function(e,a){$.fn.movearrow=function(){$(this).find("i").hasClass("fa-rotate-90")?$(this).find("i").removeClass("fa-rotate-90"):$(this).find("i").addClass("fa-rotate-90")};var t=$(this);$.each(e,function(e,s){var r=$("<li>");if(void 0!==s[kAPI_PARAM_RESPONSE_CHILDREN]&&$.obj_len(s[kAPI_PARAM_RESPONSE_CHILDREN])>0){void 0===s[kAPI_PARAM_TAG]||0===$.obj_len(s[kAPI_PARAM_TAG])?a?(r.addClass("list-unstyled"),r.html('<h3><a onclick="$(this).movearrow();" data-toggle="collapse" href="#'+s[kAPI_PARAM_NODE]+'"><i class="fa fa-caret-right"></i></a> '+$.generate_link(s,s[kAPI_PARAM_RESPONSE_FRMT_NAME],!0)+"</h3>")):r.html('<a href="javascript: void(0);" onclick="$(this).movearrow();" data-toggle="collapse" data-parent="#'+s[kAPI_PARAM_PARENT_NODE]+'" data-target="#'+s[kAPI_PARAM_NODE]+'"><i class="fa-li fa fa-caret-right"></i></a>'+$.generate_link(s,s[kAPI_PARAM_RESPONSE_FRMT_NAME],!0)):r.html('<i class="fa-li fa fa-angle-right"></i>'+$.generate_link(s,s[kAPI_PARAM_RESPONSE_FRMT_NAME],!0)),r.attr("title",$.generate_link(s,s[kAPI_PARAM_RESPONSE_FRMT_NAME]),!1);var i=$('<div class="">'),n=$("<ul>").attr({"class":"collapse fa-ul",id:s[kAPI_PARAM_NODE]});n.addClass(a?"static_root":"static_child"),n.generate_tree(s[kAPI_PARAM_RESPONSE_CHILDREN],!1,s[kAPI_PARAM_RESPONSE_FRMT_NAME]),i.append(n),r.append(i)}else void 0===s[kAPI_PARAM_TAG]||0===$.obj_len(s[kAPI_PARAM_TAG])?a?(r.addClass("list-unstyled"),r.html('<h3><a onclick="$(this).movearrow();" data-toggle="collapse" href="#'+s[kAPI_PARAM_NODE]+'"><i class="fa fa-caret-right"></i></a> '+$.generate_link(s,s[kAPI_PARAM_RESPONSE_FRMT_NAME],!0)+"</h3>")):r.html('<a href="javascript: void(0);" onclick="$(this).movearrow();" data-toggle="collapse" data-parent="#'+s[kAPI_PARAM_PARENT_NODE]+'" data-target="#'+s[kAPI_PARAM_NODE]+'"><i class="fa-li fa fa-caret-right"></i></a>'+$.generate_link(s,s[kAPI_PARAM_RESPONSE_FRMT_NAME],!0)):r.html('<i class="fa-li fa fa-angle-right"></i>'+$.generate_link(s,s[kAPI_PARAM_RESPONSE_FRMT_NAME],!0)),r.attr("title",$.generate_link(s,s[kAPI_PARAM_RESPONSE_FRMT_NAME]),!1);t.append(r)})};var a=$(this);void 0===e||"back"!==e?$("#loader").addClass("system").fadeIn(100,function(){var t=$("<a>");t.attr({href:"javascript: void(0);","data-node":a.attr("data-node"),onclick:"$(this).select_static_form('back');",title:a.find("span:first-child").attr("data-info")}).css("padding","0"),t.html('<h4><span class="fa fa-angle-left text-muted"></span>'+a.find("span:first-child").text()+"</h4>"),t.find("h4").append('<small class="help-block">'+a.find("span:first-child").attr("data-info")+"</small>"),$.each(a.closest(".panel-body.contents").find("a"),function(){$(this).removeClass("list-group-item-success")}),a.addClass("list-group-item-success"),"-300px"==a.closest(".panel-body.contents").css("left")||"-324px"==a.closest(".panel-body.contents").css("left")?(a.closest(".panel-body.contents").animate({left:"0px"},300),a.closest(".panel-body.contents").next().animate({left:$(window).width()<420?"-324px":"-300px"},300,function(){a.closest(".panel-body.contents").delay(300).animate({left:$(window).width()<420?"-324px":"-300px"},300),a.closest(".panel-body.contents").next().delay(300).animate({left:"0px"},300)})):(a.closest(".panel-body.contents").animate({left:$(window).width()<420?"-324px":"-300px"},300),a.closest(".panel-body.contents").next().animate({left:"0px"},300)),a.closest(".panel-body.contents").next().find("div.title.panel-heading").html(t);var s={};s.storage_group="pgrdg_cache.local.forms_data",s[kAPI_REQUEST_OPERATION]=kAPI_OP_GET_NODE_FORM,s.parameters={},s.parameters[kAPI_REQUEST_LANGUAGE]=lang,s.parameters[kAPI_REQUEST_PARAMETERS]={},s.parameters[kAPI_REQUEST_PARAMETERS][kAPI_PARAM_NODE]=parseInt(e),s.parameters[kAPI_REQUEST_PARAMETERS][kAPI_PARAM_REF_COUNT]=kAPI_PARAM_COLLECTION_UNIT,$.ask_to_service(s,function(t){if("ok"==t[kAPI_RESPONSE_STATUS][kAPI_STATUS_STATE]&&$.obj_len(t[kAPI_RESPONSE_RESULTS])>0){var s=t[kAPI_RESPONSE_RESULTS];$("#static_forms_loader").hide(),$("#static_forms_list").html(""),$("#static_forms_list").append('<ul id="'+parseInt(e)+'" data-storage="'+t.id+'">'),(void 0===s[kAPI_PARAM_TAG]||0===$.obj_len(s[kAPI_PARAM_TAG]))&&$("#static_forms_list ul#"+parseInt(e)).addClass("static_root").attr("data-root",a.find("span:first-child").text()),s[0].root_node=s[0][kAPI_PARAM_RESPONSE_FRMT_NAME],$("#static_forms_list ul#"+parseInt(e)).generate_tree(s[0][kAPI_PARAM_RESPONSE_CHILDREN],!0,parseInt(e)),$("#static_forms_list a:not(.disabled)").popover({placement:$(window).width()>420?"right":"top",container:"body",trigger:"hover"}),$.each($("#accordion div.panel-mask"),function(){var e=$(this).attr("id");$("#"+e+"_link").addClass("text-warning disabled")})}$("#loader").hide()})}):(a.closest(".panel-body.contents").animate({left:$(window).width()<420?"324px":"300px"},300),a.closest(".panel-body.contents").prev().animate({left:"0px"},300,function(){$(this).find("h4.title").text(""),$("#static_forms_list").html(""),$("#static_forms_loader").show()}))},$.generate_static_form=function(e,a,t){var s={};s.storage_group="pgrdg_cache.search.criteria.forms",s[kAPI_REQUEST_OPERATION]=kAPI_OP_MATCH_TAG_BY_IDENTIFIER,s.parameters={},s.parameters[kAPI_REQUEST_LANGUAGE]=lang,s.parameters[kAPI_REQUEST_PARAMETERS]={},s.parameters[kAPI_REQUEST_PARAMETERS][kAPI_PARAM_TAG]=e,s.parameters[kAPI_REQUEST_PARAMETERS][kAPI_PARAM_REF_COUNT]=kAPI_PARAM_COLLECTION_UNIT,$.ask_to_service(s,function(s){if("ok"==s[kAPI_RESPONSE_STATUS][kAPI_STATUS_STATE]&&$.obj_len(s[kAPI_RESPONSE_RESULTS])>0&&0===$("#accordion > #"+s.id).length){var r=[];if(s[kAPI_RESPONSE_PAGING][kAPI_PAGING_AFFECTED]>0&&($.manage_url("Forms"),$.breadcrumb_right_buttons(),$(window).width()<420&&$.left_panel("close"),$("#forms-head #right_btn, #forms-footer #right_btn").html('<span class="ionicons ion-trash-b"></span> '+i18n[lang].interface.btns.reset_all).fadeIn(300,function(){$("#forms-head #right_btn, #forms-footer #right_btn").on("click",function(){$.reset_all_searches(!0)})}),$("section.container").animate({"padding-top":"40px"}),$("#breadcrumb").animate({top:"75px"}),0===$("#forms-head .btn-group a.save_btn").length&&(btn_disabled="disabled",$("#forms-head .btn-group").append('<a href="javascript: void(0);" class="btn btn-orange save_btn '+btn_disabled+'">'+i18n[lang].interface.btns.search+' <span class="fa fa-chevron-right"></span></a>'),$("#forms-footer .btn-group").append('<a href="javascript: void(0);" class="btn btn-orange save_btn '+btn_disabled+'">'+i18n[lang].interface.btns.search+' <span class="fa fa-chevron-right"></span></a>')),"none"==$("#breadcrumb").css("display")&&$("#breadcrumb").fadeIn(200),0===$("#"+$.md5(e)).length)){var i=$("#"+$.md5(e)+"_link");i.addClass("text-warning disabled");var n=i.closest("ul.static_root").attr("id"),_=i.closest("ul.static_root").attr("data-root");r.push('<a title="'+i18n[lang].interface.jump_to_this_panel+'" href="javascript: void(0);" onclick="$(\'#'+n+"_link').select_static_form('"+n+"')\">"+_+"</a>"),r.push(i.closest("ul.static_child").prev("h3").text()),storage.set("pgrdg_cache.search.criteria.forms."+s.id+".response.storage_id",a),storage.set("pgrdg_cache.search.criteria.forms."+s.id+".response.parent",i.attr("data-parent"));var l=$.create_form(s,!0);if($("#forms-head .content-title").html('Output for "'+i.text()+'"'),0===$("#forms-head div.clearfix + .help-block").length&&$("#forms-head").append('<div class="help-block">'+i18n[lang].interface.form_help_text+"</div>"),$("#forms").fadeIn(300),$.storage_exists("pgrdg_cache.search.criteria.fulltext")&&0===$("#"+$.md5(storage.get("pgrdg_cache.search.criteria.fulltext"))).length&&$("#forms-body .content-body").addCollapsible({id:$.md5(storage.get("pgrdg_cache.search.criteria.fulltext")),"class":"fulltext_search",icon:"fa fa-edit",expandable:!1,title:'<span class="text-info">'+i18n[lang].messages.search.fulltext.fulltext_search+':</span> <a title="'+i18n[lang].messages.search.fulltext.goto_search+'" href="./Search?q='+$.rawurlencode(storage.get("pgrdg_cache.search.criteria.fulltext"))+'"><span style="color: #dd1144">'+storage.get("pgrdg_cache.search.criteria.fulltext").replace(/"/g,"&quot;")+"</span></a>",content:""}),$.storage_exists("pgrdg_cache.search.criteria.select_map_area")){var o="",c="";o=$.storage_exists("pgrdg_cache.search.criteria.select_map_area.zone")?storage.get("pgrdg_cache.search.criteria.select_map_area.zone.name"):storage.get("pgrdg_cache.search.criteria.select_map_area.coordinates").join(", "),c=storage.get("pgrdg_cache.search.criteria.select_map_area.zone.ccode"),0===$("#"+$.md5(storage.get("pgrdg_cache.search.criteria.select_map_area"))).length&&$("#forms-body .content-body").addCollapsible({id:$.md5(storage.get("pgrdg_cache.search.criteria.select_map_area")),"class":"select_map_area_search",icon:"mg map-"+c,expandable:!1,title:'<span class="text-success">'+i18n[lang].messages.search.select_map_area.geo_area_near.replace("{X}",'<span class="text-warning">'+o+"</span>")+"</span>",content:""})}$("#forms-body .content-body").addCollapsible({id:$.md5(i.closest("ul.static_child").prev("h3").text()),title:r.join('<span class="fa fa-fw fa-angle-right text-muted"></span>'),content:l}),$("input.switch").bootstrapSwitch(),$("input.switch").on("switchChange.bootstrapSwitch",function(e,a){$(this).parent().find("input[type='checkbox']").attr("checked",a)}),$("#forms-body .panel").tooltip(),$.storage_exists("pgrdg_cache.search.criteria.selected_forms")&&($.each(storage.get("pgrdg_cache.search.criteria.selected_forms"),function(e,a){{var t=$("#"+$.md5(a.forms.tags)).next(".panel");t.find("a.treeselect")}$("#"+$.md5(a.forms.tags)).addClass("unselectable").hide(),t.removeClass("disabled").find(".panel-heading a > span").removeClass("fa-square-o").addClass("fa-check-square-o"),t.find(".panel-heading h3 > span, .panel-body").addClass("disabled"),t.find("input").prop("disabled",!1),t.find("button").prop("disabled",!1),t.find("a.treeselect").length>0&&t.activate_treeselect(a.forms.tags)}),$(".save_btn").removeClass("disabled")),$.activate_form_btns(),"function"==$.type(t)&&t.call(this)}}})},$.fn.execute_search=function(e){var a=$(this),t={},s={},r={};frm_keys=$(this).attr("id"),a.hasClass("disabled")||($("#accordion > div.panel-default").find("div.panel-success:not(.disabled)").length>0?$.each($("#accordion").find("div.panel-success:not(.disabled)"),function(){switch(s=$(this).find("form").serializeObject(),-1==s[kAPI_PARAM_OFFSETS].indexOf(",")?e.push(s[kAPI_PARAM_OFFSETS]):e=s[kAPI_PARAM_OFFSETS].split(","),s[kAPI_PARAM_OFFSETS]==s.default_offsets_input&&(e=[]),s["input-type"]){case kAPI_PARAM_INPUT_ENUM:r[kAPI_PARAM_INPUT_TYPE]=s[kAPI_PARAM_INPUT_TYPE],e.length>0&&(r[kAPI_PARAM_OFFSETS]=e),r[kAPI_RESULT_ENUM_TERM]=s.term.split(","),t[s.tags]=r;break;case kAPI_PARAM_INPUT_RANGE:r[kAPI_PARAM_INPUT_TYPE]=s[kAPI_PARAM_INPUT_TYPE],e.length>0&&(r[kAPI_PARAM_OFFSETS]=e),r[kAPI_PARAM_RANGE_MIN]=parseInt(s.from),r[kAPI_PARAM_RANGE_MAX]=parseInt(s.to),r[kAPI_PARAM_OPERATOR]=[s.operator],t[s.tags]=r;break;case kAPI_PARAM_INPUT_STRING:r[kAPI_PARAM_INPUT_TYPE]=s[kAPI_PARAM_INPUT_TYPE],e.length>0&&(r[kAPI_PARAM_OFFSETS]=e),r[kAPI_PARAM_PATTERN]=s.stringselect,r[kAPI_PARAM_OPERATOR]=[s.operator,s.case_sensitive],t[s.tags]=r;break;case kAPI_PARAM_INPUT_SHAPE:break;case kAPI_PARAM_INPUT_DEFAULT:switch(r[kAPI_PARAM_INPUT_TYPE]=s[kAPI_PARAM_INPUT_TYPE],e.length>0&&(r[kAPI_PARAM_OFFSETS]=e),s[kTAG_TYPE]){case kTYPE_BOOLEAN:r[kAPI_PARAM_PATTERN]=void 0!==s.boolean&&"on"==s.boolean?!0:!1}t[s.tags]=r}storage.set("pgrdg_cache.search.criteria.selected_forms."+frm_keys,{request:storage.get("pgrdg_cache.search.criteria.forms."+frm_keys),key:$(this).attr("id"),forms:$(this).find("form").serializeObject(),active_forms:t}),$.breadcrumb_right_buttons()}):(storage.set("pgrdg_cache.search.criteria.selected_forms."+frm_keys,{request:{},key:$(this).attr("id"),forms:{},active_forms:t}),$.breadcrumb_right_buttons()),$("#goto_results_btn, #goto_map_btn").addClass("hidden"),$.remove_storage("pgrdg_cache.summary"),$.remove_storage("pgrdg_cache.results"),$.remove_storage("pgrdg_cache.map"),$.show_summary($.get_storage_selected_forms()),$.toggle_form_item($("#"+$.md5(s.tags)),s.tags))},$.get_storage_selected_forms=function(){var e={};return $.storage_exists("pgrdg_cache.search.criteria.selected_forms")&&$.each(storage.get("pgrdg_cache.search.criteria.selected_forms"),function(a,t){$.each(t.active_forms,function(a,t){e[a]=t})}),e},$.activate_form_btns=function(){var e=[];$("#accordion > div.panel-default").length>0&&$("#forms-head .btn-group a.save_btn, #forms-footer .btn-group a.save_btn").fadeIn(300,function(){$(this).on("click",function(){$(this).execute_search(e)})})},$.exec_autocomplete=function(e){$.manage_url("Forms"),$.breadcrumb_right_buttons();var a=!1;switch(e){case"autocomplete":var t={};return t.storage_group="pgrdg_cache.search.criteria.forms",t[kAPI_REQUEST_OPERATION]=kAPI_OP_MATCH_TAG_BY_LABEL,t.parameters={},t.parameters[kAPI_REQUEST_LANGUAGE]=lang,t.parameters[kAPI_REQUEST_PARAMETERS]={},t.parameters[kAPI_REQUEST_PARAMETERS][kAPI_PARAM_LOG_REQUEST]=!0,t.parameters[kAPI_REQUEST_PARAMETERS][kAPI_PAGING_LIMIT]=50,t.parameters[kAPI_REQUEST_PARAMETERS][kAPI_PARAM_REF_COUNT]=kAPI_PARAM_COLLECTION_UNIT,t.parameters[kAPI_REQUEST_PARAMETERS][kAPI_PARAM_PATTERN]=$("#main_search").val(),t.parameters[kAPI_REQUEST_PARAMETERS][kAPI_PARAM_OPERATOR]=["$EQ"],$.execTraitAutocomplete(t,function(e){if($.breadcrumb_right_buttons(),0===$("#accordion > #"+e.id).length){var a="";if(e[kAPI_RESPONSE_PAGING][kAPI_PAGING_AFFECTED]>0){$("#forms-head .content-title").html('Output for "'+$("#main_search").val()+'"'),0===$("#forms-head div.clearfix + .help-block").length&&$("#forms-head").append('<div class="help-block">'+i18n[lang].interface.form_help_text+"</div>"),$.each(operators,function(e,s){s.key==t.parameters[kAPI_REQUEST_PARAMETERS][kAPI_PARAM_OPERATOR][0]&&(s.main?a=s.title:a+=' <i style="color: #666;">'+s.title+"</i>")});var s=$.create_form(e,!0);if($.storage_exists("pgrdg_cache.search.criteria.fulltext")&&0===$("#"+$.md5(storage.get("pgrdg_cache.search.criteria.fulltext"))).length&&$("#forms-body .content-body").addCollapsible({id:$.md5(storage.get("pgrdg_cache.search.criteria.fulltext")),"class":"fulltext_search",icon:"fa fa-edit",expandable:!1,title:'<span class="text-info">'+i18n[lang].messages.search.fulltext.fulltext_search+':</span> <a title="'+i18n[lang].messages.search.fulltext.goto_search+'" href="./Search?q='+$.rawurlencode(storage.get("pgrdg_cache.search.criteria.fulltext"))+'"><span style="color: #dd1144">'+storage.get("pgrdg_cache.search.criteria.fulltext").replace(/"/g,"&quot;")+"</span></a>",content:""}),$.storage_exists("pgrdg_cache.search.criteria.select_map_area")&&0===$("#"+$.md5(storage.get("pgrdg_cache.search.criteria.select_map_area"))).length){var r,i="";i=$.storage_exists("pgrdg_cache.search.criteria.select_map_area.zone")?storage.get("pgrdg_cache.search.criteria.select_map_area.zone.name"):storage.get("pgrdg_cache.search.criteria.select_map_area.coordinates").join(", "),r=storage.get("pgrdg_cache.search.criteria.select_map_area.zone.ccode"),$("#forms-body .content-body").addCollapsible({id:$.md5(storage.get("pgrdg_cache.search.criteria.select_map_area")),"class":"select_map_area_search",icon:"mg map-"+r,expandable:!1,title:'<span class="text-success">'+i18n[lang].messages.search.select_map_area.geo_area_near.replace("{X}",'<span class="text-warning">'+i+"</span>")+"</span>",content:""})
}$("#forms-body .content-body").addCollapsible({id:e.id,title:a.replace("@pattern@",'<span style="color: #dd1144">"'+$("#main_search").val()+'"</span>'),content:s}),$("input.switch").bootstrapSwitch(),$("input.switch").on("switchChange.bootstrapSwitch",function(e,a){$(this).parent().find("input[type='checkbox']").attr("checked",a)}),$("#forms-body .panel").tooltip(),$("#autocomplete .typeahead").trigger("blur")}}}),!0;case"input":if($("#main_search").val().length>=3&&!a){storage.set("pgrdg_cache.search.criteria.traitAutocomplete",{text:$("#main_search").val(),type:"input"});var t={};t.storage_group="pgrdg_cache.search.criteria.forms",t[kAPI_REQUEST_OPERATION]=kAPI_OP_MATCH_TAG_BY_LABEL,t.parameters={},t.parameters[kAPI_REQUEST_LANGUAGE]=lang,t.parameters[kAPI_REQUEST_PARAMETERS]={},t.parameters[kAPI_REQUEST_PARAMETERS][kAPI_PARAM_LOG_REQUEST]=!0,t.parameters[kAPI_REQUEST_PARAMETERS][kAPI_PAGING_LIMIT]=50,t.parameters[kAPI_REQUEST_PARAMETERS][kAPI_PARAM_REF_COUNT]=kAPI_PARAM_COLLECTION_UNIT,t.parameters[kAPI_REQUEST_PARAMETERS][kAPI_PARAM_PATTERN]=$("#main_search").val(),t.parameters[kAPI_REQUEST_PARAMETERS][kAPI_PARAM_OPERATOR]=["$"+$("#main_search_operator").attr("class"),$("#main_search_operator_i").is(":checked")?"$i":'"'],$.execTraitAutocomplete(t,function(e){if(0===$("#accordion > #"+e.id).length){var a="";if(e[kAPI_RESPONSE_PAGING][kAPI_PAGING_AFFECTED]>0){$.each(operators,function(e,s){$.each(t.parameters[kAPI_REQUEST_PARAMETERS][kAPI_PARAM_OPERATOR],function(e,t){t==s.key&&(s.main?a=s.title:a+=' <i style="color: #666;">'+s.title+"</i>")})});var s=$.create_form(e,!0);if($("#forms-head .content-title").html('Output for "'+$("#main_search").val()+'"'),0===$("#forms-head div.clearfix + .help-block").length&&$("#forms-head").append('<div class="help-block">'+i18n[lang].interface.form_help_text+"</div>"),$("#forms").fadeIn(300),$.storage_exists("pgrdg_cache.search.criteria.fulltext")&&0===$("#"+$.md5(storage.get("pgrdg_cache.search.criteria.fulltext"))).length&&$("#forms-body .content-body").addCollapsible({id:$.md5(storage.get("pgrdg_cache.search.criteria.fulltext")),"class":"fulltext_search",icon:"fa fa-edit",expandable:!1,title:'<span class="text-info">'+i18n[lang].messages.search.fulltext.fulltext_search+':</span> <a title="'+i18n[lang].messages.search.fulltext.goto_search+'" href="./Search?q='+$.rawurlencode(storage.get("pgrdg_cache.search.criteria.fulltext"))+'"><span style="color: #dd1144">'+storage.get("pgrdg_cache.search.criteria.fulltext").replace(/"/g,"&quot;")+"</span></a>",content:""}),$.storage_exists("pgrdg_cache.search.criteria.select_map_area")&&0===$("#"+$.md5(storage.get("pgrdg_cache.search.criteria.select_map_area"))).length){var r="",i="";r=$.storage_exists("pgrdg_cache.search.criteria.select_map_area.zone")?storage.get("pgrdg_cache.search.criteria.select_map_area.zone.name"):storage.get("pgrdg_cache.search.criteria.select_map_area.coordinates").join(", "),i=storage.get("pgrdg_cache.search.criteria.select_map_area.zone.ccode"),$("#forms-body .content-body").addCollapsible({id:$.md5(storage.get("pgrdg_cache.search.criteria.select_map_area")),"class":"select_map_area_search",icon:"mg map-"+i,expandable:!1,title:'<span class="text-success">'+i18n[lang].messages.search.select_map_area.geo_area_near.replace("{X}",'<span class="text-warning">'+r+"</span>")+"</span>",content:""})}$("#forms-body .content-body").addCollapsible({id:e.id,title:a.replace("@pattern@",'<span style="color: #dd1144">"'+$("#main_search").val()+'"</span>'),content:s}),$("input.switch").bootstrapSwitch(),$("input.switch").on("switchChange.bootstrapSwitch",function(e,a){$(this).parent().find("input[type='checkbox']").attr("checked",a)}),$("#forms-body .panel").tooltip(),$(".tt-dropdown-menu").css("display","none"),$("#autocomplete .typeahead").trigger("blur")}}})}return!1;case"restore":var s="";if($.storage_exists("pgrdg_cache.search.criteria.forms"))return $.each(storage.get("pgrdg_cache.search.criteria.forms"),function(e,a){var t=a.response;if(t[kAPI_RESPONSE_PAGING][kAPI_PAGING_AFFECTED]>0){if($(window).width()<420&&$.left_panel("close"),$("#forms-head #right_btn, #forms-footer #right_btn").html('<span class="ionicons ion-trash-b"></span> '+i18n[lang].interface.btns.reset_all).fadeIn(300,function(){$("#forms-head #right_btn, #forms-footer #right_btn").on("click",function(){$.reset_all_searches(!0)})}),$("section.container").animate({"padding-top":"40px"}),$("#breadcrumb").animate({top:"75px"}),0===$("#forms-head .btn-group a.save_btn").length&&(s=$("#accordion .panel.fulltext_search").length>0?"":"disabled",$("#forms-head .btn-group").append('<a href="javascript: void(0);" class="btn btn-orange save_btn '+s+'" style="display: none;">'+i18n[lang].interface.btns.search+' <span class="fa fa-chevron-right"></span></a>'),$("#forms-footer .btn-group").append('<a href="javascript: void(0);" class="btn btn-orange save_btn '+s+'" style="display: none;">'+i18n[lang].interface.btns.search+' <span class="fa fa-chevron-right"></span></a>')),"none"==$("#breadcrumb").css("display")&&$("#breadcrumb").fadeIn(200),void 0!==t[kAPI_RESPONSE_REQUEST]&&$.obj_len(t[kAPI_RESPONSE_REQUEST])>0){var r="",i="",n=t.id;$.each(operators,function(e,a){$.each(t[kAPI_RESPONSE_REQUEST][kAPI_PARAM_OPERATOR],function(e,t){t==a.key&&(a.main?r=a.title:r+=' <i style="color: #666;">'+a.title+"</i>")})}),i=r.replace("@pattern@",'<span style="color: #dd1144"> "'+t[kAPI_RESPONSE_REQUEST][kAPI_PARAM_PATTERN]+'"</span>')}else if(void 0!==t.storage_id&&null!==t.storage_id&&""!==t.storage_id){var _=t.query.obj[kAPI_REQUEST_PARAMETERS][kAPI_PARAM_TAG],l=$("#"+$.md5(_)+"_link"),r=[],i="",n="",o=(t.storage_id,storage.get("pgrdg_cache.local.forms_data."+t.storage_id+".response."+kAPI_RESPONSE_RESULTS)),c=o[0][kAPI_RESULT_ENUM_NODE],d=o[0][kAPI_PARAM_RESPONSE_FRMT_NAME],p=t.parent,n=$.md5(p);l.addClass("disabled"),0===$("#"+n).length&&(void 0!==d&&r.push('<a title="'+i18n[lang].interface.jump_to_this_panel+'" href="javascript: void(0);" onclick="if(!$(\'#static_forms_list > ul#'+c+"').is(':visible')) { $('#"+c+"_link').select_static_form('"+c+"'); }\">"+d+"</a>"),r.push(p),i=$.array_unique($.array_clean(r)).join('<span class="fa fa-fw fa-angle-right text-muted"></span>'))}var A=$.create_form(t,!0);if(grouping_no=0,$.storage_exists("pgrdg_cache.search.criteria.grouping._ordering")&&(grouping_no=$.obj_len(storage.get("pgrdg_cache.search.criteria.grouping._ordering"))),$("#forms-head .content-title").html(i18n[lang].messages.search.output_last_search+(grouping_no>0?' <sup><a title="'+i18n[lang].interface.btns.change_group_filters+'" href="javascript: void(0);" onclick="$.show_summary($.get_storage_selected_forms(), false, function() { $(\'#collapsed_group_form\').collapse(\'show\'); });"><small class="text-danger" style="font-family: Arial, Helvetica;">'+grouping_no+" groups</small></a></sup>":"")),0===$("#forms-head div.clearfix + .help-block").length&&$("#forms-head").append('<div class="help-block">'+i18n[lang].interface.form_help_text+"</div>"),$("#forms").fadeIn(300),$.storage_exists("pgrdg_cache.search.criteria.fulltext")&&0===$("#"+$.md5(storage.get("pgrdg_cache.search.criteria.fulltext"))).length&&$("#forms-body .content-body").addCollapsible({id:$.md5(storage.get("pgrdg_cache.search.criteria.fulltext")),"class":"fulltext_search",icon:"fa fa-edit",expandable:!1,title:'<span class="text-info">'+i18n[lang].messages.search.fulltext.fulltext_search+':</span> <a title="'+i18n[lang].messages.search.fulltext.goto_search+'" href="./Search?q='+$.rawurlencode(storage.get("pgrdg_cache.search.criteria.fulltext"))+'"><span style="color: #dd1144">'+storage.get("pgrdg_cache.search.criteria.fulltext").replace(/"/g,"&quot;")+"</span></a>",content:""}),$.storage_exists("pgrdg_cache.search.criteria.select_map_area")&&0===$("#"+$.md5(storage.get("pgrdg_cache.search.criteria.select_map_area"))).length){var g="",h="";g=$.storage_exists("pgrdg_cache.search.criteria.select_map_area.zone")?storage.get("pgrdg_cache.search.criteria.select_map_area.zone.name"):storage.get("pgrdg_cache.search.criteria.select_map_area.coordinates").join(", "),h=storage.get("pgrdg_cache.search.criteria.select_map_area.zone.ccode"),$("#forms-body .content-body").addCollapsible({id:$.md5(storage.get("pgrdg_cache.search.criteria.select_map_area")),"class":"select_map_area_search",icon:"mg map-"+h,expandable:!1,title:'<span class="text-success">'+i18n[lang].messages.search.select_map_area.geo_area_near.replace("{X}",'<span class="text-warning">'+g+"</span>")+"</span>",content:""})}$("#forms-body .content-body").addCollapsible({id:n,title:i,content:A}),$("input.switch").bootstrapSwitch(),$("input.switch").on("switchChange.bootstrapSwitch",function(e,a){$(this).parent().find("input[type='checkbox']").attr("checked",a)}),$("#forms-body .panel").tooltip(),$(".tt-dropdown-menu").css("display","none"),$("#autocomplete .typeahead").trigger("blur"),$.storage_exists("pgrdg_cache.search.criteria.selected_forms")&&($.each(storage.get("pgrdg_cache.search.criteria.selected_forms"),function(e,a){{var t=$("#"+$.md5(a.forms.tags)).next(".panel");t.find("a.treeselect")}$("#"+$.md5(a.forms.tags)).addClass("unselectable").hide(),t.removeClass("disabled").find(".panel-heading a > span").removeClass("fa-square-o").addClass("fa-check-square-o"),t.find(".panel-heading h3 > span, .panel-body").addClass("disabled"),t.find("input").prop("disabled",!1),t.find("button").prop("disabled",!1),t.find("a.treeselect").length>0&&t.activate_treeselect(a.forms.tags)}),$(".save_btn").removeClass("disabled")),$.activate_form_btns()}}),!1;if($.storage_exists("pgrdg_cache.search.criteria.fulltext")||$.storage_exists("pgrdg_cache.search.criteria.select_map_area")){if($(window).width()<420&&$.left_panel("close"),$("#forms-head #right_btn, #forms-footer #right_btn").html('<span class="ionicons ion-trash-b"></span> '+i18n[lang].interface.btns.reset_all).fadeIn(300,function(){$("#forms-head #right_btn, #forms-footer #right_btn").on("click",function(){$.reset_all_searches(!0)})}),$("section.container").animate({"padding-top":"40px"}),$("#breadcrumb").animate({top:"75px"}),0===$("#forms-head .btn-group a.save_btn").length&&($("#forms-head .btn-group").append('<a href="javascript: void(0);" class="btn btn-orange save_btn" style="display: none;">'+i18n[lang].interface.btns.search+' <span class="fa fa-chevron-right"></span></a>'),$("#forms-footer .btn-group").append('<a href="javascript: void(0);" class="btn btn-orange save_btn" style="display: none;">'+i18n[lang].interface.btns.search+' <span class="fa fa-chevron-right"></span></a>')),"none"==$("#breadcrumb").css("display")&&$("#breadcrumb").fadeIn(200),$("#forms-head .content-title").html(i18n[lang].messages.search.output_last_search),0===$("#forms-head div.clearfix + .help-block").length&&$("#forms-head").append('<div class="help-block">'+i18n[lang].interface.form_help_text+"</div>"),$("#forms").fadeIn(300),$.storage_exists("pgrdg_cache.search.criteria.fulltext")&&0===$("#"+$.md5(storage.get("pgrdg_cache.search.criteria.fulltext"))).length){var r=[],i="";if($.storage_exists("pgrdg_cache.search.criteria.grouping._ordering")){i=', <i class="text-muted">grouped by ',$.each(storage.get("pgrdg_cache.search.criteria.grouping._ordering"),function(e,a){r.push(a[kAPI_PARAM_RESPONSE_FRMT_NAME])});for(var n=0;n<r.length;n++)i+=r[n],n<r.length-2?i+=", ":n<r.length-1&&(i+=" and ");i+="</i>"}$("#forms-body .content-body").addCollapsible({id:$.md5(storage.get("pgrdg_cache.search.criteria.fulltext")),"class":"fulltext_search",icon:"fa fa-edit",expandable:!1,title:'<span class="text-info">'+i18n[lang].messages.search.fulltext.fulltext_search+':</span> <a title="'+i18n[lang].messages.search.fulltext.goto_search+'" href="./Search?q='+$.rawurlencode(storage.get("pgrdg_cache.search.criteria.fulltext"))+'"><span style="color: #dd1144">'+storage.get("pgrdg_cache.search.criteria.fulltext").replace(/"/g,"&quot;")+"</span></a>"+i,content:""})}if($.storage_exists("pgrdg_cache.search.criteria.select_map_area")&&0===$("#"+$.md5(storage.get("pgrdg_cache.search.criteria.select_map_area"))).length){var r=[],i="";if($.storage_exists("pgrdg_cache.search.criteria.grouping._ordering")){i=', <i class="text-muted">grouped by ',$.each(storage.get("pgrdg_cache.search.criteria.grouping._ordering"),function(e,a){r.push(a[kAPI_PARAM_RESPONSE_FRMT_NAME])});for(var n=0;n<r.length;n++)i+=r[n],n<r.length-2?i+=", ":n<r.length-1&&(i+=" and ");i+="</i>"}var _="",l="";_=$.storage_exists("pgrdg_cache.search.criteria.select_map_area.zone")?storage.get("pgrdg_cache.search.criteria.select_map_area.zone.name"):storage.get("pgrdg_cache.search.criteria.select_map_area.coordinates").join(", "),l=storage.get("pgrdg_cache.search.criteria.select_map_area.zone.ccode"),$("#forms-body .content-body").addCollapsible({id:$.md5(storage.get("pgrdg_cache.search.criteria.select_map_area")),"class":"select_map_area_search",icon:"mg map-"+l,expandable:!1,title:'<span class="text-success">'+i18n[lang].messages.search.select_map_area.geo_area_near.replace("{X}",'<span class="text-warning">'+_+"</span>")+"</span>",content:""})}$("#forms-body .panel").tooltip(),$("#forms-head .btn-group a.save_btn, #forms-footer .btn-group a.save_btn").fadeIn(300,function(){$("#goto_results_btn, #goto_map_btn").addClass("hidden"),$.remove_storage("pgrdg_cache.summary"),$.remove_storage("pgrdg_cache.results"),$.remove_storage("pgrdg_cache.map"),$.activate_form_btns()})}}},$.execTraitAutocomplete=function(e,a){var t={},s="";$.ask_to_service(e,function(e){"function"==jQuery.type(a)&&(e[kAPI_RESPONSE_PAGING][kAPI_PAGING_AFFECTED]>0?($(window).width()<420&&$.left_panel("close"),$("#forms-head #right_btn, #forms-footer #right_btn").html('<span class="ionicons ion-trash-b"></span> '+i18n[lang].interface.btns.reset_all).fadeIn(300,function(){$("#forms-head #right_btn, #forms-footer #right_btn").on("click",function(){$.reset_all_searches(!0)})}),$("section.container").animate({"padding-top":"40px"}),$("#breadcrumb").animate({top:"75px"}),0===$("#forms-head .btn-group a.save_btn").length&&(s=$("#accordion .panel.fulltext_search").length>0?"":"disabled",$("#forms-head .btn-group").append('<a href="javascript: void(0);" class="btn btn-orange save_btn '+s+'" style="display: none;">'+i18n[lang].interface.btns.search+' <span class="fa fa-chevron-right"></span></a>'),$("#forms-footer .btn-group").append('<a href="javascript: void(0);" class="btn btn-orange save_btn '+s+'" style="display: none;">'+i18n[lang].interface.btns.search+' <span class="fa fa-chevron-right"></span></a>')),"none"==$("#breadcrumb").css("display")&&$("#breadcrumb").fadeIn(200),$("#forms").fadeIn(300),$("#forms-head .btn-group a.save_btn, #forms-footer .btn-group a.save_btn").fadeIn(300,function(){$(this).on("click",function(){var e=[];t.history=storage.get("pgrdg_cache.search.criteria.forms"),$.each($("#accordion > div.panel-default"),function(){var a={},t={};frm_keys=$(this).attr("id"),$.each($(this).find("div.panel-success:not(.disabled)"),function(){switch(t=$(this).find("form").serializeObject(),rt={},-1==t[kAPI_PARAM_OFFSETS].indexOf(",")?e.push(t[kAPI_PARAM_OFFSETS]):e=t[kAPI_PARAM_OFFSETS].split(","),t[kAPI_PARAM_OFFSETS]==t.default_offsets_input&&(e=[]),t["input-type"]){case kAPI_PARAM_INPUT_ENUM:rt[kAPI_PARAM_INPUT_TYPE]=t[kAPI_PARAM_INPUT_TYPE],e.length>0&&(rt[kAPI_PARAM_OFFSETS]=e),rt[kAPI_RESULT_ENUM_TERM]=t.term.split(","),a[t.tags]=rt;break;case kAPI_PARAM_INPUT_RANGE:rt[kAPI_PARAM_INPUT_TYPE]=t[kAPI_PARAM_INPUT_TYPE],e.length>0&&(rt[kAPI_PARAM_OFFSETS]=e),rt[kAPI_PARAM_RANGE_MIN]=parseInt(t.from),rt[kAPI_PARAM_RANGE_MAX]=parseInt(t.to),rt[kAPI_PARAM_OPERATOR]=[t.operator],a[t.tags]=rt;break;case kAPI_PARAM_INPUT_STRING:rt[kAPI_PARAM_INPUT_TYPE]=t[kAPI_PARAM_INPUT_TYPE],e.length>0&&(rt[kAPI_PARAM_OFFSETS]=e),rt[kAPI_PARAM_PATTERN]=t.stringselect,rt[kAPI_PARAM_OPERATOR]=[t.operator,t.case_sensitive],a[t.tags]=rt;break;case kAPI_PARAM_INPUT_SHAPE:break;case kAPI_PARAM_INPUT_DEFAULT:switch(rt[kAPI_PARAM_INPUT_TYPE]=t[kAPI_PARAM_INPUT_TYPE],e.length>0&&(rt[kAPI_PARAM_OFFSETS]=e),t[kTAG_TYPE]){case kTYPE_BOOLEAN:rt[kAPI_PARAM_PATTERN]=void 0!==t.boolean&&"on"==t.boolean?!0:!1}a[t.tags]=rt}storage.set("pgrdg_cache.search.criteria.selected_forms."+frm_keys,{request:storage.get("pgrdg_cache.search.criteria.forms."+frm_keys),key:$(this).attr("id"),forms:$(this).find("form").serializeObject(),active_forms:a}),$.breadcrumb_right_buttons()})}),$("#goto_results_btn, #goto_map_btn").addClass("hidden"),$.remove_storage("pgrdg_cache.summary"),$.remove_storage("pgrdg_cache.results"),$.remove_storage("pgrdg_cache.map"),$.show_summary($.get_storage_selected_forms())})}),a.call(this,e)):apprise(i18n[lang].messages.text_has_produced_zero_results,{title:i18n[lang].messages.no_results,icon:"warning"},function(e){e&&$("#main_search").focus()}))})},$.fn.addTraitAutocomplete=function(e,a,t){$.selected_menu=function(e,a){var t=e.replace("$","");$("#main_search_operator").attr("class","").addClass(t).text(a),$("#autocomplete ul.dropdown-menu li").removeClass("active"),$("#autocomplete ul.dropdown-menu li."+t).addClass("active"),$("#main_search").focus()},e=$.extend({id:"","class":"",placeholder:i18n[lang].interface.btns.choose+"...",operator:kAPI_OP_MATCH_TAG_LABELS},e);var s="",r="",n=!1,_="",l="",o=[];$.each(e.op,function(e,a){a.main?void 0!==a.main&&"string"==a.type&&(a.selected?(a.main&&(_=a.key,l=a.label),s+='<li class="'+a.key.replace("$","")+' active"><a href="javascript:void(0);" onclick="$.selected_menu(\''+a.key+"','"+a.label+"')\">"+a.label+"</a></li>"):s+='<li class="'+a.key.replace("$","")+'"><a href="javascript:void(0);" onclick="$.selected_menu(\''+a.key+"','"+a.label+"')\">"+a.label+"</a></li>"):void 0!==a.label&&(r+='<div class="checkbox"><label title="'+(void 0!==a.title?a.title:"")+'"><input type="checkbox" id="main_search_operator_'+a.key.replace("$","")+'" '+(a.selected?'checked="checked"':"")+' title="'+(void 0!==a.title?a.title:"")+'" value="" /> '+a.label+"</label></div>")}),$(this).prepend('<div id="autocomplete"><div class="input-group"><div class="input-group-btn"><button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown"><span id="main_search_operator" class="'+_.replace("$","")+'">'+l+'</span> <span class="caret"></span></button><ul class="dropdown-menu">'+s+'</ul></div><div id="scrollable-dropdown-menu"><input type="search" id="main_search" class="form-control typeahead'+(e.class?" "+e.class:"")+'" placeholder="'+e.placeholder+'" /></div></div>'+r+"</div>"),remoteAutocomplete=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.obj.whitespace("value"),queryTokenizer:Bloodhound.tokenizers.whitespace,remote:{url:config.service.proxy+"%QUERY",replace:function(a){var t={},s="";$.each($("#accordion div.panel.panel-success:not(.disabled)"),function(){var e=$(this).find("div.panel-body > form input[name='tags']").val();void 0!==e&&o.push(e)}),t[kAPI_PAGING_LIMIT]=50,t[kAPI_PARAM_REF_COUNT]=kAPI_PARAM_COLLECTION_UNIT,t[kAPI_PARAM_PATTERN]=$("#main_search").val(),t[kAPI_PARAM_EXCLUDED_TAGS]=$.array_unique(o),t[kAPI_PARAM_OPERATOR]=["$"+$("#main_search_operator").attr("class")],$("#main_search_operator_i").is(":checked")&&t[kAPI_PARAM_OPERATOR].push("$i"),s=config.service.url+"Service.php?",s+=kAPI_REQUEST_OPERATION+"="+e.operator,s+="&"+kAPI_REQUEST_LANGUAGE+"="+lang,s+="&"+kAPI_REQUEST_PARAMETERS+"="+$.rawurlencode(JSON.stringify(t));var r="true&query="+$.utf8_to_b64(s);return a.replace("%QUERY",r)},filter:function(e){var a=[];return $.each(e,function(t,s){if("ok"==(void 0===e[kAPI_RESPONSE_STATUS][kAPI_STATUS_MESSAGE]||null===e[kAPI_RESPONSE_STATUS][kAPI_STATUS_MESSAGE]?e[kAPI_RESPONSE_STATUS][kAPI_STATUS_STATE]:e[kAPI_RESPONSE_STATUS][kAPI_STATUS_MESSAGE])&&e[kAPI_RESPONSE_PAGING][kAPI_PAGING_AFFECTED]>0&&"results"==t)for(i=0;i<e[kAPI_RESPONSE_PAGING][kAPI_PAGING_AFFECTED];i++){var r=[];r.value=s[i],a.push(r)}}),a}}}),remoteAutocomplete.clearPrefetchCache(),remoteAutocomplete.initialize(),$("#main_search").typeahead({hint:!0,highlight:!0,minLength:3,limit:50},{displayKey:"value",source:remoteAutocomplete.ttAdapter()}).bind("keydown","return",function(){return $(this).trigger("typeahead:_changed"),!1}).on("typeahead:selected",function(){storage.set("pgrdg_cache.search.criteria.traitAutocomplete",{text:$("#main_search").val(),type:"autocomplete"}),$.breadcrumb_right_buttons(),n=$.exec_autocomplete("autocomplete")}).on("typeahead:_changed",function(){n||(storage.set("pgrdg_cache.search.criteria.traitAutocomplete",{text:$("#main_search").val(),type:"input"}),$.breadcrumb_right_buttons(),$.exec_autocomplete("input"))}).bind("keydown","alt+left",function(){return!1}).bind("keydown","alt+right",function(){return!1}),"function"==jQuery.type(t)&&t.call(this)},$.fn.addAutocomplete=function(e,a,t){e=$.extend({id:"","class":"",placeholder:"Choose...",op:kAPI_OP_MATCH_TAG_LABELS},e);var s="",r="",n="",_="";$.selected_menu=function(a,t){var s=a.replace("$","");$("#"+e.id+"_operator").attr("class","").addClass(s).text(t),$("#autocomplete ul.dropdown-menu li").removeClass("active"),$("#autocomplete ul.dropdown-menu li."+s).addClass("active"),$("#"+e.id).focus()},$.each(e.op,function(a,t){t.main?void 0!==t.main&&"string"==t.type&&(t.selected?(t.main&&(n=t.key,_=t.label),s+='<li class="'+t.key.replace("$","")+' active"><a href="javascript:void(0);" onclick="$.selected_menu(\''+t.key+"','"+t.label+"')\">"+t.label+"</a></li>"):s+='<li class="'+t.key.replace("$","")+'"><a href="javascript:void(0);" onclick="$.selected_menu(\''+t.key+"','"+t.label+"')\">"+t.label+"</a></li>"):void 0!==t.label&&(r+='<div class="checkbox"><label title="'+(void 0!==t.title?t.title:"")+'"><input type="checkbox" id="'+e.id+"_operator_"+t.key.replace("$","")+'" '+(t.selected?'checked="checked"':"")+' title="'+(void 0!==t.title?t.title:"")+'" value="" /> '+t.label+"</label></div>")}),$(this).prepend('<div id="'+e.id+'"><div class="input-group"><div class="input-group-btn"><button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown"><span id="'+e.id+'_operator" class="'+n.replace("$","")+'">'+_+'</span> <span class="caret"></span></button><ul class="dropdown-menu">'+s+'</ul></div><div id="scrollable-dropdown-menu"><input type="search" id="'+e.id+'_input" class="form-control typeahead'+(e.class?" "+e.class:"")+'" placeholder="'+e.placeholder+'" /></div></div>'+r+"</div>"),remoteAutocomplete=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.obj.whitespace("value"),queryTokenizer:Bloodhound.tokenizers.whitespace,remote:{url:config.service.proxy+"%QUERY",replace:function(a){var t=[],s={},r="";$.storage_exists("pgrdg_cache.search.criteria.grouping._ordering")&&(st=storage.get("pgrdg_cache.search.criteria.grouping._ordering"),$.each(st,function(e,a){t.push(a.tag)}),t=$.array_unique(t)),s[kAPI_PARAM_LOG_REQUEST]=!0,s[kAPI_PAGING_LIMIT]=50,s[kAPI_PARAM_REF_COUNT]=kAPI_PARAM_COLLECTION_UNIT,s[kAPI_PARAM_PATTERN]=$("#"+e.id+"_input").val(),s[kAPI_PARAM_EXCLUDED_TAGS]=$.array_unique(t),s[kAPI_PARAM_OPERATOR]=["$"+$("#"+e.id+"_operator").attr("class")],$("#"+e.id+"_operator_i").is(":checked")&&s[kAPI_PARAM_OPERATOR].push("$i"),r=config.service.url+"Service.php?",r+=kAPI_REQUEST_OPERATION+"="+e.operator,r+="&"+kAPI_REQUEST_LANGUAGE+"="+lang,r+="&"+kAPI_REQUEST_PARAMETERS+"="+$.rawurlencode(JSON.stringify(s));var i="true&query="+$.utf8_to_b64(r);return a.replace("%QUERY",i)},filter:function(e){var a=[];return $.each(e,function(t,s){if("ok"==(void 0===e[kAPI_RESPONSE_STATUS][kAPI_STATUS_MESSAGE]||null===e[kAPI_RESPONSE_STATUS][kAPI_STATUS_MESSAGE]?e[kAPI_RESPONSE_STATUS][kAPI_STATUS_STATE]:e[kAPI_RESPONSE_STATUS][kAPI_STATUS_MESSAGE])&&e[kAPI_RESPONSE_PAGING][kAPI_PAGING_AFFECTED]>0&&"results"==t)for(i=0;i<e[kAPI_RESPONSE_PAGING][kAPI_PAGING_AFFECTED];i++){var r=[];r.value=s[i],a.push(r)}}),a}}}),remoteAutocomplete.clearPrefetchCache(),remoteAutocomplete.initialize(),$("#"+e.id+" .typeahead").typeahead({hint:!0,highlight:!0,minLength:3,limit:50},{displayKey:"value",source:remoteAutocomplete.ttAdapter()}).on("typeahead:selected typeahead:_changed",function(){if($("#"+e.id+"_input").val().length>3){var a=[];$.storage_exists("pgrdg_cache.search.criteria.grouping._ordering")&&(st=storage.get("pgrdg_cache.search.criteria.grouping._ordering"),$.each(st,function(e,t){a.push(t.tag)}),a=$.array_unique(a)),0===$("#filter_search_summary .input-group #autocomplete_undo_btn").length&&$("#filter_search_summary .input-group").append('<span class="input-group-btn"><a class="btn btn-default-grey" id="autocomplete_undo_btn" href="javascript:void(0);"><span class="fa fa-reply"></span>'+i18n[lang].interface.btns.undo+"</a></span>"),$("#autocomplete_undo_btn").on("click",function(){apprise(i18n[lang].messages.search.are_you_sure_to_remove.this.message,{title:i18n[lang].messages.search.are_you_sure_to_remove.this.title,icon:"warning",confirm:!0},function(e){e&&($("#summary #summary-body").removeClass("disabled"),$("#filter_stage").html(""),$("#autocomplete_undo_btn").closest("span").remove(),$("#filter_stage_panel").fadeOut(300,function(){$("#filter_search_summary").val("").focus()}))})}),"function"==jQuery.type(t)&&t.call(this);var s={};s.storage_group="pgrdg_cache.search.criteria.grouping.loaded",s[kAPI_REQUEST_OPERATION]=kAPI_OP_MATCH_SUMMARY_TAG_BY_LABEL,s.parameters={},s.parameters[kAPI_REQUEST_LANGUAGE]=lang,s.parameters[kAPI_REQUEST_PARAMETERS]={},s.parameters[kAPI_REQUEST_PARAMETERS][kAPI_PARAM_LOG_REQUEST]=!0,s.parameters[kAPI_REQUEST_PARAMETERS][kAPI_PAGING_LIMIT]=50,s.parameters[kAPI_REQUEST_PARAMETERS][kAPI_PARAM_EXCLUDED_TAGS]=a,s.parameters[kAPI_REQUEST_PARAMETERS][kAPI_PARAM_REF_COUNT]=kAPI_PARAM_COLLECTION_UNIT,s.parameters[kAPI_REQUEST_PARAMETERS][kAPI_PARAM_PATTERN]=$("#"+e.id+"_input").val(),s.parameters[kAPI_REQUEST_PARAMETERS][kAPI_PARAM_OPERATOR]=["$EQ"],$.ask_to_service(s,function(e){if($.obj_len(e[kAPI_RESPONSE_RESULTS])>0){var a={},t=[],s="",r="";$("#summary_ordering").find(".modal-body").html('<ul class="fa-ul">'),$.each(e[kAPI_RESPONSE_RESULTS],function(i,n){void 0!==n[kAPI_PARAM_TAG]&&(a[i]=n[kAPI_PARAM_TAG],t.push(n[kAPI_PARAM_TAG]),void 0!==n[kAPI_PARAM_RESPONSE_CHILDREN][kAPI_PARAM_RESPONSE_CHILDREN]&&(r=n[kAPI_PARAM_RESPONSE_CHILDREN][kAPI_PARAM_RESPONSE_CHILDREN][kAPI_PARAM_RESPONSE_FRMT_NAME]),s+=$.iterate_childrens(n[kAPI_PARAM_RESPONSE_CHILDREN],0,e.id,i,n[kAPI_PARAM_TAG],r))}),$("#summary_ordering").find(".modal-body ul").html(s),$("#summary_ordering").modal("show"),$("#summary_ordering .modal-body .fa-ul a").hover(function(){$(this).next().find("a.unclickable").addClass("active")},function(){$(this).next().find("a.unclickable").removeClass("active")})}}),$.breadcrumb_right_buttons(),is_autocompleted=!0}return!1}),"function"==typeof t&&t.call(this)},$.remove_search=function(e){var a=e,t=a.closest(".panel").attr("id");apprise(i18n[lang].messages.search.are_you_sure_to_remove.this.message,{title:i18n[lang].messages.search.are_you_sure_to_remove.this.title,icon:"warning",confirm:!0},function(e){e&&(a.closest(".panel").hasClass("fulltext_search")&&(storage.set("pgrdg_cache.search.criteria.fulltext",""),$.breadcrumb_right_buttons()),a.closest(".panel").hasClass("select_map_area_search")&&($.remove_storage("pgrdg_cache.search.criteria.select_map_area",""),$.breadcrumb_right_buttons()),$.each(a.closest(".panel").find("div.panel-mask"),function(){var e=$(this).attr("id");$("#static_forms_list").length>0&&$("#"+e+"_link").hasClass("disabled")&&$("#"+e+"_link").removeClass("text-warning disabled")}),$(a).parents(".panel").fadeOut(300,function(){if($(this).remove(),$("#main_search").focus(),0===$("#accordion .panel").length)$.reset_all_searches(!1);else{var e=0;$.each($("#accordion .panel").find("div.panel-success:not(.disabled)"),function(){e++}),$("#accordion .panel.fulltext_search").length>0&&e++;var a=$("#accordion > .panel:last-child").attr("id");$("#"+a+"_collapse").collapse("show"),0===e&&$(".save_btn").addClass("disabled")}$.remove_storage("pgrdg_cache.search.criteria.traitAutocomplete"),$.remove_storage("pgrdg_cache.search.criteria.forms."+t),$.remove_storage("pgrdg_cache.search.criteria.selected_forms."+t),$.remove_storage("pgrdg_cache.search.criteria.selected_enums"),$.remove_storage("pgrdg_cache.search.criteria.local.forms_data."+t)}))})},$.reset_all_searches=function(e){void 0===e&&(e=!0);$.reset=function(){$("#forms-head #right_btn, #forms-head .save_btn, #forms-footer #right_btn, #forms-footer .save_btn").fadeOut(300,function(){$("#forms-head .content-title, #forms-footer .content-title").text(""),$("#forms-body .content-body").html(""),$("section.container").animate({"padding-top":"0px"},300,function(){$.reset_breadcrumb(),$.reset_contents("forms",!0),$.reset_contents("summary",!0),$.reset_contents("results",!0),$.reset_contents("map",!0)}),$("#contents #start").fadeIn(600),$("input.typeahead.tt-input").val("").focus(),$("#advanced_search_home").fadeIn(300),$.each($("#static_forms_list li"),function(){$(this).find("a.text-warning.disabled").removeClass("text-warning disabled")}),$.left_panel("open")})},e?$("#apprise.reset-all").length>0?$("#apprise.reset-all").modal("show"):apprise(i18n[lang].messages.search.are_you_sure_to_remove.all.message,{title:i18n[lang].messages.search.are_you_sure_to_remove.all.title,icon:"warning","class":"reset-all",confirm:!0},function(e){e&&$.reset()}):$("#forms-head #right_btn, #forms-head .save_btn, #forms-footer #right_btn, #forms-footer .save_btn").fadeOut(300,function(){$.reset()})},$.search_fulltext=function(e){if(e.length>=3){var a={};a.storage_group="pgrdg_cache.summary",a[kAPI_REQUEST_OPERATION]=kAPI_OP_MATCH_UNITS,a.parameters={},a.parameters[kAPI_REQUEST_LANGUAGE]=lang,a.parameters[kAPI_REQUEST_PARAMETERS]={},a.parameters[kAPI_REQUEST_PARAMETERS][kAPI_PARAM_LOG_REQUEST]=!0,a.parameters[kAPI_REQUEST_PARAMETERS][kAPI_PARAM_CRITERIA]={},a.parameters[kAPI_REQUEST_PARAMETERS][kAPI_PARAM_CRITERIA][kAPI_PARAM_FULL_TEXT_OFFSET]={},a.parameters[kAPI_REQUEST_PARAMETERS][kAPI_PARAM_CRITERIA][kAPI_PARAM_FULL_TEXT_OFFSET][kAPI_PARAM_INPUT_TYPE]=kAPI_PARAM_INPUT_TEXT,a.parameters[kAPI_REQUEST_PARAMETERS][kAPI_PARAM_CRITERIA][kAPI_PARAM_FULL_TEXT_OFFSET][kAPI_PARAM_PATTERN]=e,a.parameters[kAPI_REQUEST_PARAMETERS][kAPI_PARAM_GROUP]=[],a.parameters[kAPI_REQUEST_PARAMETERS][kAPI_PARAM_SHAPE_OFFSET]=kTAG_GEO_SHAPE_DISP,$.ask_to_service(a,function(e){if("ok"==e[kAPI_RESPONSE_STATUS][kAPI_STATUS_STATE]&&$.obj_len(e[kAPI_RESPONSE_RESULTS])>0){{e[kAPI_RESPONSE_RESULTS]}$.activate_panel("summary",{res:e},function(){$("#se_loader").fadeOut(300),$("#se_p").fadeIn(300),$("#group_by_btn").removeClass("disabled")})}else $("#se_loader").addClass("text-warning").html('<span class="fa fa-times"></span> '+i18n[lang].messages.search.no_search_results.message),$("#search_form").focus()})}},$.reset_breadcrumb=function(){$("#breadcrumb").fadeOut(300,function(){$.each($(this).find("ol li"),function(){$(this).addClass("hidden")})})},$.remove_breadcrumb=function(e){$("#goto_"+e.toLowerCase()+"_btn").hasClass("hidden")||$("#goto_"+e.toLowerCase()+"_btn").addClass("hidden")},$.reset_contents=function(e,a){(void 0===a||null===a)&&(sorage_also=!1),$("#contents #"+e).fadeOut(300,function(){"map"==e?$.reset_map():("forms"==e?($(this).find("#"+e+"-head").html('<h1 class="pull-left content-title"></h1><div class="btn-group pull-right"><a id="right_btn" class="btn btn-default-grey" style="display: none;" href="javascript: void(0);"></a></div><div class="clearfix"></div>'),$(this).find("#"+e+"-footer").html('<div class="btn-group pull-right"><a id="right_btn" class="btn btn-default-grey" style="display: none;" href="javascript: void(0);"></a></div>')):"summary"!==e?$(this).find("#"+e+"-head").html('<h1 class="content-title"></h1>'):($(this).find("#"+e+"-head").children(":not(#group_by_accordion)").remove(),$(this).find("#"+e+"-head").prepend('<h1 class="pull-left content-title"></h1><div class="btn-group pull-right"><a data-toggle="collapse" id="group_by_btn" onclick="$.manage_url(\'Summary\');" data-parent="#group_by_accordion" href="#collapsed_group_form" class="btn btn-default-grey"><span class="fa fa-sliders text-muted"></span>'+i18n[lang].interface.btns.group_by+'</a><a href="javascript:window.print()" title="'+i18n[lang].interface.btns.print_results+'" class="btn btn-default-white"><span class="fa fa-print"></span></a></div><div class="clearfix"></div>')),$(this).find("#"+e+"-body").html('<div class="content-body"></div>'))
}),a&&($.remove_storage("pgrdg_cache."+e),"forms"==e&&($.remove_storage("pgrdg_cache.search.criteria.forms"),$.remove_storage("pgrdg_cache.search.criteria.selected_forms"),$.remove_storage("pgrdg_cache.search.criteria.selected_enums"),$.remove_storage("pgrdg_cache.search.criteria.fulltext"),$.remove_storage("pgrdg_cache.search.criteria.traitAutocomplete"),$.remove_storage("pgrdg_cache.search.criteria.grouping"),$.remove_storage("pgrdg_cache.map_data.user_layers")))},$.activate_panel=function(e,a,t){if(a=$.extend({source:"",res:"",id:"",label:""},a),$.manage_url({hash:$.ucfirst(e),source:a.source}),"map"!==e){if("summary"==e?"Search"==current_path||"Map"==current_path?$("#"+e+"-head h1.content-title > span").html("Results "+e.toLowerCase()):$("#"+e+"-head h1.content-title").html("Results "+e.toLowerCase()):($("#"+e+"-head h1.content-title").html(i18n[lang].interface.btns.search+" "+e.toLowerCase()),"results"==e&&$('<p class="lead text-muted">').text(i18n[lang].messages.for_detailed_info_click).insertAfter($("#"+e+"-head h1.content-title"))),$("#"+e+"-body .content-body").html(""),"results"!==e)$.generate_summaries(a.res,"",function(t){$("#"+e+"-body .content-body").attr("id",a.res[kAPI_PARAM_ID]).append(t)});else{var s=a.res[kAPI_RESULTS_DICTIONARY][kAPI_DICTIONARY_LIST_COLS],r=a.res[kAPI_RESPONSE_RESULTS];$("#"+e+"-body .content-body").append('<table id="'+a.res[kAPI_PARAM_ID]+'" class="table table-striped table-hover table-responsive"></table>'),$.cycle_disp=function(e){return"object"==$.type(e)?e[kAPI_PARAM_RESPONSE_FRMT_DISP]+" "+(void 0!==e[kAPI_PARAM_RESPONSE_FRMT_INFO]?'<a href="javascript:void(0);" class="text-info pull-right" data-toggle="popover" data-content="'+$.html_encode(e[kAPI_PARAM_RESPONSE_FRMT_INFO])+'"><span class="fa fa-question-circle"></span></a>':""):"array"==$.type(e)?e.join(", "):e},$.expand_row=function(e,a){var t=$("#"+$.md5(a)).prev("tr").find("td:first-child a > span");t.hasClass("fa-rotate-90")?($("#"+$.md5(a)).slideUp(600),t.removeClass("fa-rotate-90")):(console.warn($("#"+$.md5(a))),$("#"+$.md5(a)+" td").html('<center class="text-muted"><span class="fa fa-refresh fa-spin"></span> '+i18n[lang].messages.waiting+"</center>"),$.show_raw_row_content(e,a),$("#"+$.md5(a)).slideDown(600),t.addClass("fa-rotate-90"))};var i=$.obj_len(s),n="",_="",l=a.res[kAPI_RESPONSE_PAGING][kAPI_PAGING_ACTUAL],o=a.res[kAPI_RESPONSE_PAGING][kAPI_PAGING_AFFECTED],c=null===a.res[kAPI_RESPONSE_PAGING][kAPI_PAGING_LIMIT]?0:a.res[kAPI_RESPONSE_PAGING][kAPI_PAGING_LIMIT],d=null===a.res[kAPI_RESPONSE_PAGING][kAPI_PAGING_SKIP]?0:a.res[kAPI_RESPONSE_PAGING][kAPI_PAGING_SKIP];$.each(s,function(e,a){n+="<td><b>"+a[kAPI_PARAM_RESPONSE_FRMT_NAME]+"</b> "+(void 0!==a[kAPI_PARAM_RESPONSE_FRMT_INFO]?'<a href="javascript:void(0);" class="text-info" data-toggle="popover" data-content="'+$.html_encode(a[kAPI_PARAM_RESPONSE_FRMT_INFO])+'"><span class="fa fa-question-circle"></span></a>':"")+"</td>",_+='<td class="col_'+$.md5(e)+'"></td>'}),$("table#"+a.res.id).html("<thead><tr><td></td>"+n+"</tr></thead><tbody></tbody>"),$.each(r,function(e,t){$("table#"+a.res.id+" tbody").append('<tr id="tr_'+$.md5(e)+'" class="expandable" onclick="$.expand_row(\''+a.res.id+"', '"+e+'\');"><td align="center"><a href="javascript:void(0);" class="text-muted"><span class="fa fa-chevron-right"></span></a></td>'+_+"</tr>"),$("table#"+a.res.id+" tbody").append('<tr id="'+$.md5(e)+'" class="detail"><td colspan="'+(i+1)+'"><div><ul class="list-group transparent"></ul></div></td></tr>'),$.each(t,function(a,t){$("tr#tr_"+$.md5(e)+" td.col_"+$.md5(a)).html($.cycle_disp(t[kAPI_PARAM_RESPONSE_FRMT_DISP]))})}),$("table#"+a.res.id+" thead").prepend('<tr><td colspan="'+(i+1)+'">'+$.paging_btns(a,l,o,c,d)+"<br /></td></tr>"),$("table#"+a.res.id).append('<tfoot><tr><td colspan="'+(i+1)+'"><br />'+$.paging_btns(a,l,o,c,d)+"</td></tr></tfoot>"),$("table#"+a.res.id+" td a:not(.btn-default-white)").popover({container:"body",placement:function(e,a){return $(a).parent().is("td:last-child")?"left":"top"},html:"true",trigger:"hover"}),$("table#"+a.res.id+" td a.btn-default-white").tooltip(),$("table#"+a.res.id+" form a")}$("#contents #"+e).fadeIn(300)}else 0===$("#pgrdg_map").children().length?map=$.init_map(function(e){$.remove_storage("pgrdg_cache.map"),$.reset_all_markers(e,markers),$.add_geojson_cluster({id:a.id,geojson:a.res})}):($.reset_all_markers(map,markers),$.add_geojson_cluster({id:a.id,geojson:a.res})),$("#pgrdg_map").fadeIn(600);"function"==jQuery.type(t)&&t.call(this)},$.load_statistics_menu=function(e,a,t){var s=$("<div>").addClass("modal fade"),r=$("<div>").addClass("modal-dialog"),i=$("<div>").addClass("modal-content"),n=$("<div>").addClass("modal-header"),_=$("<button>").addClass("close").attr("data-dismiss","modal").html('<span aria-hidden="true">&times;</span><span class="sr-only">'+i18n[lang].interface.btns.close+"</span>");$modal_header_title=$("<h4>").addClass("modal-title").html(i18n[lang].messages.statistics.statistics_list),$modal_body=$("<div>").addClass("modal-body"),$ul=$("<ul>").addClass("fa-ul"),objp={},objp.storage_group="pgrdg_cache.summary",objp[kAPI_REQUEST_OPERATION]=kAPI_OP_LIST_STATS,objp.parameters={},objp.parameters[kAPI_REQUEST_LANGUAGE]=lang,objp.parameters[kAPI_REQUEST_PARAMETERS]={},objp.parameters[kAPI_REQUEST_PARAMETERS][kAPI_PARAM_DOMAIN]=a,$.ask_to_service(objp,function(s){"ok"==s[kAPI_RESPONSE_STATUS][kAPI_STATUS_STATE]&&$.obj_len(s[kAPI_RESPONSE_RESULTS])>0&&$.each(s[kAPI_RESPONSE_RESULTS],function(s,r){var i=$("<a>").attr({href:"javascript:void(0);",onclick:"$.show_statistics('"+r[kAPI_PARAM_STAT]+"', '"+e+"', '"+a+"', '"+t+"')"}).html(r[kAPI_PARAM_RESPONSE_FRMT_NAME]).popover({placement:"auto",content:r[kAPI_PARAM_RESPONSE_FRMT_INFO],container:"body",trigger:"hover"}),n=$("<li>").html('<i class="fa-li fa fa-angle-right"></i>').append(i);$ul.append(n)})}),$modal_body.append($ul),n.append(_).append($modal_header_title),i.append(n).append($modal_body),r.append(i),s.append(r),$("body").prepend(s),s.modal("show")},$.show_statistics=function(e,a,t,s){var r=storage.get("pgrdg_cache.summary."+a),i={},n="",_={};void 0===s||null===s||""===s?(n=$.md5(t),s={}):$.each($.parseJSON($.rawurldecode(s)),function(e,a){n=$.md5(a[kAPI_PARAM_RESPONSE_FRMT_NAME]+t),name=a[kAPI_PARAM_RESPONSE_FRMT_NAME],void 0!==a.is_patch&&a.is_patch===!0?i={}:(i[e]={},$.each(a,function(a,t){a!==kAPI_PARAM_RESPONSE_FRMT_NAME&&a!==kAPI_PARAM_RESPONSE_FRMT_INFO&&(i[e][a]=t)}))}),_.storage_group="pgrdg_cache.summary",_[kAPI_REQUEST_OPERATION]=kAPI_OP_MATCH_UNITS,_.parameters={},_.parameters[kAPI_REQUEST_LANGUAGE]=lang,_.parameters[kAPI_REQUEST_PARAMETERS]={},_.parameters[kAPI_REQUEST_PARAMETERS][kAPI_PAGING_LIMIT]=50,_.parameters[kAPI_REQUEST_PARAMETERS][kAPI_PAGING_SKIP]=0,_.parameters[kAPI_REQUEST_PARAMETERS][kAPI_PARAM_LOG_REQUEST]=!0,_.parameters[kAPI_REQUEST_PARAMETERS][kAPI_PARAM_CRITERIA]=r.query.obj[kAPI_REQUEST_PARAMETERS][kAPI_PARAM_CRITERIA],_.parameters[kAPI_REQUEST_PARAMETERS][kAPI_PARAM_DOMAIN]=t,_.parameters[kAPI_REQUEST_PARAMETERS][kAPI_PARAM_STAT]=e,_.parameters[kAPI_REQUEST_PARAMETERS][kAPI_PARAM_DATA]=kAPI_RESULT_ENUM_DATA_STAT,_.parameters[kAPI_REQUEST_PARAMETERS][kAPI_PARAM_SUMMARY]=i,$.ask_to_service(_,function(a){var s=a[kAPI_RESPONSE_RESULTS];($.obj_len(s)>0||s.length>0)&&($(".modal").modal("hide"),$.activate_panel("stats",{title:$("#"+e+" .panel-heading span.title").text(),domain:t,res:a},function(){{var e=$("<table>").addClass("table table-striped table-hover table-responsive"),a=$("<thead>"),t=$("<tr>"),r=$("<tbody>");$("<tfooter>"),$("<tr>")}$.each(s[kAPI_PARAM_RESPONSE_FRMT_HEAD],function(e,a){var r=$("<th>").attr({"data-sort":$.detect_type(s[kAPI_PARAM_RESPONSE_FRMT_DOCU][0][e]),title:i18n[lang].interface.btns.sort_asc}),i=$("<a>").addClass("btn btn-text text-muted pull-right descending").attr({href:"javascript: void(0);"});(a[kAPI_PARAM_DATA_TYPE]==kTYPE_FLOAT||a[kAPI_PARAM_DATA_TYPE]==kTYPE_INT)&&r.addClass("text-right"),i.html('<span class="fa fa-fw fa-sort"></span>'),r.html('<span class="pull-left">'+a[kAPI_PARAM_RESPONSE_FRMT_NAME]+"</span>"),t.append(r)}),$.each(s[kAPI_PARAM_RESPONSE_FRMT_DOCU],function(e,a){var t=$("<tr>");$.each(a,function(e,a){var r=$("<td>");(s[kAPI_PARAM_RESPONSE_FRMT_HEAD][e][kAPI_PARAM_DATA_TYPE]==kTYPE_FLOAT||s[kAPI_PARAM_RESPONSE_FRMT_HEAD][e][kAPI_PARAM_DATA_TYPE]==kTYPE_INT)&&r.addClass("text-right"),void 0!==a&&null!==a?r.html($.highlight(a)):r.text(""),t.append(r)}),r.append(t)}),a.append(t),e.append(a),e.append(r),$("#stats #stats-head .content-title").text(s[kAPI_PARAM_RESPONSE_FRMT_NAME]),$("#stats #stats-body .content-body").html(e),e.stupidtable({date:function(e,a){return aDate=date_from_string(e),bDate=date_from_string(a),aDate-bDate}}).on("aftertablesort",function(e,a){var t=$(this).find("th");t.find(".arrow").remove();var s=$.fn.stupidtable.dir,r=a.direction===s.ASC?'<span class="fa fa-fw fa-sort-asc"></span>':'<span class="fa fa-fw fa-sort-desc"></span>';t.eq(a.column).append('<span class="arrow pull-right">'+r+"</span>")})}))})},$.show_summary=function(e,a,t){(void 0===a||null===a||""===a)&&(a=!0);var s=[],r={};a&&"Map"!==current_path&&$.storage_exists("pgrdg_cache.search.criteria.grouping._ordering")&&$.each(storage.get("pgrdg_cache.search.criteria.grouping._ordering"),function(e,a){s.push(a.id)}),void 0!==query.groupby&&(s=query.groupby.replace(/(\[|\])/g,"").split(",")),r.storage_group="pgrdg_cache.summary",r[kAPI_REQUEST_OPERATION]=kAPI_OP_MATCH_UNITS,r.parameters={},r.parameters[kAPI_REQUEST_LANGUAGE]=lang,r.parameters[kAPI_REQUEST_PARAMETERS]={},r.parameters[kAPI_REQUEST_PARAMETERS][kAPI_PAGING_LIMIT]=300,r.parameters[kAPI_REQUEST_PARAMETERS][kAPI_PARAM_LOG_REQUEST]=!0,r.parameters[kAPI_REQUEST_PARAMETERS][kAPI_PARAM_CRITERIA]=e,$.storage_exists("pgrdg_cache.search.criteria.fulltext")&&(r.parameters[kAPI_REQUEST_PARAMETERS][kAPI_PARAM_CRITERIA][kAPI_PARAM_FULL_TEXT_OFFSET]={},r.parameters[kAPI_REQUEST_PARAMETERS][kAPI_PARAM_CRITERIA][kAPI_PARAM_FULL_TEXT_OFFSET][kAPI_PARAM_INPUT_TYPE]=kAPI_PARAM_INPUT_TEXT,r.parameters[kAPI_REQUEST_PARAMETERS][kAPI_PARAM_CRITERIA][kAPI_PARAM_FULL_TEXT_OFFSET][kAPI_PARAM_PATTERN]=storage.get("pgrdg_cache.search.criteria.fulltext")),$.storage_exists("pgrdg_cache.search.criteria.select_map_area")&&(r.parameters[kAPI_REQUEST_PARAMETERS][kAPI_PARAM_CRITERIA][kAPI_SHAPE_TAG]={},r.parameters[kAPI_REQUEST_PARAMETERS][kAPI_PARAM_CRITERIA][kAPI_SHAPE_TAG][kAPI_PARAM_INPUT_TYPE]=kAPI_PARAM_INPUT_SHAPE,r.parameters[kAPI_REQUEST_PARAMETERS][kAPI_PARAM_CRITERIA][kAPI_SHAPE_TAG][kAPI_PARAM_SHAPE]=storage.get("pgrdg_cache.search.criteria.select_map_area")),r.parameters[kAPI_REQUEST_PARAMETERS][kAPI_PARAM_GROUP]=s,r.parameters[kAPI_REQUEST_PARAMETERS][kAPI_PARAM_SHAPE_OFFSET]=kTAG_GEO_SHAPE_DISP,r.colour=!0,$.ask_to_service(r,function(a){$.obj_len(a[kAPI_RESPONSE_RESULTS])>0||a[kAPI_RESPONSE_RESULTS].length>0?$.activate_panel("summary",{res:a},function(){$.restore_stage(t)}):0===$("#apprise.no-results:visible").length&&($.storage_exists("pgrdg_cache.search.criteria.grouping._ordering")?apprise(i18n[lang].messages.grouping.zero_results_remove_filter,{"class":"no-results",title:i18n[lang].messages.search.no_search_results.message,icon:"warning",confirm:!0},function(){$.show_summary(e,!1,function(){setTimeout(function(){$("#summary-body.disabled").addClass("moved")},600)})}):apprise(i18n[lang].messages.search.no_search_results.message,{"class":"no-results",title:i18n[lang].messages.search.no_search_results.title,icon:"warning"}))})},$.generate_summaries=function(e,a,t){$.get_domain_colour=function(e){var a={r:255,g:0,b:0,a:1};return $.storage_exists("pgrdg_cache.search.domain_colours")||storage.set("pgrdg_cache.search.domain_colours."+e,$.set_colour({colour:a})),storage.get("pgrdg_cache.search.domain_colours."+e)};var s=e[kAPI_PARAM_ID],r="",i={};return r=void 0!==e.history?JSON.stringify(e.history):"",void 0!==e[kAPI_RESPONSE_REQUEST]&&void 0!==e[kAPI_RESPONSE_REQUEST][kAPI_PARAM_CRITERIA][kAPI_SHAPE_TAG]&&$.obj_len(e[kAPI_RESPONSE_REQUEST][kAPI_PARAM_CRITERIA][kAPI_SHAPE_TAG])>0&&(i=e[kAPI_RESPONSE_REQUEST][kAPI_PARAM_CRITERIA][kAPI_SHAPE_TAG]),$.each(e[kAPI_RESPONSE_RESULTS],function(e,a){if(""===r){var n=[],_={};_.is_patch=!0,_[a[kAPI_PARAM_OFFSETS]]=a[kAPI_PARAM_PATTERN],_[kAPI_PARAM_RESPONSE_FRMT_NAME]=a[kAPI_PARAM_RESPONSE_FRMT_NAME],void 0!==a[kAPI_PARAM_RESPONSE_FRMT_INFO]&&(_[kAPI_PARAM_RESPONSE_FRMT_INFO]=a[kAPI_PARAM_RESPONSE_FRMT_INFO]),n.push(_),r=JSON.stringify(n)}var l=$('<div class="result panel" style="border-color: '+$.get_domain_colour(e)+'">'),o=$('<h4 class="">'),c=$('<span class="title">'),d=$("<p>"),p=$('<div class="row">'),A=$('<span class="col-lg-3 col-xs-3">'),g=$('<span class="col-lg-9 col-xs-9 text-right">');c.html($.trim(a[kAPI_PARAM_RESPONSE_FRMT_NAME])+(void 0!==a[kAPI_PARAM_RESPONSE_COUNT]?' <sup class="text-danger">'+a[kAPI_PARAM_RESPONSE_COUNT]+"</sup>":"")).appendTo(o),o.appendTo(l),d.html(a[kAPI_PARAM_RESPONSE_FRMT_INFO]).appendTo(l),A.html('<span class="help-block"></span>').appendTo(p),a[kAPI_PARAM_RESPONSE_FRMT_STATS]>0&&(g.append('<a class="btn text-warning transparent" href="javascript:void(0);" onclick="$.load_statistics_menu(\''+s+"', '"+e+"', '"+$.rawurlencode(r)+'\');"><span class="fa fa-line-chart"></span>'+i18n[lang].interface.btns.view_statistics+"</a>"),g.append(' <span class="hidden-xs hidden-sm text-muted">|</span>')),g.append('<a class="btn text-info transparent" href="javascript: void(0);" onclick="$.show_raw_data(\''+s+"', '"+e+"', '"+$.rawurlencode(JSON.stringify(i))+"', '0', '50', '"+$.rawurlencode(r)+'\')"><span class="fa fa-list-alt"></span>'+i18n[lang].interface.btns.view_data+"</a>"),a[kAPI_PARAM_RESPONSE_POINTS]>0&&(g.append(' <span class="hidden-xs hidden-sm text-muted">|</span>'),g.append('<a class="btn '+(a.points>1e4?"text-warning":"")+' transparent" href="javascript: void(0);" onclick="$.show_data_on_map(\''+s+"', '"+e+"', '"+$.rawurlencode(JSON.stringify(i))+"', '"+$.rawurlencode(r)+'\')" title="'+a.points+' nodes for this entry"><span class="ionicons ion-map"></span>'+i18n[lang].interface.btns.view_map+' <sup class="text-muted">'+a.points+"</sup></a>")),g.appendTo(p),p.appendTo(l),"function"==jQuery.type(t)&&t.call(this,l),r=""}),!1},$.generate_tree_summaries=function(e,a,t){$.random_colour=function(){return"rgb("+Math.floor(256*Math.random())+","+Math.floor(156*Math.random())+","+Math.floor(156*Math.random())+")"},$.title_behaviour=function(e){var a=e;$("#"+a.attr("href").replace("#","")).hasClass("in")?(a.closest("h4").css({"border-bottom-left-radius":"0","border-bottom-width":"0"}),a.find("span").removeClass("fa-chevron-down").addClass("fa-chevron-right")):(a.closest("h4").css({"border-bottom-left-radius":"15px 10px","border-bottom-width":"1px"}),a.find("span").removeClass("fa-chevron-right").addClass("fa-chevron-down"))},$.each(e[kAPI_RESPONSE_RESULTS],function(s,r){var i={};i[r[kAPI_PARAM_OFFSETS]]=r[kAPI_PARAM_PATTERN],i[kAPI_PARAM_RESPONSE_FRMT_NAME]=r[kAPI_PARAM_RESPONSE_FRMT_NAME],void 0!==r[kAPI_PARAM_RESPONSE_FRMT_INFO]&&(i[kAPI_PARAM_RESPONSE_FRMT_INFO]=r[kAPI_PARAM_RESPONSE_FRMT_INFO]),e.history[e.level]=i;var n=void 0!==a&&""!==a?a:$.set_colour("random",.7),_=$.makeid(),l=$('<div class="result panel tree_summary">'),o=$('<h4 style="border-color: '+n+'">'),c=$('<a class="btn btn-unstyled" data-toggle="collapse" href="#'+_+'" class="title" style="margin-left: 5px;" onclick="$.title_behaviour($(this));">'),d=$('<small class="help-block">'),p=$('<div class="row collapse" id="'+_+'">'),A=$('<div class="children">'),g={},h=!1,P=0;$.obj_len(r[kAPI_PARAM_RESPONSE_CHILDREN])>0&&(g[kAPI_PARAM_ID]=e[kAPI_PARAM_ID],g[kAPI_RESPONSE_RESULTS]=r[kAPI_PARAM_RESPONSE_CHILDREN],$.each(g[kAPI_RESPONSE_RESULTS],function(e,a){void 0!==a[kAPI_PARAM_RESPONSE_CHILDREN]&&$.obj_len(a[kAPI_PARAM_RESPONSE_CHILDREN])>0?(h=!0,P=0):(h=!1,P+=a[kAPI_PARAM_RESPONSE_COUNT])}),g.level=e.level+1,g.domain_id=e.domain_id,g.history=e.history,h?$.generate_tree_summaries(g,n,function(a){A.append(a),e.history=[e.history[0]]}):$.generate_summaries(g,n,function(e){A.append(e)}),A.appendTo(p)),c.html(""+$.trim(r[kAPI_PARAM_RESPONSE_FRMT_NAME])+' <sup class="text-danger">'+(h?$.obj_len(r[kAPI_PARAM_RESPONSE_CHILDREN]):P)+"</sup>").appendTo(o),void 0!==r[kAPI_PARAM_RESPONSE_FRMT_INFO]&&d.html('<span style="margin-left: 5px;">'+r[kAPI_PARAM_RESPONSE_FRMT_INFO]+"</span>").appendTo(o),o.appendTo(l),p.appendTo(l),"function"==jQuery.type(t)&&t.call(this,l)})},$.iterate_childrens=function(e,a,t,s,r,i){if($("#summary #summary-body").addClass("disabled"),void 0!==s){$.fn.to_html=function(){return $("<div></div>").html($(this).clone()).html()};var n=$('<li class="level_'+a+'">'),_="",l="",o="",c=!1;void 0===a&&(a=0);var d=[];return $.storage_exists("pgrdg_cache.search.criteria.grouping._ordering")&&($.each(storage.get("pgrdg_cache.search.criteria.grouping._ordering"),function(e,a){s==a.id&&d.push(s)}),$.inArray(s,d)>-1&&(c=!0)),$.each(e,function(d,p){if(d!==kAPI_PARAM_TAG&&void 0!==p&&null!==p){if(d==kAPI_PARAM_RESPONSE_FRMT_NAME){if(0===a){var A=void 0!==e[kAPI_PARAM_RESPONSE_CHILDREN]?' <span class="text-muted">('+e[kAPI_PARAM_RESPONSE_CHILDREN][kAPI_PARAM_RESPONSE_FRMT_NAME]+")</span>":"",g=void 0!==e[kAPI_PARAM_RESPONSE_CHILDREN]?"related ":"";n.addClass(g),n.html('<a onclick="" href="javascript: void(0);" class="btn '+(c?"btn-default":"btn-default-white")+'"><h5 class="row"><span class="col-xs-10 col-sm-11 col-md-11 vcenter">'+p+A+'</span><span class="fa fa-fw fa-angle-right col-md-1 vcenter"></span></h5></a>')}l=p}d==kAPI_PARAM_RESPONSE_FRMT_INFO&&(n.find("h5 > span.col-md-11").append('<span class="help-block">'+p+"</span>"),o=p),n.find("a").attr("onclick","$(this).add_remove_item_to_stage('"+t+"', '"+s+"', '"+r+"', '"+l+"', '"+i+"', '"+o+"');")}_=n.to_html()}),_}},$.group_tag_by=function(e,a,t,s,r,i){var n=[];if($.storage_exists("pgrdg_cache.search.criteria.grouping."+e)&&(-1===$.inArray(a,storage.get("pgrdg_cache.search.criteria.grouping."+e))?n.push(a):_=!0),0===$("#filter_stage #"+$.md5(a)).length){var _=!1,l=$('<a href="javascript:void(0);" onclick="$.select_group_filter($(this));" ondblclick="$(this).addClass(\'active\'); $(\'#filter_stage a.active\').edit_filter();" class="list-group-item list-group-item-success" id="'+$.md5(a)+'" data-id="'+a+'" data-tag="'+t+'" data-storage-id="'+e+'">');l.html('<h4 class="list-group-item-heading">'+s+"</h4>"),void 0!==i&&null!==i&&i.length>0&&l.append('<p class="list-group-item-text">'+i+"</p>"),void 0!==r&&null!==r&&""!==r&&l.append('<h4 style="padding-left: 15px;" class="text-muted">'+r+"</h4>"),0===$("#filter_stage").html().length&&($("#filter_stage_panel").fadeIn(300),$("#filter_group_title").text(i18n[lang].messages.search.fulltext.add_another_group)),$("#filter_stage").append(l)}else $("#"+$.md5(a)+"_restore").length>0&&$.restore_deleted_filter($.md5(a));storage.set("pgrdg_cache.search.criteria.grouping."+e,n),$.breadcrumb_right_buttons()},$.restore_stage=function(e){$.storage_exists("pgrdg_cache.search.criteria.grouping._ordering")&&($("#summary #summary-body").hasClass("disabled")||$("#summary #summary-body").addClass("disabled"),$.each(storage.get("pgrdg_cache.search.criteria.grouping._ordering"),function(e,a){if($("#group_by_btn").append('<small class="label label-danger" style="position: absolute; top: -6px; right: -6px;">'+$.obj_len(storage.get("pgrdg_cache.search.criteria.grouping._ordering"))+"</small>"),$.obj_len(a)>0){var t=a.id,s=a.tag,r=a.storage;if($.storage_exists("pgrdg_cache.search.criteria.grouping."+r+".response."+kAPI_RESPONSE_RESULTS)){var i=storage.get("pgrdg_cache.search.criteria.grouping.loaded."+r+".response."+kAPI_RESPONSE_RESULTS),n=i[t][kAPI_PARAM_RESPONSE_CHILDREN][kAPI_PARAM_RESPONSE_FRMT_NAME],_=i[t][kAPI_PARAM_RESPONSE_CHILDREN][kAPI_PARAM_RESPONSE_FRMT_INFO],l=$('<a class="list-group-item list-group-item-success" href="javascript:void(0);" onclick="$.select_group_filter($(this));" ondblclick="$(this).addClass(\'active\'); $(\'#filter_stage a.active\').edit_filter();" id="'+$.md5(t)+'" data-id="'+t+'" data-tag="'+s+'" data-storage-id="'+r+'">');l.html('<h4 class="list-group-item-heading">'+n+"</h4>"),void 0!==_&&_.length>0&&l.append('<p class="list-group-item-text">'+_+"</p>"),void 0!==i[t][kAPI_PARAM_RESPONSE_CHILDREN][kAPI_PARAM_RESPONSE_CHILDREN]&&l.append('<h4 style="padding-left: 15px;" class="text-muted">'+i[t][kAPI_PARAM_RESPONSE_CHILDREN][kAPI_PARAM_RESPONSE_CHILDREN][kAPI_PARAM_RESPONSE_FRMT_NAME]+"</small>"),$("#filter_stage").append(l),$("#filter_stage_panel").fadeIn(300)}}$("#summary_order_cancel_btn, #summary_order_reorder_btn").removeClass("disabled")}),$.exec_ordering(e))},$.select_group_filter=function(e){$this=e,$this.hasClass("active")?($this.removeClass("active"),$("#filter_stage_controls a").addClass("disabled")):($("#filter_stage a").removeClass("active"),$this.addClass("active"),$("#filter_stage a:visible").length>0&&$("#filter_stage_controls a").removeClass("disabled"),$.show_btns())},$.show_btns=function(){0===$("#filter_stage > a.active").prev("a:visible").length&&($("#move_down_btn, #move_bottom_btn").removeClass("disabled"),$("#move_up_btn, #move_top_btn").addClass("disabled"),$("#summary_order_cancel_btn, #summary_order_reorder_btn").removeClass("disabled")),0===$("#filter_stage > a.active").next("a:visible").length&&($("#move_up_btn, #move_top_btn").removeClass("disabled"),$("#move_down_btn, #move_bottom_btn").addClass("disabled"),$("#summary_order_cancel_btn, #summary_order_reorder_btn").removeClass("disabled")),$("#filter_stage > a.active").prev("a:visible").length>0&&$("#filter_stage a.active").next("a:visible").length>0&&($("#move_top_btn, #move_up_btn, #move_down_btn, #move_bottom_btn").removeClass("disabled"),$("#summary_order_cancel_btn, #summary_order_reorder_btn").removeClass("disabled")),0===$("#filter_stage > a.active").prev("a:visible").length&&0===$("#filter_stage a.active").next("a:visible").length&&($("#move_top_btn, #move_up_btn, #move_down_btn, #move_bottom_btn").addClass("disabled"),$("#summary_order_cancel_btn, #summary_order_reorder_btn").removeClass("disabled"))},$.fn.move_to=function(e){var a=$("#filter_stage a.active"),t=$("#filter_stage a.active").prev(),s=$("#filter_stage a.active").next();switch(e){case"top":a.remove(),$("#filter_stage").prepend(a);break;case"bottom":a.remove(),$("#filter_stage").append(a);break;case"up":a.remove(),a.insertBefore(t);break;case"down":a.remove(),a.insertAfter(s)}$.update_ordering(),$.show_btns()},$.fn.add_remove_item_to_stage=function(e,a,t,s,r,i,n){var _=!1;void 0===n&&(n=!0),$(this).closest("ul:not(.level2) > li").find("a").hasClass("btn-default")?($(this).closest("ul:not(.level2) > li").find("a").removeClass("btn-default").addClass("btn-default-white"),$(this).next().find("a.unclickable").removeClass("btn-default").addClass("btn-default-white"),$("#filter_stage #"+$.md5(a)).remove_filter(!0),n&&($("#modal_messages").removeClass("alert-success").addClass("alert-danger").find("div.text-left").text(i18n[lang].messages.item_removed.replace("{X}",'"'+s+'"')),$("#modal_messages").show().delay(1500).fadeOut(300))):(_||($("#summary_ordering ul.fa-ul li a.btn-default").removeClass("btn-default").addClass("btn-default-white"),$.each($("#filter_stage a:visible"),function(){$(this).attr("data-storage-id")==e&&$(this).remove_filter(!0)})),$(this).closest("ul:not(.level2) > li").find("a").removeClass("btn-default-white").addClass("btn-default"),$(this).next().find("a.unclickable").removeClass("btn-default-white").addClass("btn-default"),$.group_tag_by(e,a,t,s,r,i),n&&($("#modal_messages").removeClass("alert-danger").addClass("alert-success").find("div.text-left").text(i18n[lang].messages.item_added.replace("{X}",'"'+s+'"')),$("#modal_messages").show().delay(1500).fadeOut(300))),_||$("#summary_ordering").modal("hide"),$.update_ordering()},$.fn.edit_filter=function(){var e=storage.get("pgrdg_cache.search.criteria.grouping.loaded."+$(this).attr("data-storage-id")+".response"),a={},t=[],s="",r="";$("#summary_ordering").find(".modal-body").html('<ul class="fa-ul">'),$.each(e[kAPI_RESPONSE_RESULTS],function(i,n){void 0!==n[kAPI_PARAM_TAG]&&(a[i]=n[kAPI_PARAM_TAG],t.push(n[kAPI_PARAM_TAG]),void 0!==n[kAPI_PARAM_RESPONSE_CHILDREN][kAPI_PARAM_RESPONSE_CHILDREN]&&(r=n[kAPI_PARAM_RESPONSE_CHILDREN][kAPI_PARAM_RESPONSE_CHILDREN][kAPI_PARAM_RESPONSE_FRMT_NAME]),s+=$.iterate_childrens(n[kAPI_PARAM_RESPONSE_CHILDREN],0,e.id,i,n[kAPI_PARAM_TAG],r))}),$("#summary_ordering").find(".modal-body ul").html(s),$("#summary_ordering").modal("show"),$("#summary_ordering .modal-body .fa-ul a").hover(function(){$(this).next().find("a.unclickable").addClass("active")},function(){$(this).next().find("a.unclickable").removeClass("active")})},$.restore_deleted_filter=function(e){var a=$("#"+e).attr("data-id"),t=$("#"+e).attr("data-storage-id"),s=storage.get("pgrdg_cache.search.criteria.grouping."+t);$("#"+e+"_restore").stop().remove(),$("#"+e).fadeIn(300,function(){$("#filter_stage_controls a").removeClass("disabled"),$.show_btns(),s.push(a),storage.set("pgrdg_cache.search.criteria.grouping."+t,s),$.breadcrumb_right_buttons()}),$.update_ordering()},$.fn.remove_filter=function(e){$.reset_stage=function(){$("#summary #summary-body").removeClass("disabled"),$("#filter_stage").html(""),$("#filter_stage_panel").fadeOut(300,function(){$("#filter_search_summary").val("").focus()})};var a=$(this).attr("data-id"),t=$(this).attr("data-storage-id"),s=storage.get("pgrdg_cache.search.criteria.grouping."+t);(void 0===e||null===e||""===e)&&(e=!1),$("#filter_stage_controls a").addClass("disabled"),$(this).fadeOut(300,function(){s=$.grep(s,function(e){return e!=a}),storage.set("pgrdg_cache.search.criteria.grouping."+t,s),$.update_ordering(),e?(0===$("#filter_stage > a:visible").length&&$.reset_stage(),$("#"+$.md5(a)).remove()):($('<div id="'+$.md5(a)+'_restore" class="well well-sm text-muted">'+i18n[lang].messages.removed_item.replace("{X}",'"'+$(this).find("h4").text()+'"')+'<a class="pull-right text-muted" href="javascript:void(0);" onclick="$.restore_deleted_filter(\''+$(this).attr("id")+'\')" title="Restore it"><small class="fa fa-reply"></small></a></div>').insertBefore($(this)),$("#"+$.md5(a)+"_restore").fadeOut(1e4,"easeInExpo",function(){$("#"+$.md5(a)+"_restore").remove(),$("#"+$.md5(a)).remove(),0===$("#filter_stage > a:visible").length&&($.reset_stage(),$.reset_ordering(!0))}))}),0===$("#filter_stage a").length&&$("#filter_stage_controls a").addClass("disabled")},$.reset_ordering=function(e){$.exec_reset_ordering=function(){$("#summary #summary-body").removeClass("disabled"),$("#filter_stage").html(""),$("#autocomplete_undo_btn").closest("span").remove(),$("#filter_stage_panel").fadeOut(300,function(){$("#autocomplete .typeahead").val("")}),$("#summary_order_cancel_btn").hasClass("disabled")||$("#summary_order_cancel_btn").addClass("disabled"),$("#summary_order_reorder_btn").hasClass("disabled")||$("#summary_order_reorder_btn").addClass("disabled"),$("#summary #summary-body").removeClass("disabled"),$("#collapsed_group_form").collapse("hide"),$("#group_by_btn .label-danger").remove(),"Search"==current_path?$.search_fulltext($("#search_form").val()):$.show_summary($.get_storage_selected_forms()),storage.set("pgrdg_cache.search.criteria.grouping",{})},(void 0===e||null===e||""===e)&&(e=!1),e?$.exec_reset_ordering():apprise(i18n[lang].messages.grouping.reset_filters.message,{title:i18n[lang].messages.grouping.reset_filters.title,icon:"warning",confirm:!0},function(e){e&&$.exec_reset_ordering()})},$.update_ordering=function(){var e=[];$.each($("#filter_stage > a:visible"),function(){var a=$(this).attr("data-id"),t=$(this).attr("data-tag"),s=$(this).find("h4:not(.text-muted)").text(),r=$(this).find("h4 + p").text(),i=$(this).find("h4.text-muted").text(),n=$(this).attr("data-storage-id");e.push({id:a,tag:t,name:s,info:r,contains:i,storage:n})}),storage.set("pgrdg_cache.search.criteria.grouping._ordering",e),$.update_ordering_on_the_stage(e),$.breadcrumb_right_buttons()},$.update_ordering_on_the_stage=function(e){(void 0===e||0===e.length)&&(e=storage.get("pgrdg_cache.search.criteria.grouping._ordering")),$("#summary #summary-body").hasClass("disabled")||$("#summary #summary-body").addClass("disabled"),e.length>0?(0===$("#group_by_btn .label-danger").length?$("#group_by_btn").append('<small class="label label-danger" style="position: absolute; top: -6px; right: -6px;">'+e.length+"</small>"):$("#group_by_btn .label-danger").text(e.length),$("#summary_order_cancel_btn, #summary_order_reorder_btn").removeClass("disabled"),$.each(e,function(e,a){if(0===$("#filter_stage #"+$.md5(a.id)).length){var t=$('<a href="javascript:void(0);" onclick="$.select_group_filter($(this));" ondblclick="$(this).addClass(\'active\'); $(\'#filter_stage a.active\').edit_filter();" class="list-group-item list-group-item-success" id="'+$.md5(a.id)+'" data-id="'+a.id+'" data-tag="'+a.tag+'" data-storage-id="'+a.storage+'">');t.html('<h4 class="list-group-item-heading">'+a[kAPI_PARAM_RESPONSE_FRMT_NAME]+"</h4>"),void 0!==a[kAPI_PARAM_RESPONSE_FRMT_INFO]&&null!==a[kAPI_PARAM_RESPONSE_FRMT_INFO]&&a[kAPI_PARAM_RESPONSE_FRMT_INFO].length>0&&t.append('<p class="list-group-item-text">'+a[kAPI_PARAM_RESPONSE_FRMT_INFO]+"</p>"),void 0!==a.contains&&null!==a.contains&&""!==a.contains&&t.append('<h4 style="padding-left: 15px;" class="text-muted">'+a.contains+"</h4>"),0===$("#filter_stage").html().length&&($("#filter_stage_panel").fadeIn(300),$("#filter_group_title").text(i18n[lang].messages.add_another_group_field)),$("#filter_stage").append(t)}})):($.remove_storage("pgrdg_cache.search.criteria.grouping._ordering"),$("#summary_order_cancel_btn, #summary_order_reorder_btn").addClass("disabled"),$("#group_by_btn .label-danger").remove())},$.exec_ordering=function(e){var a=[],t={};$.update_ordering_on_the_stage(),$("#summary #summary-body").removeClass("disabled"),$.each(storage.get("pgrdg_cache.search.criteria.grouping._ordering"),function(e,t){a.push(t.id)}),$("#collapsed_group_form").hasClass("in")&&$("#collapsed_group_form").collapse("hide"),t.storage_group="pgrdg_cache.summary",t[kAPI_REQUEST_OPERATION]=kAPI_OP_MATCH_UNITS,t.parameters={},t.parameters[kAPI_REQUEST_LANGUAGE]=lang,t.parameters[kAPI_REQUEST_PARAMETERS]={},t.parameters[kAPI_REQUEST_PARAMETERS][kAPI_PARAM_LOG_REQUEST]=!0,t.parameters[kAPI_REQUEST_PARAMETERS][kAPI_PARAM_CRITERIA]={},"Search"==current_path?(t.parameters[kAPI_REQUEST_PARAMETERS][kAPI_PARAM_CRITERIA][kAPI_PARAM_FULL_TEXT_OFFSET]={},t.parameters[kAPI_REQUEST_PARAMETERS][kAPI_PARAM_CRITERIA][kAPI_PARAM_FULL_TEXT_OFFSET][kAPI_PARAM_INPUT_TYPE]=kAPI_PARAM_INPUT_TEXT,t.parameters[kAPI_REQUEST_PARAMETERS][kAPI_PARAM_CRITERIA][kAPI_PARAM_FULL_TEXT_OFFSET][kAPI_PARAM_PATTERN]=$.trim($("#search_form").val())):$.storage_exists("pgrdg_cache.search.criteria")&&($.storage_exists("pgrdg_cache.search.criteria.selected_forms")&&(t.parameters[kAPI_REQUEST_PARAMETERS][kAPI_PARAM_CRITERIA]=$.get_storage_selected_forms()),$.storage_exists("pgrdg_cache.search.criteria.fulltext")&&(t.parameters[kAPI_REQUEST_PARAMETERS][kAPI_PARAM_CRITERIA][kAPI_PARAM_FULL_TEXT_OFFSET]={},t.parameters[kAPI_REQUEST_PARAMETERS][kAPI_PARAM_CRITERIA][kAPI_PARAM_FULL_TEXT_OFFSET][kAPI_PARAM_INPUT_TYPE]=kAPI_PARAM_INPUT_TEXT,t.parameters[kAPI_REQUEST_PARAMETERS][kAPI_PARAM_CRITERIA][kAPI_PARAM_FULL_TEXT_OFFSET][kAPI_PARAM_PATTERN]=storage.get("pgrdg_cache.search.criteria.fulltext")),$.storage_exists("pgrdg_cache.search.criteria.select_map_area")&&(t.parameters[kAPI_REQUEST_PARAMETERS][kAPI_PARAM_CRITERIA][kAPI_SHAPE_TAG]={},t.parameters[kAPI_REQUEST_PARAMETERS][kAPI_PARAM_CRITERIA][kAPI_SHAPE_TAG][kAPI_PARAM_INPUT_TYPE]=kAPI_PARAM_INPUT_SHAPE,t.parameters[kAPI_REQUEST_PARAMETERS][kAPI_PARAM_CRITERIA][kAPI_SHAPE_TAG][kAPI_PARAM_SHAPE]=storage.get("pgrdg_cache.search.criteria.select_map_area"))),t.parameters[kAPI_REQUEST_PARAMETERS][kAPI_PARAM_GROUP]=a,t.parameters[kAPI_REQUEST_PARAMETERS][kAPI_PARAM_SHAPE_OFFSET]=kTAG_GEO_SHAPE_DISP,$.ask_to_service(t,function(a){if("ok"==a[kAPI_RESPONSE_STATUS][kAPI_STATUS_STATE]&&$.obj_len(a[kAPI_RESPONSE_RESULTS])>0){var t=a;
t.level=0,t.history=[],$("#summary-body").removeClass("disabled"),$("#summary-body .content-body").html(""),$.generate_tree_summaries(t,"",function(e){$("#summary-body .content-body").attr("id",t[kAPI_PARAM_ID]).append(e)}),"function"==jQuery.type(e)&&e.call(this)}else $("#collapsed_group_form").collapse("show"),0===$("#apprise.no-results").length&&apprise(i18n[lang].messages.grouping.no_combination_results.message,{title:i18n[lang].messages.grouping.no_combination_results.title,icon:"fa-bug","class":"no-results",titleClass:"text-warning",fa_icon:"fa-warning"}),$("#summary-body").addClass("disabled")})},$.show_raw_data=function(e,a,t,s,r,i){var n=($.parseJSON($.rawurldecode(t)),{}),_="",l="";(void 0===s||null===s||""===s)&&(s=0),(void 0===r||null===r||""===r)&&(r=50),void 0===i||null===i||""===i?(_=$.md5(a),i={}):$.each($.parseJSON($.rawurldecode(i)),function(e,t){_=$.md5(t[kAPI_PARAM_RESPONSE_FRMT_NAME]+a),l=t[kAPI_PARAM_RESPONSE_FRMT_NAME],void 0!==t.is_patch&&t.is_patch===!0?n={}:(n[e]={},$.each(t,function(a,t){a!==kAPI_PARAM_RESPONSE_FRMT_NAME&&a!==kAPI_PARAM_RESPONSE_FRMT_INFO&&(n[e][a]=t)}))});var o=storage.get("pgrdg_cache.summary."+e),c={};c.storage_group="pgrdg_cache.summary",c[kAPI_REQUEST_OPERATION]=kAPI_OP_MATCH_UNITS,c.parameters={},c.parameters[kAPI_REQUEST_LANGUAGE]=lang,c.parameters[kAPI_REQUEST_PARAMETERS]={},c.parameters[kAPI_REQUEST_PARAMETERS][kAPI_PAGING_LIMIT]=r,c.parameters[kAPI_REQUEST_PARAMETERS][kAPI_PAGING_SKIP]=s,c.parameters[kAPI_REQUEST_PARAMETERS][kAPI_PARAM_LOG_REQUEST]=!0,c.parameters[kAPI_REQUEST_PARAMETERS][kAPI_PARAM_CRITERIA]=o.query.obj[kAPI_REQUEST_PARAMETERS][kAPI_PARAM_CRITERIA],c.parameters[kAPI_REQUEST_PARAMETERS][kAPI_PARAM_DOMAIN]=a,c.parameters[kAPI_REQUEST_PARAMETERS][kAPI_PARAM_SUMMARY]=n,c.parameters[kAPI_REQUEST_PARAMETERS][kAPI_PARAM_DATA]=kAPI_RESULT_ENUM_DATA_COLUMN,$.ask_to_service(c,function(t){$.activate_panel("results",{title:$("#"+e+" .panel-heading span.title").text(),domain:a,res:t})})},$.parse_row_content=function(e){$.cycle_disp=function(e,a){return"string"==$.type(e)?e:e[a]+(void 0!==e[kAPI_PARAM_RESPONSE_FRMT_INFO]?' <a href="javascript:void(0);" class="text-info" data-toggle="popover" data-content="'+$.html_encode(e[kAPI_PARAM_RESPONSE_FRMT_INFO])+'"><span class="fa fa-question-circle"></span></a>':"")},$.call_service=function(e,a){var t=$.parseJSON($.b64_to_utf8(e)),s={};s[kAPI_REQUEST_OPERATION]=t[kAPI_REQUEST_OPERATION],s.parameters={},s.parameters[kAPI_REQUEST_LANGUAGE]=t[kAPI_REQUEST_LANGUAGE],s.parameters[kAPI_REQUEST_PARAMETERS]=t[kAPI_REQUEST_PARAMETERS],$.ask_to_service(s,function(e){$.each(e[kAPI_RESPONSE_RESULTS],function(e,t){var s=$("#"+a).parent();0===s.find("div").length&&(s.append($.parse_row_content(t).replace("<div>",'<div style="display: none;">')),s.find("a").popover({container:"body",placement:"auto",html:"true",trigger:"hover"})),s.find("div").is(":visible")?(s.find("div").slideUp(300),s.find("a > .fa-caret-down").removeClass("fa-caret-down").addClass("fa-caret-right")):(s.find("div").slideDown(300),s.find("a > .fa-caret-right").removeClass("fa-caret-right").addClass("fa-caret-down"))})})};var a,t="",s="",r="",i=!1;return $.each(e,function(e,n){if(void 0===n[kAPI_PARAM_RESPONSE_FRMT_DOCU])switch($.type(n[kAPI_PARAM_RESPONSE_FRMT_DISP])){case"object":t+="<li><b>"+$.cycle_disp(n,kAPI_PARAM_RESPONSE_FRMT_NAME,"label")+"</b>: "+n[kAPI_PARAM_RESPONSE_FRMT_DISP][kAPI_PARAM_RESPONSE_FRMT_DISP];break;case"array":$.each(n[kAPI_PARAM_RESPONSE_FRMT_DISP],function(e,a){"array"==$.type(a)?(s="array",r+=$.parse_row_content(a)):(s="string",r="")}),"string"==s?(t+="<li><b>"+n[kAPI_PARAM_RESPONSE_FRMT_NAME]+"</b>: <ul>",$.each(n[kAPI_PARAM_RESPONSE_FRMT_DISP],function(e,a){t+="<li>"+$.highlight($.cycle_disp(a,kAPI_PARAM_RESPONSE_FRMT_DISP))+"</li>"}),t+="</ul></li>"):t+="<li><b>"+$.cycle_disp(n,kAPI_PARAM_RESPONSE_FRMT_NAME,"label")+"</b>: <ul>"+r+"</ul></li>";break;case"string":if(void 0!==n[kAPI_PARAM_RESPONSE_FRMT_LINK])t+="<li><b>"+$.cycle_disp(n,kAPI_PARAM_RESPONSE_FRMT_NAME,"label")+'</b>: <a target="_blank" href="'+n[kAPI_PARAM_RESPONSE_FRMT_LINK]+'">'+$.highlight(n[kAPI_PARAM_RESPONSE_FRMT_DISP])+"</a></li>";else if(void 0!==n[kAPI_PARAM_RESPONSE_FRMT_DISP])if(void 0!==n.serv){var _=$.uuid();t+="<li><b>"+$.cycle_disp(n,kAPI_PARAM_RESPONSE_FRMT_NAME,"label")+'</b>: &nbsp;<a id="'+_+'" onclick="$.call_service(\''+$.utf8_to_b64(JSON.stringify(n.serv))+"', '"+_+'\')" href="javascript:void(0);"><span class="fa fa-caret-right">&nbsp;'+$.highlight(n[kAPI_PARAM_RESPONSE_FRMT_DISP])+"</a></li>"}else t+="<li><b>"+$.cycle_disp(n,kAPI_PARAM_RESPONSE_FRMT_NAME,"label")+"</b>: "+$.highlight(n[kAPI_PARAM_RESPONSE_FRMT_DISP])+"</li>"}else $.each(n[kAPI_PARAM_RESPONSE_FRMT_DOCU],function(e,a){i=void 0!==a[kAPI_PARAM_RESPONSE_FRMT_DOCU]?!0:!1}),i?(a=$.makeid(),label=void 0!==n[kAPI_PARAM_RESPONSE_FRMT_NAME]?$.cycle_disp(n,kAPI_PARAM_RESPONSE_FRMT_NAME,"label"):$.cycle_disp(n,kAPI_PARAM_RESPONSE_FRMT_DISP,"label"),t+='<li><div class="back_indent"><span class="fa fa-fw fa-caret-right"></span> <a href="javascript:void(0);" data-toggle="collapse" data-target="#'+a+"\" onclick=\"$(this).prev('span').toggleClass('fa-caret-right fa-caret-down');\">"+label+'</a>: <div id="'+a+'" class="collapse">'+$.parse_row_content(n[kAPI_PARAM_RESPONSE_FRMT_DOCU])+"</div></div></li>"):(a=$.makeid(),label=void 0!==n[kAPI_PARAM_RESPONSE_FRMT_NAME]?$.cycle_disp(n,kAPI_PARAM_RESPONSE_FRMT_NAME,"label"):$.cycle_disp(n,kAPI_PARAM_RESPONSE_FRMT_DISP,"label"),t+='<li><span class="fa fa-fw fa-caret-right"></span> <a href="javascript:void(0);" data-toggle="collapse" data-target="#'+a+"\" onclick=\"$(this).prev('span').toggleClass('fa-caret-right fa-caret-down');\">"+label+'</a>: <div id="'+a+'" class="collapse">'+$.parse_row_content(n[kAPI_PARAM_RESPONSE_FRMT_DOCU])+"</div></li>")}),'<div><ul class="list-unstyled fa-ul">'+t+"</ul></div>"},$.show_raw_row_content=function(e,a){objp={},objp.storage_group="pgrdg_cache.results",objp[kAPI_REQUEST_OPERATION]=kAPI_OP_GET_UNIT,objp.parameters={},objp.parameters[kAPI_REQUEST_LANGUAGE]=lang,objp.parameters[kAPI_REQUEST_PARAMETERS]={},objp.parameters[kAPI_REQUEST_PARAMETERS][kAPI_PARAM_LOG_REQUEST]=!0,objp.parameters[kAPI_REQUEST_PARAMETERS][kAPI_PARAM_ID]=a,objp.parameters[kAPI_REQUEST_PARAMETERS][kAPI_PARAM_DATA]=kAPI_RESULT_ENUM_DATA_FORMAT,$.ask_to_service(objp,function(e){$("tr#"+$.md5(a)+" td").html($.parse_row_content(e.results[a])),$("tr#"+$.md5(a)+" a.text-info, tr#"+$.md5(a)+" span.info").popover({container:"body",placement:"auto",html:"true",trigger:"hover"})})},$.show_data_on_map=function(e,a,t,s){var r=$.parseJSON($.rawurldecode(t)),i={},n="",_="",l=storage.get("pgrdg_cache.summary."+e),o=[],c=$.get_current_bbox_pgrdg();void 0===s||null===s||""===s?(n=$.md5(a),s={}):($.each($.parseJSON($.rawurldecode(s)),function(e,t){_=t[kAPI_PARAM_RESPONSE_FRMT_NAME],void 0!==t.is_patch&&t.is_patch===!0?i={}:(i[e]={},$.each(t,function(a,t){a!==kAPI_PARAM_RESPONSE_FRMT_NAME&&a!==kAPI_PARAM_RESPONSE_FRMT_INFO&&(i[e][a]=t)})),n=$.md5(l.query.obj[kAPI_REQUEST_PARAMETERS][kAPI_PARAM_CRITERIA]+a)}),$.obj_len(s)>0&&(s=$.parseJSON($.rawurldecode(s)))),o.push(c);var d={};d.storage_group="pgrdg_cache.map",d[kAPI_REQUEST_OPERATION]=kAPI_OP_MATCH_UNITS,d.parameters={},d.parameters[kAPI_REQUEST_LANGUAGE]=lang,d.parameters[kAPI_REQUEST_PARAMETERS]={},d.parameters[kAPI_REQUEST_PARAMETERS][kAPI_PAGING_LIMIT]=5e3,d.parameters[kAPI_REQUEST_PARAMETERS][kAPI_PARAM_LOG_REQUEST]=!0,d.parameters[kAPI_REQUEST_PARAMETERS][kAPI_PARAM_CRITERIA]=l.query.obj[kAPI_REQUEST_PARAMETERS][kAPI_PARAM_CRITERIA],$.obj_len(r)>0&&(d.parameters[kAPI_REQUEST_PARAMETERS][kAPI_PARAM_CRITERIA][kAPI_SHAPE_TAG]=r),d.parameters[kAPI_REQUEST_PARAMETERS][kAPI_PARAM_DOMAIN]=a,d.parameters[kAPI_REQUEST_PARAMETERS][kAPI_PARAM_SUMMARY]=i,d.parameters[kAPI_REQUEST_PARAMETERS][kAPI_PARAM_DATA]=kAPI_RESULT_ENUM_DATA_MARKER,d.parameters[kAPI_REQUEST_PARAMETERS][kAPI_PARAM_SHAPE_OFFSET]=kTAG_GEO_SHAPE_DISP,$.ask_to_service(d,function(e){if(e[kAPI_RESPONSE_PAGING][kAPI_PAGING_AFFECTED]>0){if(!$.storage_exists("pgrdg_cache.map_data.user_layers.results."+n)){var t={},r={};$.storage_exists("pgrdg_cache.map_data.user_layers.results")&&(t=storage.get("pgrdg_cache.map_data.user_layers.results")),r=storage.get("pgrdg_cache.search.criteria"),r.node=s,t[n]={show:!0,criteria:r,name:_,domain:a,query:d,results:e.results},storage.set("pgrdg_cache.map_data.user_layers.results",t)}if($.activate_panel("map",{res:e.results,id:n,shape:kTAG_GEO_SHAPE_DISP},function(){$.get_generated_layers(n)}),e[kAPI_RESPONSE_PAGING][kAPI_PAGING_AFFECTED]>d.parameters[kAPI_REQUEST_PARAMETERS][kAPI_PAGING_LIMIT]){var i=i18n[lang].messages.map_limit_display.title;i.replace("{N}",d.parameters[kAPI_REQUEST_PARAMETERS][kAPI_PAGING_LIMIT]),i.replace("{TOT}",e[kAPI_RESPONSE_PAGING][kAPI_PAGING_AFFECTED]);var l=i18n[lang].messages.map_limit_display.message;l.replace(/\{X\}/g,d.parameters[kAPI_REQUEST_PARAMETERS][kAPI_PAGING_LIMIT]),setTimeout(function(){apprise(l,{"class":"only_1k",title:i,titleClass:"text-danger",icon:"fa-eye-slash"})},4e3)}}else alert("No results")})},$.paging_btns=function(e,a,t,s,r){var i=Math.ceil(t/s),n=r/s+1,_=r-s,l=r+s,o=(i-1)*s;return $form_group=$('<div class="form-group">'),$first_btn=$('<a href="javascript:void(0);" onclick="$.show_raw_data(\''+e.res.id+"', '"+e.domain+"', '{}', '0', '"+s+'\')" class="btn btn-default-white'+(1==n?" disabled":"")+'" title="First page"><span class="fa fa fa-angle-double-left"></a>'),page_btns='<div class="form-group">',page_btns+='<a href="javascript:void(0);" onclick="$.show_raw_data(\''+e.res.id+"', '"+e.domain+"', '{}', '0', '"+s+'\')" class="btn btn-default-white'+(1==n?" disabled":"")+'" title="First page"><span class="fa fa fa-angle-double-left"></a>',page_btns+="</div>&nbsp;",page_btns+='<div class="form-group">',page_btns+='<div class="input-group">',page_btns+='<span class="input-group-btn"><a href="javascript:void(0);" onclick="$.show_raw_data(\''+e.res.id+"', '"+e.domain+"', '{}', '"+_+"', '"+s+'\')" class="btn btn-default-white'+(1==n?" disabled":"")+'" title="Previous page"><span class="fa fa-angle-left"></a></span>',page_btns+='<span class="input-group-addon">'+i18n[lang].messages.row_data.page+"</span>",page_btns+='<input type="number" min="1" max="'+i+'" class="form-control" style="width: 75px;" placeholder="'+i18n[lang].messages.row_data.current_page+'" value="'+n+'" />',page_btns+='<span class="input-group-addon"> '+i18n[lang].messages.row_data.of_page.replace("{X}",i)+"</span>",page_btns+='<span class="input-group-btn"><a href="javascript:void(0);" onclick="$.show_raw_data(\''+e.res.id+"', '"+e.domain+"', '{}', '"+l+"', '"+s+'\')" class="btn btn-default-white'+(n==i?" disabled":"")+'" title="Nex page"><span class="fa fa-angle-right"></a></span>',page_btns+="</div>",page_btns+="</div>&nbsp;",page_btns+='<div class="btn-group">',page_btns+='<a href="javascript:void(0);" onclick="$.show_raw_data(\''+e.res.id+"', '"+e.domain+"', '{}', '"+o+"', '"+s+'\')" class="btn btn-default-white'+(n==i?" disabled":"")+'" title="Last page"><span class="fa fa-angle-double-right"></a>',page_btns+="</div>",'<form class="form-inline text-center" role="form">'+page_btns+"</form>"},$.cycle_row_data=function(e){var a="";return $.each(e.row_obj,function(t,s){{var r,i,n;$.makeid()}switch(jQuery.isEmptyObject(e.res)?i=t:$.isNumeric(t)&&(i=e.res[kAPI_RESPONSE_RESULTS][kAPI_PARAM_COLLECTION_TAG][e.res[kAPI_RESULTS_DICTIONARY][kAPI_DICTIONARY_TAGS][t]][kTAG_LABEL],n=e.res[kAPI_RESPONSE_RESULTS][kAPI_PARAM_COLLECTION_TAG][e.res[kAPI_RESULTS_DICTIONARY][kAPI_DICTIONARY_TAGS][t]][kTAG_DATA_TYPE]),jQuery.type(s)){case"object":jQuery.isArray(s)?($.each(s,function(e,a){jQuery.type(a)}),a+='<li class="list-group-item"><b>'+i+"</b>: "+s.join(", ")+"</li>"):(r=(n==kTYPE_ENUM||n==kTYPE_SET)&&void 0!==e.res[kAPI_RESPONSE_RESULTS][kAPI_PARAM_COLLECTION_TERM][s]?e.res[kAPI_RESPONSE_RESULTS][kAPI_PARAM_COLLECTION_TERM][s][kTAG_LABEL]:i,1==$.obj_len(s)&&$.each(s,function(e,a){r=e,s=a}),a+='<li class="list-group-item"><span class="fa fa-caret-right fa-fw"></span><a href="javascript:void(0);" data-toggle="collapse" data-target="#'+$.md5(r)+'">View</a><div id="'+$.md5(r)+'" class="collapse"><ul class="list-group">'+$.cycle_row_data({res:e.res,row_obj:s})+"</ul></div></li>");break;case"array":switch(n){case kTYPE_ENUM:case kTYPE_SET:var _=[];$.each(s,function(a,t){void 0!==e.res[kAPI_RESPONSE_RESULTS][kAPI_PARAM_COLLECTION_TERM][t]&&_.push(e.res[kAPI_RESPONSE_RESULTS][kAPI_PARAM_COLLECTION_TERM][t][kTAG_LABEL])}),a+='<li class="list-group-item"><b>'+$.get_tag_label_from_string(e.res,i)+"</b>: "+_.join(", ")+"</li>";break;case kTYPE_STRUCT:1==$.obj_len(s)?$.each(s,function(t,s){$.obj_len(s)>1?a+='<li class="list-group-item"><span class="fa fa-caret-right fa-fw"></span><a href="javascript:void(0);" data-toggle="collapse" data-target="#'+$.md5(r)+'">View</a><div id="'+$.md5(r)+'" class="collapse"><ul class="list-group">'+$.cycle_row_data({res:e.res,row_obj:s})+"</ul></div></li>":$.each(s,function(e,t){a+='<li class="list-group-item"><b>'+i+"</b>: "+t+"</li>"})}):$.each(s,function(t,s){a+='<li class="list-group-item"><span class="fa fa-caret-right fa-fw"></span><a href="javascript:void(0);" data-toggle="collapse" data-target="#'+$.md5(r)+'">View</a><div id="'+$.md5(r)+'" class="collapse"><ul class="list-group">'+$.cycle_row_data({res:e.res,row_obj:s})+"</ul></div></li>"});break;default:a+='<li class="list-group-item"><b>'+$.get_tag_label_from_string(e.res,t)+"</b>: "+s.join(", ")+"</li>"}break;default:switch(n){case kTYPE_ENUM:case kTYPE_SET:s="Domain"==i?e.title:$.get_enum_label_from_string(e.res,s),a+='<li class="list-group-item"><b>'+$.get_tag_label_from_string(e.res,i)+"</b>: "+$.get_enum_label_from_string(e.res,s)+"</li>";break;case kTYPE_STRUCT:break;default:a+='<li class="list-group-item"><b>'+$.get_tag_label_from_string(e.res,t)+"</b>: "+$.get_enum_label_from_string(e.res,s)+"</li>"}}}),a},$.add_input=function(e){e=$.extend({id:$.makeid(),"class":"form-control",placeholder:"Enter value...",type:"text",disabled:!0,return_key:!1},e);var a="",t="";$.each(operators,function(s,r){r.main?(checkbox="",void 0!==r.main&&"string"==r.type&&(r.selected?(r.main&&(t=r.key,selected_label_value=r.label),a+='<li class="'+r.key.replace("$","")+' active"><a href="javascript:void(0);" onclick="$.selected_form_menu(\''+e.id+"', '"+r.key+"','"+r.label+"')\">"+r.label+"</a></li>"):a+='<li class="'+r.key.replace("$","")+'"><a href="javascript:void(0);" onclick="$.selected_form_menu(\''+e.id+"', '"+r.key+"','"+r.label+"')\">"+r.label+"</a></li>")):void 0!==r.label&&(checkbox+='<div class="checkbox"><label title="'+(void 0!==r.title?r.title:"")+'" onclick="$(\'#'+e.id[0]+"_operator_"+r.key.replace("$","")+"').val(($('#"+e.id[0]+"_operator_"+r.key.replace("$","")+"').is(':checked') ? '"+r.key+'\' : \'\'))"><input type="checkbox" id="'+e.id[0]+"_operator_"+r.key.replace("$","")+'" '+(r.selected?'checked="checked"':"")+' title="'+(void 0!==r.title?r.title:"")+'" name="case_sensitive" value="'+r.key+'" /> '+r.label+"</label></div>")});var s=e.return_key?"":'<small class="pull-right help-block"><span class="fa fa-warning"></span> '+i18n[lang].messages.forms.return_btn_disabled+'</small><div class="clearfix"></div>';return'<input type="hidden" name="'+kAPI_PARAM_INPUT_TYPE+'" value="'+kAPI_PARAM_INPUT_STRING+'" /><input id="'+e.id+'_operator_type" type="hidden" name="operator" value="'+t+'" /><div class="input-group"><div class="input-group-btn"><button '+(e.disabled?'disabled="disabled"':" ")+' data-toggle="dropdown" class="btn btn-default-white dropdown-toggle" type="button"><span id="'+e.id+'_operator" class="'+t.replace("$","")+'">'+selected_label_value+'</span> <span class="caret"></span></button><ul class="dropdown-menu">'+a+'</ul></div><input type="'+e.type+'" class="'+e.class+'" id="'+e.id+'" name="stringselect" placeholder="'+e.placeholder+'" value="" '+(e.disabled?'disabled="disabled"':" ")+"/></div>"+s+checkbox},$.add_simple_input=function(e){return e=$.extend({id:$.makeid(),"class":"form-control",placeholder:"Enter value...",type:"text",disabled:!0,return_key:!1},e),'<input type="hidden" name="'+kAPI_PARAM_INPUT_TYPE+'" value="'+kAPI_PARAM_INPUT_DEFAULT+'" /><input type="'+e.type+'" class="'+e.class+'" id="'+e.id+'" name="'+e.id+'" placeholder="'+e.placeholder+'" value="" '+(e.disabled?'disabled="disabled"':" ")+"/>"},$.add_switch=function(e){return e=$.extend({id:$.makeid(),size:"normal","default":"on",on_txt:"True",off_txt:"False",return_key:!1}),'<input type="hidden" name="'+kAPI_PARAM_INPUT_TYPE+'" value="'+kAPI_PARAM_INPUT_DEFAULT+'" /><div class="text-center"><input type="checkbox" class="switch"'+("on"==e.default?' checked="checked"':"")+'data-on-text="'+e.on_txt+'" data-off-text="'+e.off_txt+'" data-size="'+e.size+'" id="'+e.id+'" name="boolean" /></div>'},$.add_range=function(e){e=$.extend({id:[$.makeid(),$.makeid()],"class":["form-control","form-control"],placeholder:[0,0],min:0,max:0,type:"",disabled:!0,return_key:!1},e);var a="",t=e.type==kTYPE_INT||e.type==kTYPE_FLOAT?"number":"text",s=[void 0!==e.placeholder[0]?e.placeholder[0]:0,void 0!==e.placeholder[1]?e.placeholder[1]:0],r=void 0!==e.min?e.min:e.placeholder[0],i=void 0!==e.max?e.max:e.placeholder[1];return $.check_range_value=function(e){var a=e;a.val(""===a.val()?a.attr("placeholder"):a.val())},$.each(operators,function(t,s){s.main&&void 0!==s.main&&"range"==s.type&&(s.selected?(s.main&&(selected_label_key=s.key,selected_label_value=s.label),a+='<li class="'+s.key.replace("$","")+' active"><a href="javascript:void(0);" onclick="$.selected_form_menu(\''+e.id[0]+"', '"+s.key+"','"+s.label+"')\">"+s.label+"</a></li>"):a+='<li class="'+s.key.replace("$","")+'"><a href="javascript:void(0);" onclick="$.selected_form_menu(\''+e.id[0]+"', '"+s.key+"','"+s.label+"')\">"+s.label+"</a></li>")}),'<input type="hidden" name="'+kAPI_PARAM_INPUT_TYPE+'" value="'+kAPI_PARAM_INPUT_RANGE+'" /><div class="input-group"><input id="'+e.id[0]+'_operator_type" type="hidden" name="operator" value="'+selected_label_key+'" /><div class="input-group-btn"><button '+(e.disabled?'disabled="disabled"':" ")+' data-toggle="dropdown" class="btn btn-default-white dropdown-toggle" type="button"><span id="'+e.id[0]+'_operator" class="'+selected_label_key.replace("$","")+'">'+selected_label_value+'</span> <span class="caret"></span></button><ul class="dropdown-menu" id="'+e.id[0]+'_operator_type_ul">'+a+'</ul></div><span class="input-group-addon_white">From</span><input class="'+e.class[0]+'" type="'+t+'" id="'+e.id[0]+'" name="from" min="'+r+'" max="'+i+'" placeholder="'+s[0]+'" value="" '+(e.disabled?'disabled="disabled"':" ")+'/><span class="input-group-addon_white">to</span><input class="'+e.class[1]+'" type="'+t+'" id="'+e.id[1]+'" name="to" min="'+r+'" max="'+i+'" placeholder="'+s[1]+'" value="" '+(e.disabled?'disabled="disabled"':" ")+"/></div>"},$.fn.addCollapsible=function(e,a){e=$.extend({title:"Collapsible panel",icon:"fa fa-search",content:"","class":"",expandable:!0,id:$.makeid()},e),0===$("#accordion").length?$(this).append('<div class="panel-group" id="accordion">'):0===$("#"+e.id).length&&$(".panel-collapse.collapse").collapse("hide");var t;if(t=$(0===$("#"+e.id).length?'<div id="'+e.id+'" class="panel panel-default '+e.class+'">':"#"+e.id),0===$("#"+e.id).length){var s=$('<div class="panel-heading">'),r=$('<h4 class="panel-title row">'),i=$('<div class="col-sm-2 col-md-2 text-right pull-right"></div>'),n=$('<a data-toggle="collapse" data-parent="#accordion" title="'+i18n[lang].interface.open_close_row_content+'" href="#'+e.id+'_collapse"><span class="fa fa-fw fa-sort text-muted"></span></a>'),_=$('<a title="'+i18n[lang].interface.remove_row+'" href="javascript:void(0);" onclick="$.remove_search($(this));"><span class="fa fa-times" style="color: #666;"></span></a>'),l=$('<div class="col-lg-10 pull-left"></div>'),o=$('<span class="'+e.icon+'"></span>'),c=$('<div id="'+e.id+'_collapse" class="panel-collapse collapse in">'),d=$('<div class="panel-body">'+e.content+"</div>");l.html(o),l.append("&nbsp;&nbsp;"+e.title),e.expandable&&l.prepend(n),i.append(_),r.html(l),r.append(i),r.appendTo(s),s.appendTo(t),""!==e.content&&d.appendTo(c),c.appendTo(t),$(this).find("#accordion").append(t),$("#accordion a").tooltip({container:"body"}),$("select.chosen-select").chosen()}else $("#"+e.id+"_collapse > div.panel-body").append(e.content);"function"==jQuery.type(a)&&a.call(this)},$.fn.addChosen=function(e,a,t){e=$.extend({id:$.makeid(),"class":"",placeholder:"Choose...",no_results_text:"",multiple:!1,allow_single_deselect:!0,max_select:1,rtl:0,btn_menu:{},return_key:!1},e);var s='<select id="'+e.id+'" class="chosen-select form-control'+(e.rtl?" chosen-rtl":"")+'" '+(e.multiple?" multiple ":"")+'data-placeholder="'+e.placeholder+'">';$.each(a,function(e,a){s+='<option val="'+a.val+'">'+e+"</option>"}),$(this).append(s),$(this).find(".chosen-select").chosen({id:"content",max_selected_options:e.max_select,allow_single_deselect:e.allow_single_deselect,no_results_text:e.no_results_text}).on("change",function(){"function"==jQuery.type(t)&&t.call(this)})},$.add_chosen=function(e,a){(void 0===a||""===a)&&(a=[{text:"Test",value:"ok"},{text:"Test",value:"jkhsdgf"}]),e=$.extend({id:$.makeid(),"class":"",placeholder:"Choose...",no_results_text:"",multiple:!1,allow_single_deselect:!0,max_select:1,tree_checkbox:!1,rtl:0,btn_menu:{},disabled:!0},e);for(var t='<select id="'+e.id+'" class="chosen-select form-control'+(e.rtl?" chosen-rtl":"")+'" '+(e.multiple?" multiple ":"")+'data-placeholder="'+e.placeholder+'" '+(e.disabled?'disabled="disabled"':" ")+">",s=0;s<a.length;s++)void 0!==a[s].value&&(t+='<option val="'+a[s].value+'">'+a[s].text+"</option>");return t+="</select>"},$.update_chosen=function(){$(this).trigger("chosen:updated")},$.focus_chosen=function(){$(this).trigger("chosen:activate")},$.open_chosen=function(){$(this).trigger("chosen:open")},$.close_chosen=function(){$(this).trigger("chosen:close")},$.create_tree=function(e,a){$.get_node=function(e){if($param=a,$("#node_"+e).hasClass("open"))$("#"+e+"_toggler").find("span").removeClass("fa-caret-down").addClass("fa-caret-right"),$("#node_"+e).slideUp(300).removeClass("open");else if($("#"+e+"_toggler").find("span").removeClass("fa-caret-right").addClass("fa-caret-down"),""===$("#node_"+e).html()){$("#node_"+e).show().html('<span class="fa fa-refresh fa-spin"></span> Acquiring data...');var s={};s.storage_group="pgrdg_cache.local.forms_data",s.loaderType=t.find("a.pull-left, a.pull-right"),s[kAPI_REQUEST_OPERATION]=kAPI_OP_GET_NODE_ENUMERATIONS,s.parameters={},s.parameters[kAPI_REQUEST_LANGUAGE]=lang,s.parameters[kAPI_REQUEST_PARAMETERS]={},s.parameters[kAPI_REQUEST_PARAMETERS][kAPI_PAGING_LIMIT]=300,s.parameters[kAPI_REQUEST_PARAMETERS][kAPI_PARAM_NODE]=parseInt(e),s.parameters[kAPI_REQUEST_PARAMETERS][kAPI_PARAM_REF_COUNT]=kAPI_PARAM_COLLECTION_UNIT,$.ask_to_service(s,function(a){$("#node_"+e).html("").css("display","none"),$.each(a.results,function(a,s){$("#node_"+e).append($.create_tree(s,t)).addClass("open")}),$("#node_"+e).slideDown(300),$.check_treeselect(t)})}else $("#node_"+e).addClass("open").slideDown(300)};var t=a,s=t.attr("id")+"_term",r=t.closest("form"),i=r.closest(".panel-success").prev().attr("id"),n=r.find("input.reference").attr("data-id"),_="",l='<a class="tree-toggler text-muted" onclick="$.get_node(\''+e.node+'\'); return false;" id="'+e.node+'_toggler" href="javascript: void(0);"><span class="fa fa-fw fa-caret-right"></span></a>',o=!1;$.storage_exists("pgrdg_cache.search.criteria.selected_enums."+i)&&(-1!==$.inArray(e.label,storage.get("pgrdg_cache.search.criteria.selected_enums."+i+".label"))?(o=!0,selected_enums=storage.get("pgrdg_cache.search.criteria.selected_enums."+i+".label"),selected_enums_term=storage.get("pgrdg_cache.search.criteria.selected_enums."+i+".term"),r.find("#"+n+"_label").val(selected_enums.join(",")),r.find("#"+n+"_term").val(selected_enums_term.join(",")),r.find("a.treeselect").attr("title",selected_enums.join(", ")).attr("data-title",selected_enums.join(", ")).tooltip(),r.find("a.treeselect > span:first-child").text(selected_enums.length>1?selected_enums.length+" items selected":0===selected_enums.length?"Choose...":selected_enums.join(", "))):o=!1),checkbox='<div class="checkbox">',checkbox+='<a href="javascript: void(0);" class="'+(void 0===e[kAPI_PARAM_RESPONSE_COUNT]||0===e[kAPI_PARAM_RESPONSE_COUNT]?"btn btn-text text-muted disabled":"")+'" value="'+e.term+'" id="'+$.md5(e.term)+'_checkbox" onclick="$.manage_tree_checkbox(\''+$.rawurlencode(JSON.stringify(e))+"', '"+s+"');\">",checkbox+='<span class="fa"><big class="fa fa-fw text-default '+(o?"fa-check-square-o":"fa-square-o")+'"></big></span>{LABEL}</a></div>';var c='<div class="checkbox-inline">';return c+='<a href="javascript: void(0);" class="text-default" data-count="'+e.count+'" data-value="'+e.term+'" id="'+$.md5(e.term)+'_checkbox" onclick="$.manage_tree_checkbox(\''+$.rawurlencode(JSON.stringify(e))+"', '"+s+'\');"><span class="fa"><big class="fa fa-fw '+(o?"fa-check-square-o":"fa-square-o")+'"></big></span> {LABEL}</a></div>',_+=void 0!==e.children&&e.children>0?'<li class="list-group-item">'+l+'<span title="'+$.get_title(e)+'"> '+(void 0!==e.value&&e.value?c.replace("{LABEL}",e.label):'<a class="btn btn-text disabled" href="javascript: void(0);" onclick="$.get_node(\''+e.node+"'); return false;\">"+e.label+"</a>")+'</span><ul id="node_'+e.node+'" style="display: none;" class="tree"></ul></li>':'<li class="" value="'+e.term+'" title="'+$.get_title(e)+'"> '+(void 0!==e.value&&e.value?checkbox.replace("{LABEL}",e.label):'<a class="btn btn-text disabled" href="javascript: void(0);">'+e.label+"</a>")+"</li>"},$.manage_tree_checkbox=function(e){$.iterate_childrens=function(e){{var a,t,s=n.closest("form"),r=s.find("input.reference").attr("data-id");$("#"+r+"_label"),$("#"+r+"_term")}$.storage_exists("pgrdg_cache.search.criteria.selected_enums."+r)?(a=storage.get("pgrdg_cache.search.criteria.selected_enums."+r+".label"),t=storage.get("pgrdg_cache.search.criteria.selected_enums."+r+".term")):(a=[],t=[]),$("#loader").addClass("system").fadeIn(300,function(){var s=e;$.each(s.find("ul li"),function(e,i){var n=$(this);n.find("a.tree-toggler").length>0&&n.find("a.tree-toggler").click(),n.find("span > div > a:not(.disabled) > big").hasClass("fa-square-o")?(a.push(i.label),t.push(i.term),s.addClass("checked").find("big").removeClass("fa-square-o").addClass("fa-check-square-o"),storage.set("pgrdg_cache.search.criteria.selected_enums."+r,{label:a,term:t}),$.iterate_childrens(s.closest("li"))):(a.splice($.inArray(i.label,a),1),t.splice($.inArray(i.term,t),1),storage.set("pgrdg_cache.search.criteria.selected_enums."+r,{label:a,term:t}))}),setTimeout(function(){$("#loader").fadeOut(0).removeClass("system")},1e3)})};var a,t,s=0,r=JSON.parse($.rawurldecode(e)),i=$.md5(r.term),n=$("#"+i+"_checkbox"),_=n.closest("form"),l=_.closest(".panel-success").prev().attr("id"),o=_.find("input.reference").attr("data-id"),c=$("#"+o+"_label"),d=$("#"+o+"_term");$.storage_exists("pgrdg_cache.search.criteria.selected_enums."+l)?(a=storage.get("pgrdg_cache.search.criteria.selected_enums."+l+".label"),t=storage.get("pgrdg_cache.search.criteria.selected_enums."+l+".term")):(a=[],t=[]),n.find("big").hasClass("fa-square-o")?(a.push(r.label),t.push(r.term),n.addClass("checked").find("big").removeClass("fa-square-o").addClass("fa-check-square-o"),$.each(n.closest("li").find("ul > li a > big.fa-check-square-o"),function(){s++}),void 0!==r.node&&0===s&&$.get_node(r.node),storage.set("pgrdg_cache.search.criteria.selected_enums."+l,{label:a,term:t})):(a.splice($.inArray(r.label,a),1),t.splice($.inArray(r.term,t),1),n.removeClass("checked").find("big").removeClass("fa-check-square-o").addClass("fa-square-o"),$.each(n.closest("li").find("ul > li a > big.fa-check-square-o"),function(){s++}),void 0===r.node||0!==s||n.find("big").hasClass("fa-check-square-o")||$.get_node(r.node),storage.set("pgrdg_cache.search.criteria.selected_enums."+l,{label:a,term:t})),c.val(a),d.val(t),_.find("a.treeselect").attr("title",a.join(", ")).attr("data-title",a.join(", ")).tooltip(),_.find("a.treeselect > span:first-child").text(a.length>1?a.length+" items selected":0===a.length?"Choose...":a.join(", "))},$.check_treeselect=function(e){var a=e,t=$("#"+a.find("a.treeselect").attr("id")+"_term").val();if(void 0!==t)for(var s=t.split(","),r=0;r<s.length;r++)$("#"+$.md5(s[r])+"_checkbox").attr("checked",!0)},$.add_multiselect=function(e,a){e=$.extend({id:$.makeid(),"class":"",placeholder:"Choose...",no_results_text:"",multiple:!1,allow_single_deselect:!0,max_select:1,tree_checkbox:!1,rtl:0,btn_menu:{},disabled:!0},e);var t='<a href="javascript: void(0);" class="btn btn-default-white form-control treeselect dropdown-toggle disabled" data-toggle="dropdown" id="'+e.id+'"><span>'+e.placeholder+'</span> <span class="caret"></a><div class="dropdown-menu"></div>';return"function"==jQuery.type(a)&&a.call(this),'<input type="hidden" data-id="'+e.id+'" class="reference" name="'+kAPI_PARAM_INPUT_TYPE+'" value="'+kAPI_PARAM_INPUT_ENUM+'" /><input type="hidden" id="'+e.id+'_label" value="" /><input id="'+e.id+'_term" type="hidden" name="'+kAPI_RESULT_ENUM_TERM+'" value="" />'+t},$.show_summary_directly=function(e){var a=$.parseJSON(e);if("string"==$.type(a))$.generate_static_form(a,null,function(){$.toggle_form_item($("#"+$.md5(a)),a)});else{var t={};t.storage_group="pgrdg_cache.summary",t[kAPI_REQUEST_OPERATION]=kAPI_OP_MATCH_UNITS,t.parameters={},t.parameters[kAPI_REQUEST_LANGUAGE]=lang,t.parameters[kAPI_REQUEST_PARAMETERS]={},t.parameters[kAPI_REQUEST_PARAMETERS][kAPI_PAGING_LIMIT]=300,t.parameters[kAPI_REQUEST_PARAMETERS][kAPI_PARAM_LOG_REQUEST]=!0,t.parameters[kAPI_REQUEST_PARAMETERS][kAPI_PARAM_CRITERIA]=a,t.parameters[kAPI_REQUEST_PARAMETERS][kAPI_PARAM_GROUP]=[],t.parameters[kAPI_REQUEST_PARAMETERS][kAPI_PARAM_SHAPE_OFFSET]=kTAG_GEO_SHAPE_DISP,t.colour=!0,$.ask_to_service(t,function(e){$.obj_len(e[kAPI_RESPONSE_RESULTS])>0||e[kAPI_RESPONSE_RESULTS].length>0?($.activate_panel("summary",{res:e,source:"main"}),$("#breadcrumb").css("display","block"),$("section.container").css("padding-top","55px"),$.breadcrumb_right_buttons(!0)):0===$("#apprise.no-results:visible").length&&apprise(i18n[lang].messages.search.no_search_results.message,{"class":"no-results",title:i18n[lang].messages.search.no_search_results.title,icon:"warning"})})}},$.build_big_buttons_menu=function(){$.iterate_buttons=function(e){$.fn.collapse_submenu=function(){var e=$(this).next();e.is("ul")&&(e.is(":visible")?e.slideUp(300):e.slideDown(300))};var a=$("<div>"),t=$('<ul class="list-unstyled">');return $.each(e.links,function(a,s){var r=$("<li>"),i=$('<span class="fa fa-fw">'),n=$('<span class="fa fa-fw fa-caret-right">');if(void 0!==s.link&&null!==s.link&&""!==e.link&&(_=$("<a>").attr({href:s.link,"class":"btn-link",target:"_blank"}).text(s.name),r.append(i),r.append(_)),$.obj_len(s.childs)>0){var _=$("<a>").attr({href:"javascript:void(0);",onclick:"$(this).collapse_submenu();","class":"btn-link"}).text(s.name),l=$('<ul class="fa-ul" style="display: none;">');r.append(n),r.append(_),$.each(s.childs,function(e,a){$li2=$("<li>"),$searchlink=$("<a>").attr({href:"javascript:void(0);",onclick:"$.show_summary_directly('"+JSON.stringify(a.criteria)+"')","class":"text-info"}).text(a.name),$li2.append($searchlink),l.append($li2)}),r.append(l)}t.append(r)}),a.append(t),a.html()},$.ajax({url:"common/include/conf/advanced_search_buttons.json",DataType:"json",crossDomain:!0,type:"GET",timeout:1e4,success:function(e){storage.set("pgrdg_cache.local.advanced_search_buttons",e.buttons),$.each(e.buttons,function(e,a){if(""!==a.icon){var t=$('<div class="col-xs-12 col-sm-6 col-md-3 col-lg-3 text-center">'),s=$("<a>").attr({href:"javascript: void(0);","class":0===$.obj_len(a.links)?"disabled":""}),r=$('<img class="" src="'+a.icon+'" />'),i=$("<h3>").text(a.name);
s.append(r).append(i),t.append(s),$("#big_buttons").append(t),$("#big_buttons a").popover({placement:"auto",html:!0,trigger:"click",viewport:"body",content:function(){return $.iterate_buttons(a,!0)}})}})}})},$(document).ready(function(){if(window.onhashchange=function(){"#Map"==document.location.hash?($("html, body, #logo").addClass("map"),$("#logo img").attr("src","common/media/svg/bioversity-logo_small_white.svg")):($("html, body, #logo").removeClass("map"),$("#logo img").attr("src","common/media/svg/bioversity-logo_small.svg"))},"Search"==current_path){if($(window).resize(function(){}),$.obj_len(query)>0)if($.storage_exists("pgrdg_cache.search.criteria.grouping._ordering"))$.restore_stage();else if(void 0!==query.groupby){query.groupby.replace(/(\[|\])/g,"").split(",")}else $.search_fulltext(query.q)}else"Advanced_search"==current_path&&($.get_static_forms(),$.restore_form(),$.build_big_buttons_menu());$("button.dropdown-toggle").on("click",function(){$(this).closest(".input-group").hasClass("open")?$(this).closest(".input-group").removeClass("open"):$(this).closest(".input-group").addClass("open")}),$(".panel-body form").submit(!1),$(".panel-body form:submit").attr("disabled","disabled")});