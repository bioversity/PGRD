$.add_flare=function(t){var e=$.extend({padding:[30,160,0,160],width:$(document).width(),height:$(document).height(),bar_color:["steelblue","#aaa"],data:"common/tpl/pages/graph_temp_data/flare.json"},t);$.down=function(t,e){if(t.children&&!this.__transition__){var n=d3.event&&d3.event.altKey?7500:750,a=n/t.children.length,s=o.selectAll(".enter").attr("class","exit");s.selectAll("rect").filter(function(e){return e===t}).style("fill-opacity",1e-6);var d=$.bar(t).attr("transform",$.stack(e)).style("opacity",1);d.select("text").style("fill-opacity",1e-6),d.select("rect").style("fill",l(!0)),r.domain([0,d3.max(t.children,function(t){return t.value})]).nice(),o.selectAll(".x.axis").transition().duration(n).call(c);var u=d.transition().duration(n).delay(function(t,e){return e*a}).attr("transform",function(t,e){return"translate(0,"+i*e*1.2+")"});u.select("text").style("fill-opacity",1),u.select("rect").attr("width",function(t){return r(t.value)}).style("fill",function(t){return l(!!t.children)});var f=s.transition().duration(n).style("opacity",1e-6).remove();f.selectAll("rect").attr("width",function(t){return r(t.value)}),o.select(".background").data([t]).transition().duration(2*n),t.index=e}},$.up=function(t){if(t.parent&&!this.__transition__){var e=d3.event&&d3.event.altKey?7500:750,n=e/t.children.length,a=o.selectAll(".enter").attr("class","exit"),s=$.bar(t.parent).attr("transform",function(t,e){return"translate(0,"+i*e*1.2+")"}).style("opacity",1e-6);s.select("rect").style("fill",function(t){return l(!!t.children)}).filter(function(e){return e===t}).style("fill-opacity",1e-6),r.domain([0,d3.max(t.parent.children,function(t){return t.value})]).nice(),o.selectAll(".x.axis").transition().duration(2*e).call(c);var d=s.transition().duration(2*e).style("opacity",1);d.select("rect").attr("width",function(t){return r(t.value)}).each("end",function(e){e===t&&d3.select(this).style("fill-opacity",null)});var u=a.selectAll("g").transition().duration(e).delay(function(t,e){return e*n}).attr("transform",$.stack(t.index));u.select("text").style("fill-opacity",1e-6),u.select("rect").attr("width",function(t){return r(t.value)}).style("fill",l(!0)),a.transition().duration(2*e).remove(),o.select(".background").data([t.parent]).transition().duration(2*e)}},$.bar=function(t){var e=o.insert("svg:g",".y.axis").attr("class","enter").attr("transform","translate(0,5)").selectAll("g").data(t.children).enter().append("svg:g").style("cursor",function(t){return t.children?"pointer":null});return e.append("svg:text").attr("x",-6).attr("y",i/2).attr("dy",".35em").attr("text-anchor","end").text(function(t){return t.name}),e.append("svg:rect").attr("width",function(t){return r(t.value)}).attr("height",i),e},$.stack=function(t){var e=0;return function(n){var a="translate("+e+","+i*t*1.2+")";return e+=r(n.value),a}};var n=e.padding,a=e.width-e.padding[1]-e.padding[3],r=(e.height-e.padding[0]-e.padding[2],d3.scale.linear().range([0,a])),i=15,l=d3.scale.ordinal().range(e.bar_color),s=d3.layout.partition().value(function(t){return t.size}),c=d3.svg.axis().scale(r).orient("top"),o=d3.select("#chart").append("svg:svg").append("svg:g").attr("transform","translate("+n[3]+","+n[0]+")");o.append("svg:rect").attr("class","svg-rect"),o.append("svg:g").attr("class","x axis"),o.append("svg:g").attr("class","y axis").append("svg:line").attr("y1","100%"),d3.json(e.data,function(t){s.nodes(t),r.domain([0,t.value]).nice(),$.down(t,0)})};