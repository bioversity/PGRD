$.ask_to_service=function(e,a){var t,r,o,n=$.extend({storage_group:"pgrdg_cache.local",loaderType:"external",loaderText:"",kAPI_REQUEST_OPERATION:"",parameters:{kAPI_REQUEST_LANGUAGE:lang,kAPI_REQUEST_PARAMETERS:{kAPI_PAGING_LIMIT:50,kAPI_PARAM_LOG_REQUEST:!0,kAPI_PARAM_TAG:""}}},e),s={};if("string"==typeof e?(t=kAPI_REQUEST_OPERATION+"="+$.utf8_to_b64(e)+"&"+kAPI_REQUEST_LANGUAGE+"="+lang+"&"+kAPI_REQUEST_PARAMETERS+"={}",r=config.service.url+"Service.php?"+kAPI_REQUEST_OPERATION+"="+e+"&"+kAPI_REQUEST_LANGUAGE+"="+lang+"&"+kAPI_REQUEST_PARAMETERS+"={}",o=config.service.url+"Service.php?"+kAPI_REQUEST_OPERATION+" BASE64("+e+") &"+kAPI_REQUEST_LANGUAGE+"="+lang+"&"+kAPI_REQUEST_PARAMETERS+"={}",s[kAPI_REQUEST_OPERATION]=e,s[kAPI_REQUEST_LANGUAGE]=lang,s[kAPI_REQUEST_PARAMETERS]={}):(t=kAPI_REQUEST_OPERATION+"="+$.utf8_to_b64(n[kAPI_REQUEST_OPERATION]+"&"+kAPI_REQUEST_LANGUAGE+"="+n.parameters[kAPI_REQUEST_LANGUAGE]+"&"+kAPI_REQUEST_PARAMETERS+"="+JSON.stringify(n.parameters[kAPI_REQUEST_PARAMETERS])),r=config.service.url+"Service.php?"+kAPI_REQUEST_OPERATION+"="+n[kAPI_REQUEST_OPERATION]+"&"+kAPI_REQUEST_LANGUAGE+"="+n.parameters[kAPI_REQUEST_LANGUAGE]+"&"+kAPI_REQUEST_PARAMETERS+"="+encodeURI(JSON.stringify(n.parameters[kAPI_REQUEST_PARAMETERS])),o=config.service.url+"Service.php?"+kAPI_REQUEST_OPERATION+"= BASE64("+n[kAPI_REQUEST_OPERATION]+"&"+kAPI_REQUEST_LANGUAGE+"="+n.parameters[kAPI_REQUEST_LANGUAGE]+"&"+kAPI_REQUEST_PARAMETERS+"= URL_ENCODED("+JSON.stringify(n.parameters[kAPI_REQUEST_PARAMETERS])+"))",s[kAPI_REQUEST_OPERATION]=n[kAPI_REQUEST_OPERATION],s[kAPI_REQUEST_LANGUAGE]=n.parameters[kAPI_REQUEST_LANGUAGE],s[kAPI_REQUEST_PARAMETERS]=n.parameters[kAPI_REQUEST_PARAMETERS]),$.storage_exists(n.storage_group+"."+$.md5(t))&&""!==n.storage_group){var l=storage.get(n.storage_group+"."+$.md5(t)+".response");"ok"==l[kAPI_RESPONSE_STATUS][kAPI_STATUS_STATE]?(l.id=$.md5(t),l.extra_data=n.extra,l.query={effective:t,nob64:r,verbose:o,obj:s},$("#loader").hide(),a(l)):($("#loader").hide(),config.site.developer_mode&&(alert("There's an error in the response:<br />See the console for more informations"),console.group("The Service has returned an error"),console.warn(t),console.warn(r),console.warn(o),console.warn(s),console.dir(l),console.error(l[kAPI_RESPONSE_STATUS][kAPI_STATUS_STATE]),console.groupEnd()),$("body").bind("keydown","esc",function(){$(".modal").modal("hide")}))}else"pgrdg_cache.local"==n.storage_group||"pgrdg_cache.ask"==n.storage_group?$("#loader").addClass("system"):$("#loader").removeClass("system"),$("#loader").fadeIn(100,function(){if("string"==typeof n.loaderType)$("#marker_content").is(":visible")||!$("#apprise.service_coffee").is(":visible");else{var l=n.loaderType,c=l.html();l.html('<span class="fa fa-fw fa-refresh fa-spin"></span>'+(""!==n.loaderText?n.loaderText:""))}config.site.developer_mode&&(console.log("Fetching:\n",t),console.log("(",r,")")),$.cryptAjax({url:config.site.developer_mode?r:"API/",dataType:"json",crossDomain:!0,type:config.site.developer_mode?"GET":"POST",timeout:6e4,data:{jCryption:$.jCryption.encrypt(t,password),type:"ask_service"},success:function(_){if(_.id=$.md5(t),_.extra_data=n.extra,_.query={effective:t,nob64:r,verbose:o,obj:s},"object"==$.type(_))if("ok"==_[kAPI_RESPONSE_STATUS][kAPI_STATUS_STATE]){if(void 0!==e.colour&&null!==e.colour&&e.colour===!0){var d={r:255,g:0,b:0,a:1},p=0,u=0,g=$.obj_len(_[kAPI_RESPONSE_RESULTS]);i=0,$.each(_[kAPI_RESPONSE_RESULTS],function(e,a){p=Math.round(i/($.obj_len(_[kAPI_RESPONSE_RESULTS])-1)*255),u=Math.round(g/$.obj_len(_[kAPI_RESPONSE_RESULTS])*100),g--,i++,d.g=p,d.b=u,a.colour=$.set_colour({colour:d}),$.storage_exists("pgrdg_cache.search")||storage.set("pgrdg_cache.search",{}),storage.set("pgrdg_cache.search.domain_colours."+e,$.set_colour({colour:d}))})}""!==n.storage_group&&(storage.set(n.storage_group+"."+$.md5(t),{date:{utc:new Date,timestamp:$.now()},query:{effective:t,nob64:r,verbose:o,obj:s},response:_}),config.site.developer_mode&&(console.group('Storage "'+n.storage_group+'" saved...'),console.warn("id: ",$.md5(t)),console.warn(r),console.groupEnd())),"string"==typeof n.loaderType?a(_):(l.html(c),a(_)),$("#loader").hide()}else $("#loader").hide(),config.site.developer_mode&&(console.warn("!!!",r,_),alert("There's an error in the response:<br />See the console for more informations"),console.group("The Service has returned an error"),console.warn(t),console.warn(r),console.warn(o),console.warn(s),console.dir(_),console.error(_[kAPI_RESPONSE_STATUS][kAPI_STATUS_STATE]),console.groupEnd());else console.warn("!!!",r,_),alert("There's an error in the response:<br />See the console for more informations"),console.group("The Service has returned an error"),console.warn(t),console.warn(r),console.warn(o),console.warn(s),console.dir(_),console.groupEnd()},error:function(n,i,l){$("#loader").hide(),$.display_error_msg("There was an error in your request, please try again later"),"timeout"===i?config.site.developer_mode&&console.log("got timeout"):(config.site.developer_mode&&(console.warn("!!!",l),console.group("The Service has returned an error"),console.warn(t),console.warn(r),console.warn(o),console.warn(s),console.warn(l),console.groupEnd()),$("#loader").hide(),$.service_coffee(),setTimeout(function(){$.ask_to_service(e,a)},3e3))}})})},$.ask_cyphered_to_service=function(e,a){var t=$.extend({storage_group:"pgrdg_user_cache.user_data",data:{},type:"",force_renew:!1},e),r=t.storage_group+"."+t.data.user_id;if($.storage_exists(r)&&""!==r&&!t.force_renew){var o={};o[t.data.user_id]=storage.get(r),a(o)}else $.cryptAjax({url:"API/",dataType:"json",crossDomain:!0,type:"POST",timeout:1e5,data:{jCryption:$.jCryption.encrypt(jQuery.param(t.data),password),type:t.type},success:function(e){$.obj_len(e)>0&&"ok"==e[kAPI_RESPONSE_STATUS][kAPI_STATUS_STATE]&&($.storage_exists(r)||storage.set(r,e[kAPI_RESPONSE_RESULTS]),void 0==e[kAPI_RESPONSE_RESULTS]&&(e[kAPI_RESPONSE_RESULTS]=e[kAPI_RESPONSE_STATUS]),a(e[kAPI_RESPONSE_RESULTS]))}})},$.display_error_msg=function(e){$("#apprise").modal("destroy"),apprise(e,{icon:"error"})},$.left_panel=function(e,a,t){(""===a||void 0===a)&&(a=$(window).width()>420?300:$(window).width()),movement=a,a+="px",$("#left_panel").css({width:a});$("#forms-body").css("width");if($(window).width()<420?($("#close_left_panel_btn").show(),$(window).swipe({swipeStatus:function(e,t,r,o){"left"==r&&($("#left_panel").hasClass("visible")&&o>=0&&o<parseInt(a)&&$("#left_panel").css({left:"-"+o+"px"}),$("section #contents").css({left:parseInt($("#left_panel").css("left"))+parseInt(a)+5+"px"})),"right"==r&&(!$("#left_panel").hasClass("visible")&&o>=0&&o<parseInt(a)&&$("#left_panel").css({left:"-"+(parseInt(a)-o)+"px"}),$("section #contents").css({left:parseInt($("#left_panel").css("left"))+parseInt(a)+5+"px"}))},swipeLeft:function(){$.left_panel(parseInt($("#left_panel").css("left"))<=-(parseInt(a)/2)?"close":"open")},swipeRight:function(){$.left_panel(parseInt($("#left_panel").css("left"))>=-(parseInt(a)/2)?"open":"close")},treshold:100})):$("#close_left_panel_btn").hide(),$("#left_panel").hasClass("visible")&&"open"!==e)switch(e){case"close":$(window).width()<420&&($("section #contents").animate({left:"0px"},200,"swing"),$("header").animate({left:0})),$(".olControlZoom, .leaflet-control-zoom").animate({left:"0"},200),$("#left_panel").animate({left:"-"+a},200,"swing",function(){$(this).removeClass("visible"),"function"==typeof t&&t.call(this)}),$("#breadcrumb").animate({"padding-left":"0px"},200).find(".breadcrumb"),"#Map"!==document.location.hash&&($("#breadcrumb").animate({"padding-left":"0px"},200),$("#breadcrumb .breadcrumb").animate({"padding-left":"40px"},200)),$(window).width()>=420?($(".panel_content-head, .panel_content-body:not(#forms-body, #summary-body), .panel_content-footer, #start > div").animate({"padding-left":"15px"},200,function(){"#Map"!==document.location.hash&&($("#left_panel .folder_menu").animate({right:"-165px"},200),$("#start h1[unselectable]").animate({"margin-left":"35px"},200))}),$("#forms-body, #summary-body").animate({"padding-left":"0px"},200)):$(".panel_content-head, .panel_content-body, .panel_content-footer, #start > div").animate({"padding-left":"15px"},200,function(){$("#section #summary .panel_content-body.disabled:before, section #se_p .panel_content-body.disabled:before").css({"margin-left":"-15px","text-indent":"15px"}),"#Map"!==document.location.hash});break;case"is_closed":}else switch(e){case"open":$("#left_panel .folder_menu").animate({right:parseInt(a)-2+"px"},200,function(){$("#forms").animate({left:"0"},200),$("#start > div").css("margin-top").replace("px","")<=120&&$(window).width()>420&&$("#start > div").animate({"padding-top":"80px"},200),$(window).width()>420&&$("#start h1[unselectable]").animate({"margin-left":"7px"},200),$(".olControlZoom, .leaflet-control-zoom").animate({left:a},200),$("#left_panel").animate({left:"0"},200,"easeOutExpo",function(){$(this).addClass("visible"),$(this).find("input[type=search]"),$(window).width()<420?$(this).find("input[type=search]"):$(this).find("input[type=search]").focus(),"function"==typeof t&&t.call(this)}),$("#breadcrumb").animate({"padding-left":a},200).find(".breadcrumb").animate({"padding-left":"15px"},200),$("#contents > .panel_content .panel_content-head, #contents > .panel_content .panel_content-body:not(#forms-body, #summary-body), #contents > .panel_content .panel_content-footer, #start > div").animate({"padding-left":movement+15+"px"},150),$("#forms-body, #summary-body").animate({"padding-left":movement+"px"},200)})}},$.breadcrumb_right_buttons=function(){if($.storage_exists("pgrdg_cache.search.criteria"))if($("#breadcrumb").length>0){if(0===$("#breadcrumb .breadcrumb li.no-divider.pull-right").length){var e=$('<li class="no-divider pull-right">'),a=($('<div class="btn-group">'),$('<a class="btn btn-xs btn-default-grey text-danger" href="javascript: void(0);" onclick="$.clear_history();" title="Reset all search history"><span class="fa fa-fw fa-times text-center text-danger"></span>Reset all searches</a>'));a.appendTo(e),$("#breadcrumb .breadcrumb").append(e)}}else if("Search"==current_path&&$.obj_len(query)>0&&"Advanced_search"!==current_path){var t=$('<div id="breadcrumb" style="position: relative; top: 0; display: block;"></div>'),r=$('<ol class="breadcrumb">'),o=$('<li id="goto_forms_btn"><a href="./Advanced_search#Forms"><span class="text-muted fa fa-tasks"></span><span class="txt">Active form</span></a></li>');o.appendTo(r),r.appendTo(t),$("section.container").prepend(t)}},$.resize_forms_mask=function(){$.each($(".panel-mask"),function(){$(this).css("width",parseInt($(this).closest(".vcenter").find(".panel").css("width"))-1+"px")})},$.manage_url=function(e){$.left_panel_behaviour=function(e){switch(e){case"Forms":$("header.main, section.container, #left_panel").removeClass("map"),$.left_panel("open");break;case"Summary":$("header.main, section.container, #left_panel").removeClass("map"),$.left_panel("open");break;case"Stats":$("header.main, section.container, #left_panel").removeClass("map"),$.left_panel("open");break;case"Results":$("header.main, section.container, #left_panel").removeClass("map"),$.left_panel("close");break;case"Map":$("header").hasClass("map")||$("header.main, section.container, #left_panel").addClass("map"),$.left_panel("close");break;default:$("header.main, section.container, #left_panel").removeClass("map"),$.left_panel("close")}};var a=0;if((void 0===e||null===e||""===e)&&(e=""),$.each($("#contents > div:not(:hidden)"),function(){a++}),e.length>0){if(document.location.hash=e,"none"==$("#breadcrumb #goto_"+e.toLowerCase()+"_btn").css("display")&&$("#breadcrumb #goto_"+e.toLowerCase()+"_btn").fadeIn(300),"Search"==current_path||"Map"==current_path)switch(document.location.hash){case"Summary":$("#results").hide(),$("#map").hide(),$("#pgrdg_map").hide();break;case"Results":$("#summary").hide(),$("#map").hide(),$("#pgrdg_map").hide();break;case"Stats":$("#results").hide(),$("#map").hide(),$("#summary").hide(),$("#map").hide(),$("#pgrdg_map").hide();break;case"Map":$("#results").hide(),$("#summary").hide()}else switch(e.toLowerCase()){case"forms":$.remove_breadcrumb("summary"),$.reset_contents("summary",!0),$.remove_breadcrumb("results"),$.reset_contents("results",!0),$.remove_breadcrumb("map"),$.reset_contents("map",!0);break;case"summary":$.remove_breadcrumb("results"),$.reset_contents("results",!0),$.remove_breadcrumb("map"),$.reset_contents("map",!0)}$.each($("#breadcrumb .breadcrumb li:visible:not(:last-child)"),function(a,t){var r=$(t),o=r.attr("id"),n=o.replace("goto_","").replace("_btn","");if(e.length>0){if($.trim($("#"+o).text())!==e){var s="Return to "+n+" panel";$(this).find("span.txt").html('<a href="javascript:void(0);" onclick="$.manage_url(\''+$.ucfirst(n)+'\');" title="'+s+'">'+$.ucfirst(n)+"</a>").closest("li").removeClass("active")}else $(this).find("span.txt").text(e).closest("li").addClass("active");$("#breadcrumb a").tooltip({container:"body"}),$("#breadcrumb a").bind("click mousedown",function(){$(this).tooltip("hide")})}}),$.left_panel_behaviour(e),"Map"==e?($("#map_toolbox").delay(600).animate({right:"0"},300),$("#contents .panel_content:not(#loader_bg)").hide(),$("#map, #pgrdg_map").fadeIn(300)):"Search"!==current_path&&"Map"!==current_path&&"Map"!==e?e.length>0&&($.each($("#contents > div"),function(){$(this).attr("id")!==e.toLowerCase()&&"loader_bg"!==$(this).attr("id")&&$(this).hide()}),$("#contents #"+e.toLowerCase()+" h1").html().length>0&&$("#contents #"+e.toLowerCase()).fadeIn(300)):("Search"==current_path||"Map"==current_path)&&e.length>0&&($.each($("#se_results > div"),function(){$(this).attr("id")!==e.toLowerCase()&&"loader_bg"!==$(this).attr("id")&&$(this).hide()}),$("#contents #"+e.toLowerCase()+" h1").html().length>0&&$("#contents #"+e.toLowerCase()).fadeIn(300),storage.set("pgrdg_cache.search.criteria.fulltext",$("#search_form").val()))}},$.clear_history=function(){apprise("Are you sure you want to clear all searches?",{title:"Warning",icon:"warning",confirm:!0},function(e){e&&(storage.remove("pgrdg_cache.search.criteria"),"Search"==current_path&&$.obj_len(query)>0?window.location.href="./Search":document.location.reload())})},$.check_version=function(e){$.reset_storage=function(e){storage.remove("pgrdg_cache"),storage.set("pgrdg_cache.version",e)},$.storage_exists("pgrdg_cache.version")?storage.get("pgrdg_cache.version")!==config.site.timestamp&&$.reset_storage(config.site.timestamp):$.reset_storage(config.site.timestamp),"function"==jQuery.type(e)&&e.call(this)},$.check_storage=function(e,a,t){$.operate=function(e){"Advanced_search"==a&&($("#left_panel div.panel-body.autocomplete").addTraitAutocomplete({id:"main_search","class":"",placeholder:e[kAPI_RESPONSE_RESULTS].placeholder,op:operators},"remote",function(){operators=operators}),$.left_panel("check","",function(){$("#forms-body").fadeIn(300)})),("Search"==a||"Advanced_search"==a)&&($("#left_panel div.panel-body:first-child").after('<div class="panel-header"><h1>'+e.results.title+"</h1></div>"),$("#collapsed_group_form .panel .autocomplete").addAutocomplete({id:"filter_search_summary","class":"",placeholder:e[kAPI_RESPONSE_RESULTS].placeholder,op:operators,operator:kAPI_OP_MATCH_TAG_SUMMARY_LABELS},"remote",function(){operators=operators}),$(".collapse").on("shown.bs.collapse",function(){$("input.typeahead").focus()})),"function"==jQuery.type(t)&&t.call(this,system_constants)},"string"==jQuery.type(e)&&(e=new Array(e));for(var r=0;r<e.length;r++){var o=e[r];$.browser_cookie_status()&&($.storage_exists("pgrdg_cache.local."+$.md5(o))?$.get_operators_list(storage.get("pgrdg_cache.local."+$.md5(o)+".response"),function(e){$.operate(e)}):$.ask_to_service(o,function(e){storage.set("pgrdg_cache.local."+$.md5(o),{date:{utc:new Date,timestamp:$.now()},query:o,response:e}),$.get_operators_list(e,function(e){$.operate(e)})}))}},$.storage_exists=function(e){var a=$.array_clean(e.split(".")),t=!0;return t=storage.isSet(a.join("."))?$.is_obj(storage.get(a.join(".")))&&$.obj_len(storage.get(a.join(".")))>0?!0:$.is_array(storage.get(a.join(".")))&&storage.get(a.join(".")).length>0?!0:!1:!1},$.remove_storage=function(e,a){opt={},"string"==typeof e?opt.name=e:opt=e,opt=$.extend({name:"",check:!0},opt),opt.check?$.storage_exists(opt.name)&&(storage.remove(opt.name),"function"==typeof a&&a.call(this)):(storage.remove(opt.name),"function"==typeof a&&a.call(this))},$.show_storage_data=function(e){$.recurse_obj=function(e){var a=$("<div>"),t=$('<ul class="list-unstyled">'),r=$("<li>"),o=$("<p>"),n=$("<hr />");switch($.type(e)){case"object":$.each(e,function(e,a){"object"==$.type(a)?r.append($.recurse_obj(a)):r.html("array"==$.type(a)?a.join(", "):a),r.length>0&&""!==r.html()&&t.append(r)}),a.html(t).append(n);break;case"array":r.html(e.join(", ")),t.append(r),a.append(t);break;default:o.html(e),a.html(o).append(n)}return a.html()},$.storage_exists(e.replace("pgrdg_cache",""))&&($("#saved_history").html(""),$.each(storage.get("pgrdg_cache."+e),function(e,a){$("#saved_history").append("<h4>"+$.ucfirst(e)+"</h4>"+$.recurse_obj(a))}),$("#storage").modal("show"))},$.login=function(){if($("#loader").addClass("decrypt").show(),$("#loginform .input-group").removeClass("has-error"),$("#login-username").val().length>=4&&$("#login-password").val().length>=6){$("#loader").show(),$(".panel-body input, .panel-body label, .panel-body a").attr("disabled",!0);var e={username:$("#login-username").val(),password:$.sha1($("#login-password").val()),remember:$("#login-remember").is(":checked")?1:0};authority="",$.cryptAjax({url:"API/",dataType:"json",crossDomain:!0,type:"POST",timeout:3e4,data:{jCryption:$.jCryption.encrypt(jQuery.param(e),password),type:"login"},success:function(e){$.obj_len(e)>0&&"ok"==e[kAPI_RESPONSE_STATUS][kAPI_STATUS_STATE]&&$.obj_len(e[kAPI_RESPONSE_RESULTS])>0?($.each(e[kAPI_RESPONSE_RESULTS],function(e,a){$.storage_exists("pgrdg_user_cache.user_data.current")&&storage.remove("pgrdg_user_cache.user_data.current"),storage.set("pgrdg_user_cache.user_data.all."+a[kTAG_IDENTIFIER][kAPI_PARAM_RESPONSE_FRMT_DISP],a),storage.set("pgrdg_user_cache.user_data.current."+a[kTAG_IDENTIFIER][kAPI_PARAM_RESPONSE_FRMT_DISP],a)}),storage.set("pgrdg_user_cache.user_activity",[{login:$.now()}]),"Signin"==current_path?window.location.href="./":location.reload()):($("#loader").hide(),$(".panel-body input, .panel-body label, .panel-body a").attr("disabled",!1),$("#login-username").closest("div.input-group").addClass("has-error"),$("#login-password").closest("div.input-group").addClass("has-error"),0==$(".signin > h4.text-danger").length&&$('<h4 class="text-danger"><span class="fa fa-exclamation"></span> '+i18n[lang].messages.login.wrong_data+"</h4>").insertAfter("div.signin > h1"))}})}else $(".panel-body input, .panel-body label, .panel-body a").attr("disabled",!1),$("#loginform .input-group").addClass("has-error"),$("#login-username").focus()},$.logout=function(){$("#loader").addClass("decrypt").show(),$.cryptAjax({url:"API/",dataType:"text",crossDomain:!0,type:"POST",timeout:3e4,data:{jCryption:$.jCryption.encrypt("",password),type:"logout"},success:function(e){"ok"==e&&(storage.remove("pgrdg_user_cache"),$.removeCookie("l"),window.location.href=document.referrer)}})},$.check_logged_user=function(){var e=$.cookie("l"),a="",t=[];void 0!==e&&null!==e&&"null"!==e&&""!==e?($.storage_exists("pgrdg_cache.session."+e)&&(a=storage.get("pgrdg_cache.session."+e+".data"),$.each(a[kTAG_ROLES][kAPI_PARAM_RESPONSE_FRMT_DISP],function(e,a){t.push(e,a.charAt(0))}),$.create_user_menu(a,t)),"Profile"==current_path&&($("#personal_form").html('<span class="fa fa-refresh fa-spin"></span> Waiting...'),$("#personal_form").generate_personal_form(a))):($.removeCookie("l"),$.remove_storage("pgrdg_cache.session"),$("#login_menu_btn").find("span").removeClass("fa-check fa-spin").addClass("fa-sign-in"),"Profile"==current_path&&$("#login").modal("show").on("hidden.bs.modal",function(){void 0===$.cookie("l")&&$("#login").modal("show")})),$("#login_menu_btn").removeClass("disabled")},$.create_user_menu=function(e,a){if(void 0!==e&&null!==e&&""!==e){var t=$("#login_menu_btn").closest("li"),r=[];$.each(roles.dictionary.groups,function(t,o){if(-1!==$.inArray(t,a)){var n=[];$.each(roles[o.label],function(a,t){-1!==$.inArray(a,e.role)&&n.push(t)});{o.label}r.push({gdlabel:{type:o.type,label:o.label,link:o.link,icon:o.icon,order:o.order,separator:o.separator,details:n},order:o.order})}}),r.sort(function(e,a){return e.order-a.order}),t.addClass("btn-group"),t.html('<a id="login_menu_btn" data-toggle="dropdown" href="javascript: void(0);" class="btn btn-link dropdown-toggle"><small class="fa fa-user"></small> '+e[kTAG_ENTITY_FNAME][kAPI_PARAM_RESPONSE_FRMT_DISP]+' <span class="fa fa-caret-down"></span></a>'),0===t.find("ul.dropdown-menu").length&&(t.append('<ul class="dropdown-menu" role="menu">'),t.find("ul").append('<li><a href="./Profile"><span class="fa fa-fw fa-gear"></span> Profile</a></li><li class="divider"></li>'),$.each(r,function(e,a){"static"!==a.gdlabel.type&&(t.find("ul").append('<li><a href="'+a.gdlabel.link+'"><small class="'+a.gdlabel.icon+'"></small> '+a.gdlabel.label+"</a></li>"),a.gdlabel.separator&&t.find("ul").append('<li role="menu" class="divider"></li>'))}),t.find("ul").append('<li class="divider"></li><li><a href="javascript: void(0);" onclick="$.logout();"><small class="fa fa-fw fa-sign-out"></small> Logout</a></li>')),$("#login").modal("hide")}},$.fn.generate_personal_form=function(e){$.fn.add_forms=function(e){if(e=$.extend({form_id:$.makeid(),data:{},tags:[],readonly_tags:[],requested_tags:[],type:"",action:"append"},e),$.recurse_disp=function(e,a){return"object"==$.type(a[e][kAPI_PARAM_RESPONSE_FRMT_DISP])?a[e][kAPI_PARAM_RESPONSE_FRMT_DISP][kAPI_PARAM_RESPONSE_FRMT_DISP]:a[e][kAPI_PARAM_RESPONSE_FRMT_DISP]},$.obj_len(e.data)>0){var a=$("<div>"),t=0;$.each(e.data,function(r){if(-1!==$.inArray(r,e.tags)){t++,1==t&&a.append("<h3>"+e.type+"</h3>");var o=$('<div class="form-group">'),n=$("<label>"),s=$('<div class="col-sm-8">'),i=$.inArray(r,e.requested_tags)<=-1||0===e.requested_tags.length?"":' <span class="text-danger">*</span>';n.append(r!=kTAG_ENTITY_PGP_KEY||""!==e.data[r][kAPI_PARAM_RESPONSE_FRMT_NAME]&&void 0!==e.data[r][kAPI_PARAM_RESPONSE_FRMT_NAME]?e.data[r][kAPI_PARAM_RESPONSE_FRMT_NAME]+i:'<span class="fa fa-lock"></span> '+e.data[r][kAPI_PARAM_RESPONSE_FRMT_NAME].replace("PGP",'<abbr title="Pretty Good Privacy">PGP</abbr>')+i),n.attr("for",$.md5(e.data[r][kAPI_PARAM_RESPONSE_FRMT_NAME])).addClass("col-sm-4 control-label"),n.appendTo(o),s.html($.inArray(r,e.readonly_tags)<=-1||0===e.readonly_tags.length?r!=kTAG_ENTITY_PGP_KEY||""!==e.data[r][kAPI_PARAM_RESPONSE_FRMT_NAME]&&void 0!==e.data[r][kAPI_PARAM_RESPONSE_FRMT_NAME]?'<input type="text" name="'+e.data[r][kAPI_PARAM_RESPONSE_FRMT_NAME]+'" required class="form-control" id="'+$.md5(e.data[r][kAPI_PARAM_RESPONSE_FRMT_NAME])+'" placeholder="'+e.data[r][kAPI_PARAM_RESPONSE_FRMT_NAME]+'" value="'+$.recurse_disp(r,e.data)+'" />':'<textarea name="'+e.data[r][kAPI_PARAM_RESPONSE_FRMT_NAME]+'" required class="form-control" id="'+$.md5(e.data[r][kAPI_PARAM_RESPONSE_FRMT_NAME])+'" placeholder="'+e.data[r][kAPI_PARAM_RESPONSE_FRMT_NAME]+'">'+$.recurse_disp(r,e.data)+"</textarea>":'<p class="form-control-static">'+$.recurse_disp(r,e.data)+"</p>"),s.appendTo(o),o.appendTo(a),a.append(o)}}),"append"==e.action?$(this).append(a):$(this).prepend(a)}else $(this).append('<div class="panel panel-danger">No user data to display</div>')};var a=$.makeid(),t="";console.warn(e),$(this).html(""),$(this).add_forms({form_id:a,data:e,tags:[kTAG_ENTITY_FNAME,kTAG_ENTITY_LNAME,kTAG_ENTITY_EMAIL],requested_tags:[kTAG_ENTITY_FNAME,kTAG_ENTITY_LNAME,kTAG_ENTITY_EMAIL],type:"Personal"}),$(this).add_forms({form_id:a,data:e,tags:[kTAG_ENTITY_AFFILIATION,kTAG_ENTITY_TYPE],readonly_tags:[kTAG_ENTITY_AFFILIATION],type:"Job"}),$(this).add_forms({form_id:a,data:e,tags:[kTAG_RECORD_CREATED,kTAG_RECORD_MODIFIED,kTAG_CONN_USER,kTAG_ENTITY_PGP_FINGERPRINT,kTAG_ENTITY_PGP_KEY],readonly_tags:[kTAG_RECORD_CREATED,kTAG_RECORD_MODIFIED,kTAG_ENTITY_PGP_FINGERPRINT],requested_tags:[kTAG_CONN_USER,kTAG_ENTITY_PGP_FINGERPRINT,kTAG_ENTITY_PGP_KEY],type:"Account"}),$(this).find("input").focus(function(e){t=e.target.value}),$(this).find("input").blur(function(e){e.target.value!==t&&apprise('Do you want to save "'+e.target.value+'"?',{confirm:"true"},function(e){})})},$.get_authority=function(e,a){var t={};t.storage_group="pgrdg_cache.session",t[kAPI_REQUEST_OPERATION]=kAPI_OP_GET_UNIT,t.parameters={},t.parameters[kAPI_REQUEST_LANGUAGE]=lang,t.parameters[kAPI_REQUEST_PARAMETERS]={},t.parameters[kAPI_REQUEST_PARAMETERS][kAPI_PARAM_LOG_REQUEST]=!0,t.parameters[kAPI_REQUEST_PARAMETERS][kAPI_PARAM_ID]=e,t.parameters[kAPI_REQUEST_PARAMETERS][kAPI_PARAM_DATA]=kAPI_RESULT_ENUM_DATA_FORMAT,$.ask_to_service(t,function(e){"ok"==e[kAPI_RESPONSE_STATUS][kAPI_STATUS_STATE]&&$.obj_len(e[kAPI_RESPONSE_RESULTS])>0&&$.each(e[kAPI_RESPONSE_RESULTS],function(e,t){return void 0===t[kTAG_ENTITY_LINK]?t[kTAG_NAME][kAPI_PARAM_RESPONSE_FRMT_DISP]:void a($.linkify(t[kTAG_NAME][kAPI_PARAM_RESPONSE_FRMT_DISP],t[kTAG_ENTITY_LINK][kAPI_PARAM_RESPONSE_FRMT_DISP][0][kAPI_PARAM_RESPONSE_FRMT_DISP]))})})},$.set_colour=function(e,a){var t=$.extend({range:[],colour:{r:252,g:193,b:83}},e),r={};if(void 0===a||null===a?a=1:"random"==a?a="0."+Math.floor(9*Math.random()):a>1?a=1:0>a&&(a=0),"string"==$.type(e))if("random"==e)r={r:Math.floor(256*Math.random()),g:Math.floor(256*Math.random()),b:Math.floor(256*Math.random())};else switch(e){case"white":r={r:255,g:255,b:255};break;case"light-grey":r={r:204,g:204,b:204};break;case"dark-grey":r={r:102,g:102,b:102};break;case"black":r={r:0,g:0,b:0};break;case"red":r={r:255,g:0,b:0};break;case"orange":r={r:255,g:150,b:0};break;case"yellow":r={r:255,g:255,b:0};break;case"green":r={r:0,g:255,b:0};break;case"aqua":r={r:0,g:255,b:255};break;case"blue":r={r:0,g:0,b:255};break;case"turquoise":r={r:150,g:100,b:255};break;case"violet":r={r:150,g:0,b:255};break;case"pink":r={r:255,g:0,b:255};break;case"purple":r={r:255,g:0,b:150};break;case"brown":r={r:150,g:100,b:0};break;case"bio-green":r={r:193,g:216,b:47};break;case"bio-orange":r={r:238,g:170,b:48};break;default:r={r:t.colour.r,g:t.colour.g,b:t.colour.b}}else r={r:t.colour.r,g:t.colour.g,b:t.colour.b};return"rgba("+r.r+", "+r.g+", "+r.b+", "+a+")"},$.get_statistics=function(){$("#se input").focus();var e={};e.storage_group="pgrdg_cache.ask",e.loaderType=$("#statistics_loader"),e.loaderText="Acquiring data...",e[kAPI_REQUEST_OPERATION]=kAPI_OP_LIST_DOMAINS,e.parameters={},e.parameters[kAPI_REQUEST_LANGUAGE]=lang,e.parameters[kAPI_REQUEST_PARAMETERS]={},e.parameters[kAPI_REQUEST_PARAMETERS][kAPI_PARAM_LOG_REQUEST]=!0,e.colour=!0,$.ask_to_service(e,function(e){if("ok"==e[kAPI_RESPONSE_STATUS][kAPI_STATUS_STATE]){var a=e[kAPI_RESPONSE_RESULTS],t=[];$.each(a,function(e,a){t.push(a[kAPI_PARAM_RESPONSE_FRMT_NAME]+": <b>"+$.number(a[kAPI_PARAM_RESPONSE_COUNT])+"</b>")}),$("#statistics_loader").html(t.join("<br />"))}})},$.get_definitions=function(e){return $.storage_exists("pgrdg_cache.local.definitions."+e)?storage.get("pgrdg_cache.local.definitions."+e):void $.cryptAjax({url:"API/",dataType:"json",crossDomain:!0,type:"POST",timeout:1e5,data:{definitions:e,type:"json"},success:function(a){return console.info(a),$.obj_len(a)>0?($.storage_exists("pgrdg_cache.local.definitions."+e)||storage.set(e,a),a):void 0}})},$(document).ready(function(){$.check_version(function(){if($("nav a[title]").tooltip({placement:"bottom",container:"body"}),$("#map_toolbox a, #map_sub_toolbox a").tooltip({placement:"left",container:"body"}).click(function(){$(this).tooltip("hide")}),$.shortcuts(),$("#login").on("shown.bs.modal",function(e){e.preventDefault(),$("#login_btn").removeClass("disabled").attr("disabled",!1),$("#login-username").focus()}),"Search"==current_path&&($.get_statistics(),$.obj_len(query)>0?("none"==$("#breadcrumb").css("display"),$.search_fulltext(query.q)):$.storage_exists("pgrdg_cache.search.criteria.fulltext")&&$("#search_form").val(storage.get("pgrdg_cache.search.criteria.fulltext"))),"Map"==current_path&&($("header").hasClass("map")||$("header").addClass("map"),"none"==$("#breadcrumb").css("display")),("Search"==current_path||"Advanced_search"==current_path||"Map"==current_path)&&(document.location.hash="",window.onhashchange=function(){$.manage_url(document.location.hash.replace("#",""))},$.manage_url(),$.left_panel("open")),("Search"==current_path||"Advanced_search"==current_path)&&($("#search_tips").click(function(){apprise(i18n[lang].interface.search_tips,{tag:"p",title:"Search tips",icon:"fa-keyboard-o",titleClass:"text-info",textOk:i18n[lang].interface.btns.close,okBtnClass:"btn-default-grey",allowExit:!0})}),$.get_operators_list(),config.site.developer_mode)){var e=$('<li class="btn-group">'),a=$('<a class="btn btn-link" data-toggle="dropdown" href="javascript: void(0);"><span class="fa fa-wrench"></span> Developer <span class="caret"></span>'),t=$('<ul role="menu" class="dropdown-menu">');li_divider_dev=$('<li class="divider">'),t.append('<li><a href="javascript: void(0);" onclick="storage.remove(\'pgrdg_cache\'); location.reload();"><span class="fa fa-eraser"></span>&nbsp;Reset storage</a></li>'),t.append('<li class="divider"></li>'),t.append('<li><a href="javascript: void(0);" onclick="load_firebug();"><span class="fa fa-bug"></span>&nbsp;Load Firebug-Lite</a></li>'),e.append(a),e.append(t),$("header #nav.navbar.right .navbar-collapse > ul").append(e)}"Profile"==current_path&&void 0!==$.cookie("l")&&null!==$.cookie("l")&&""!==$.cookie("l"),$.breadcrumb_right_buttons(),"Search"==current_path&&$("#breadcrumb").length>0&&$("#breadcrumb .breadcrumb").prepend('<li id="goto_forms_btn"><a href="./Advanced_search#Forms"><span class="text-muted fa fa-tasks"></span><span class="txt">Forms</span></a></li>')})});