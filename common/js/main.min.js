$.log_activity=function(e){var a=$.extend({action:"",date:$.now(),icon:"",body:""},e);"string"==$.type(e)&&(a.action=e);var t=[],r={};$.storage_exists("pgrdg_user_cache.user_activity")&&(t=storage.get("pgrdg_user_cache.user_activity")),r.action=a.action,r.date=a.date,void 0!==a.icon&&(r.icon=a.icon),void 0!==a.body&&(r.body=a.body),t.push(r),storage.set("pgrdg_user_cache.user_activity",t),$("span.timeago").timeago()},$.unlog_activity=function(e){Array.prototype.remove=function(e){return this.splice(this.indexOf(e),1)},$.storage_exists("pgrdg_user_cache.user_activity."+e)&&(st=storage.get("pgrdg_user_cache.user_activity"),st.remove(e),st.length>0?storage.set("pgrdg_user_cache.user_activity",st):$.remove_storage("pgrdg_user_cache.user_activity"))},$.ask_to_service=function(e,a){var t=$.extend({storage_group:"pgrdg_cache.local",force_renew:!1,loader:!0,loaderType:"external",loaderText:"",kAPI_REQUEST_OPERATION:"",parameters:{kAPI_REQUEST_LANGUAGE:lang,kAPI_REQUEST_PARAMETERS:{kAPI_PAGING_LIMIT:50,kAPI_PARAM_LOG_REQUEST:!0,kAPI_PARAM_TAG:""}}},e);$.execute_query=function(t){if(t.loader)if("string"==typeof t.loaderType)$("#marker_content").is(":visible")||!$("#apprise.service_coffee").is(":visible");else{var n=t.loaderType,c=n.html();n.html('<span class="fa fa-fw fa-refresh fa-spin"></span>'+(""!==t.loaderText?t.loaderText:""))}config.site.developer_mode&&(console.log("Fetching:\n",r),console.log("(",o,")")),$.cryptAjax({url:config.site.developer_mode?o:"API/",dataType:"json",crossDomain:!0,type:config.site.developer_mode?"GET":"POST",timeout:6e4,data:{jCryption:$.jCryption.encrypt(r,password),type:"ask_service"},success:function(d){if(d.id=$.md5(r),d.extra_data=t.extra,d.query={effective:r,nob64:o,verbose:s,obj:l},"object"==$.type(d))if("ok"==d[kAPI_RESPONSE_STATUS][kAPI_STATUS_STATE]){if(void 0!==e.colour&&null!==e.colour&&e.colour===!0){var _={r:255,g:0,b:0,a:1},p=0,u=0,g=$.obj_len(d[kAPI_RESPONSE_RESULTS]);i=0,$.each(d[kAPI_RESPONSE_RESULTS],function(e,a){p=Math.round(i/($.obj_len(d[kAPI_RESPONSE_RESULTS])-1)*255),u=Math.round(g/$.obj_len(d[kAPI_RESPONSE_RESULTS])*100),g--,i++,_.g=p,_.b=u,a.colour=$.set_colour({colour:_}),$.storage_exists("pgrdg_cache.search")||storage.set("pgrdg_cache.search",{}),storage.set("pgrdg_cache.search.domain_colours."+e,$.set_colour({colour:_}))})}""!==t.storage_group&&(storage.set(t.storage_group+"."+$.md5(r),{date:{utc:new Date,timestamp:$.now()},query:{effective:r,nob64:o,verbose:s,obj:l},response:d}),config.site.developer_mode&&(console.group('Storage "'+t.storage_group+'" saved...'),console.warn("id: ",$.md5(r)),console.warn(o),console.groupEnd())),t.loader?("string"==typeof t.loaderType?a(d):(n.html(c),a(d)),$("#loader").hide()):a(d)}else t.loader&&$("#loader").hide(),config.site.developer_mode&&(console.warn("!!!",o,d),alert("There's an error in the response:<br />See the console for more informations"),console.group("The Service has returned an error"),console.warn(r),console.warn(o),console.warn(s),console.warn(l),console.dir(d),console.error(d[kAPI_RESPONSE_STATUS][kAPI_STATUS_STATE]),console.groupEnd());else console.warn("!!!",o,d),alert("There's an error in the response:<br />See the console for more informations"),console.group("The Service has returned an error"),console.warn(r),console.warn(o),console.warn(s),console.warn(l),console.dir(d),console.groupEnd()},error:function(t,n,i){$("#loader").hide(),$.display_error_msg("There was an error in your request, please try again later"),"timeout"===n?config.site.developer_mode&&console.log("got timeout"):(config.site.developer_mode&&(console.warn("!!!",i),console.group("The Service has returned an error"),console.warn(r),console.warn(o),console.warn(s),console.warn(l),console.warn(i),console.groupEnd()),$("#loader").hide(),$.service_coffee(),setTimeout(function(){$.ask_to_service(e,a)},3e3))}})};var r,o,s,n=0,l={};if("string"==typeof e?(r=kAPI_REQUEST_OPERATION+"="+$.utf8_to_b64(e)+"&"+kAPI_REQUEST_LANGUAGE+"="+lang+"&"+kAPI_REQUEST_PARAMETERS+"={}",o=config.service.url+config.service.script+"?"+kAPI_REQUEST_OPERATION+"="+e+"&"+kAPI_REQUEST_LANGUAGE+"="+lang+"&"+kAPI_REQUEST_PARAMETERS+"={}",s=config.service.url+config.service.script+".php?"+kAPI_REQUEST_OPERATION+" BASE64("+e+") &"+kAPI_REQUEST_LANGUAGE+"="+lang+"&"+kAPI_REQUEST_PARAMETERS+"={}",l[kAPI_REQUEST_OPERATION]=e,l[kAPI_REQUEST_LANGUAGE]=lang,l[kAPI_REQUEST_PARAMETERS]={}):(r=kAPI_REQUEST_OPERATION+"="+$.utf8_to_b64(t[kAPI_REQUEST_OPERATION]+"&"+kAPI_REQUEST_LANGUAGE+"="+t.parameters[kAPI_REQUEST_LANGUAGE]+"&"+kAPI_REQUEST_PARAMETERS+"="+JSON.stringify(t.parameters[kAPI_REQUEST_PARAMETERS])),o=config.service.url+config.service.script+".php?"+kAPI_REQUEST_OPERATION+"="+t[kAPI_REQUEST_OPERATION]+"&"+kAPI_REQUEST_LANGUAGE+"="+t.parameters[kAPI_REQUEST_LANGUAGE]+"&"+kAPI_REQUEST_PARAMETERS+"="+encodeURI(JSON.stringify(t.parameters[kAPI_REQUEST_PARAMETERS])),s=config.service.url+config.service.script+".php?"+kAPI_REQUEST_OPERATION+"= BASE64("+t[kAPI_REQUEST_OPERATION]+"&"+kAPI_REQUEST_LANGUAGE+"="+t.parameters[kAPI_REQUEST_LANGUAGE]+"&"+kAPI_REQUEST_PARAMETERS+"= URL_ENCODED("+JSON.stringify(t.parameters[kAPI_REQUEST_PARAMETERS])+"))",l[kAPI_REQUEST_OPERATION]=t[kAPI_REQUEST_OPERATION],l[kAPI_REQUEST_LANGUAGE]=t.parameters[kAPI_REQUEST_LANGUAGE],l[kAPI_REQUEST_PARAMETERS]=t.parameters[kAPI_REQUEST_PARAMETERS]),$.storage_exists(t.storage_group+"."+$.md5(r))&&""!==t.storage_group&&!t.force_renew){var c=storage.get(t.storage_group+"."+$.md5(r)+".response");"ok"==c[kAPI_RESPONSE_STATUS][kAPI_STATUS_STATE]?(c.id=$.md5(r),c.extra_data=t.extra,c.query={effective:r,nob64:o,verbose:s,obj:l},$("#loader").hide(),a(c)):($("#loader").hide(),config.site.developer_mode&&(alert("There's an error in the response:<br />See the console for more informations"),console.group("The Service has returned an error"),console.warn(r),console.warn(o),console.warn(s),console.warn(l),console.dir(c),console.error(c[kAPI_RESPONSE_STATUS][kAPI_STATUS_STATE]),console.groupEnd()),$("body").bind("keydown","esc",function(){$(".modal").modal("hide")}))}else"pgrdg_cache.local"==t.storage_group||"pgrdg_cache.ask"==t.storage_group?$("#loader").addClass("system"):$("#loader").removeClass("system"),n>=t.loader_repeat?$.execute_query(t):t.loader?$("#loader").fadeIn(100,function(){$.execute_query(t),n++}):$.execute_query(t)},$.ask_cyphered_to_service=function(e,a){var t=$.extend({storage_group:"pgrdg_user_cache.user_data",data:{},type:"",timeout:12e4,dataType:"json",force_renew:!1},e),r=t.storage_group+"."+t.data.user_id;if($.storage_exists(r)&&""!==r&&!t.force_renew){var o={};o[t.data.user_id]=storage.get(r),a(o)}else{$.cryptAjax({url:"API/",dataType:t.dataType,crossDomain:!0,type:"POST",timeout:t.timeout,data:{jCryption:$.jCryption.encrypt(jQuery.param(t.data),password),type:t.type},success:function(e){e.responseType="success","json"==t.dataType?$.obj_len(e)>0&&"ok"==e[kAPI_RESPONSE_STATUS][kAPI_STATUS_STATE]&&($.storage_exists(r)||t.force_renew||storage.set(r,e[kAPI_RESPONSE_RESULTS]),void 0===e[kAPI_RESPONSE_RESULTS]&&(e[kAPI_RESPONSE_RESULTS]=e[kAPI_RESPONSE_STATUS]),a(e[kAPI_RESPONSE_RESULTS])):a(e)},error:function(e,t){a(t)}})}},$.display_error_msg=function(e){$("#apprise").modal("destroy"),apprise(e,{icon:"error"})},$.left_panel=function(e,a,t){(""===a||void 0===a)&&(a=$(window).width()>420?300:$(window).width()),movement=a,a+="px",$("#left_panel").css({width:a});$("#forms-body").css("width");if($(window).width()<420?($("#close_left_panel_btn").show(),$(window).swipe({swipeStatus:function(e,t,r,o){"left"==r&&($("#left_panel").hasClass("visible")&&o>=0&&o<parseInt(a)&&$("#left_panel").css({left:"-"+o+"px"}),$("section #contents").css({left:parseInt($("#left_panel").css("left"))+parseInt(a)+5+"px"})),"right"==r&&(!$("#left_panel").hasClass("visible")&&o>=0&&o<parseInt(a)&&$("#left_panel").css({left:"-"+(parseInt(a)-o)+"px"}),$("section #contents").css({left:parseInt($("#left_panel").css("left"))+parseInt(a)+5+"px"}))},swipeLeft:function(){$.left_panel(parseInt($("#left_panel").css("left"))<=-(parseInt(a)/2)?"close":"open")},swipeRight:function(){$.left_panel(parseInt($("#left_panel").css("left"))>=-(parseInt(a)/2)?"open":"close")},treshold:100})):$("#close_left_panel_btn").hide(),$("#left_panel").hasClass("visible")&&"open"!==e)switch(e){case"close":$(window).width()<420&&($("section #contents").animate({left:"0px"},200,"swing"),$("header").animate({left:0})),$(".olControlZoom, .leaflet-control-zoom").animate({left:"0"},200),$("#left_panel").animate({left:"-"+a},200,"swing",function(){$(this).removeClass("visible"),"function"==typeof t&&t.call(this)}),$("#breadcrumb").animate({"padding-left":"0px"},200).find(".breadcrumb"),"#Map"!==document.location.hash&&($("#breadcrumb").animate({"padding-left":"0px"},200),$("#breadcrumb .breadcrumb").animate({"padding-left":"40px"},200)),$(window).width()>=420?($(".panel_content-head, .panel_content-body:not(#forms-body, #summary-body), .panel_content-footer, #start > div").animate({"padding-left":"15px"},200,function(){"#Map"!==document.location.hash&&($("#left_panel .folder_menu").animate({right:"-165px"},200),$("#start h1[unselectable]").animate({"margin-left":"35px"},200))}),$("#forms-body, #summary-body").animate({"padding-left":"0px"},200)):$(".panel_content-head, .panel_content-body, .panel_content-footer, #start > div").animate({"padding-left":"15px"},200,function(){$("#section #summary .panel_content-body.disabled:before, section #se_p .panel_content-body.disabled:before").css({"margin-left":"-15px","text-indent":"15px"}),"#Map"!==document.location.hash});break;case"is_closed":}else switch(e){case"open":$("#left_panel .folder_menu").animate({right:parseInt(a)-2+"px"},200,function(){$("#forms").animate({left:"0"},200),$("#start > div").css("margin-top").replace("px","")<=120&&$(window).width()>420&&$("#start > div").animate({"padding-top":"80px"},200),$(window).width()>420&&$("#start h1[unselectable]").animate({"margin-left":"7px"},200),$(".olControlZoom, .leaflet-control-zoom").animate({left:a},200),$("#left_panel").animate({left:"0"},200,"easeOutExpo",function(){$(this).addClass("visible"),$(this).find("input[type=search]"),$(window).width()<420?$(this).find("input[type=search]"):$(this).find("input[type=search]").focus(),"function"==typeof t&&t.call(this)}),$("#breadcrumb").animate({"padding-left":a},200).find(".breadcrumb").animate({"padding-left":"15px"},200),$("#contents > .panel_content .panel_content-head, #contents > .panel_content .panel_content-body:not(#forms-body, #summary-body), #contents > .panel_content .panel_content-footer, #start > div").animate({"padding-left":movement+15+"px"},150),$("#forms-body, #summary-body").animate({"padding-left":movement+"px"},200)})}},$.breadcrumb_right_buttons=function(e){if((void 0===e||null===e||""===e)&&(e=!1),$.storage_exists("pgrdg_cache.search.criteria")||e)if($("#breadcrumb").length>0){if(0===$("#breadcrumb .breadcrumb li.no-divider.pull-right").length){var a=$('<li class="no-divider pull-right">'),t=($('<div class="btn-group">'),$('<a class="btn btn-xs btn-default-grey text-danger" href="javascript: void(0);" onclick="$.clear_history();" title="'+i18n[lang].messages.reset_all_search_history+'"><span class="fa fa-fw fa-times text-center text-danger"></span>'+i18n[lang].interface.btns.reset_all_searches+"</a>"));t.appendTo(a),$("#breadcrumb .breadcrumb").append(a)}}else if("Search"==current_path&&$.obj_len(query)>0&&"Advanced_search"!==current_path){var r=$('<div id="breadcrumb" style="position: relative; top: 0; display: block;"></div>'),o=$('<ol class="breadcrumb">'),s=$("<a>").attr({href:e?"./Advanced_search#Main":"./Advanced_search#Forms"}).html('<span class="text-muted fa fa-tasks"></span><span class="txt">'+i18n[lang].interface.btns.active_form+"</span>"),n=$('<li id="goto_forms_btn"></li>');n.append(s),n.appendTo(o),o.appendTo(r),$("section.container").prepend(r)}},$.resize_forms_mask=function(){$.each($(".panel-mask"),function(){$(this).css("width",parseInt($(this).closest(".vcenter").find(".panel").css("width"))-1+"px")})},$.manage_url=function(e){var a,t;"object"==$.type(e)?(a=e.hash,t=e.source):(a=e,t=""),$.left_panel_behaviour=function(e){switch(e){case"Forms":case"Main":case"Summary":case"Stats":$("header.main, section.container, #left_panel").removeClass("map"),$.left_panel("open");break;case"Map":$("header").hasClass("map")||$("header.main, section.container, #left_panel").addClass("map"),$.left_panel("close");break;case"Results":$("header.main, section.container, #left_panel").removeClass("map"),$.left_panel("close");break;default:$("header.main, section.container, #left_panel").removeClass("map"),$.left_panel("close")}};var r=0;if((void 0===a||null===a||""===a)&&(a=""),$.each($("#contents > div:not(:hidden)"),function(){r++}),a.length>0){if(document.location.hash=a,"none"==$("#breadcrumb #goto_"+a.toLowerCase()+"_btn").css("display")&&(console.log(t),null!==t&&void 0!==t&&""!==t?($("ol.breadcrumb li").addClass("hidden"),$("#breadcrumb #goto_"+t.toLowerCase()+"_btn").removeClass("hidden")):$("#breadcrumb #goto_"+a.toLowerCase()+"_btn").removeClass("hidden")),$("#"+a.toLowerCase()).removeClass("hidden"),"Search"==current_path||"Map"==current_path)switch(document.location.hash){case"Summary":$("#results").addClass("hidden"),$("#map").addClass("hidden"),$("#pgrdg_map").addClass("hidden");break;case"Results":$("#summary").addClass("hidden"),$("#map").addClass("hidden"),$("#pgrdg_map").addClass("hidden");break;case"Main":$("#forms").addClass("hidden"),$("#results").addClass("hidden"),$("#map").addClass("hidden"),$("#summary").addClass("hidden"),$("#map").addClass("hidden"),$("#pgrdg_map").addClass("hidden");break;case"Stats":$("#results").addClass("hidden"),$("#map").addClass("hidden"),$("#summary").addClass("hidden"),$("#map").addClass("hidden"),$("#pgrdg_map").addClass("hidden");break;case"Map":$("#results").addClass("hidden"),$("#summary").addClass("hidden")}else switch(a.toLowerCase()){case"forms":case"main":$.remove_breadcrumb("summary"),$.reset_contents("summary",!0),$.remove_breadcrumb("results"),$.reset_contents("results",!0),$.remove_breadcrumb("map"),$.reset_contents("map",!0);break;case"summary":$.remove_breadcrumb("results"),$.reset_contents("results",!0),$.remove_breadcrumb("map"),$.reset_contents("map",!0)}if($.each($("#breadcrumb .breadcrumb li:visible:not(:last-child)"),function(e,r){var o=$(r),s=o.attr("id"),n=s.replace("goto_","").replace("_btn",""),i=$.ucfirst(null!==t&&void 0!==t&&""!==t?t:n);a.length>0&&($.trim($("#"+s).text())!==a?($a_bread=$("<a>").attr({href:"javascript:void(0);",onclick:"$.manage_url('"+i+"');",title:i18n[lang].messages.return_to_panel.replace("{X}",n)}).html(i),$(this).find("span.txt").html($a_bread).closest("li").removeClass("active")):$(this).find("span.txt").text(a).closest("li").addClass("active"),$("#breadcrumb a").tooltip({container:"body"}),$("#breadcrumb a").bind("click mousedown",function(){$(this).tooltip("hide")}))}),$.left_panel_behaviour(a),"Map"==a)$("#map_toolbox").delay(600).animate({right:"0"},300),$("#contents .panel_content:not(#loader_bg)").hide(),$("#map, #pgrdg_map").fadeIn(300);else if("Search"!==current_path&&"Map"!==current_path&&"Map"!==a){if(a.length>0){$.each($("#contents > div"),function(){$(this).attr("id")!==a.toLowerCase()&&"loader_bg"!==$(this).attr("id")&&$(this).hide()});var o="main"==a.toLowerCase()?"start":a;$("#contents #"+o.toLowerCase()+" h1").html().length>0&&$("#contents #"+o.toLowerCase()).fadeIn(300)}}else("Search"==current_path||"Map"==current_path)&&a.length>0&&($.each($("#se_results > div"),function(){$(this).attr("id")!==a.toLowerCase()&&"loader_bg"!==$(this).attr("id")&&$(this).hide()}),$("#contents #"+a.toLowerCase()+" h1").html().length>0&&$("#contents #"+a.toLowerCase()).fadeIn(300),storage.set("pgrdg_cache.search.criteria.fulltext",$("#search_form").val()))}},$.clear_history=function(){apprise("Are you sure you want to clear all searches?",{title:"Warning",icon:"warning",confirm:!0},function(e){e&&(storage.remove("pgrdg_cache.search.criteria"),"Search"==current_path&&$.obj_len(query)>0?window.location.href="./Search":document.location.reload())})},$.check_version=function(e){$.reset_storage=function(e){storage.remove("pgrdg_cache"),storage.set("pgrdg_cache.version",e)},$.storage_exists("pgrdg_cache.version")?storage.get("pgrdg_cache.version")!==config.site.timestamp&&$.reset_storage(config.site.timestamp):$.reset_storage(config.site.timestamp),"function"==jQuery.type(e)&&e.call(this)},$.check_storage=function(e,a,t){$.operate=function(e){"Advanced_search"==a&&($("#left_panel div.panel-body.autocomplete").addTraitAutocomplete({id:"main_search","class":"",placeholder:e[kAPI_RESPONSE_RESULTS].placeholder,op:operators},"remote",function(){operators=operators}),$.left_panel("check","",function(){$("#forms-body").fadeIn(300)})),("Search"==a||"Advanced_search"==a)&&($("#left_panel div.panel-body:first-child").after('<div class="panel-header"><h1>'+e.results.title+"</h1></div>"),$("#collapsed_group_form .panel .autocomplete").addAutocomplete({id:"filter_search_summary","class":"",placeholder:e[kAPI_RESPONSE_RESULTS].placeholder,op:operators,operator:kAPI_OP_MATCH_TAG_SUMMARY_LABELS},"remote",function(){operators=operators}),$(".collapse").on("shown.bs.collapse",function(){$("input.typeahead").focus()})),"function"==jQuery.type(t)&&t.call(this,system_constants)},"string"==jQuery.type(e)&&(e=new Array(e));for(var r=0;r<e.length;r++){var o=e[r];$.browser_cookie_status()&&($.storage_exists("pgrdg_cache.local."+$.md5(o))?$.get_operators_list(storage.get("pgrdg_cache.local."+$.md5(o)+".response"),function(e){$.operate(e)}):$.ask_to_service(o,function(e){storage.set("pgrdg_cache.local."+$.md5(o),{date:{utc:new Date,timestamp:$.now()},query:o,response:e}),$.get_operators_list(e,function(e){$.operate(e)})}))}},$.storage_exists=function(e){var a=$.array_clean(e.split(".")),t=!0;return t=storage.isSet(a.join("."))?$.is_obj(storage.get(a.join(".")))&&$.obj_len(storage.get(a.join(".")))>0?!0:$.is_array(storage.get(a.join(".")))&&storage.get(a.join(".")).length>0?!0:!1:!1},$.remove_storage=function(e,a){opt={},"string"==typeof e?opt.name=e:opt=e,opt=$.extend({name:"",check:!0},opt),opt.check?$.storage_exists(opt.name)&&(storage.remove(opt.name),"function"==typeof a&&a.call(this)):(storage.remove(opt.name),"function"==typeof a&&a.call(this))},$.show_storage_data=function(e){$.recurse_obj=function(e){var a=$("<div>"),t=$('<ul class="list-unstyled">'),r=$("<li>"),o=$("<p>"),s=$("<hr />");switch($.type(e)){case"object":$.each(e,function(e,a){"object"==$.type(a)?r.append($.recurse_obj(a)):r.html("array"==$.type(a)?a.join(", "):a),r.length>0&&""!==r.html()&&t.append(r)}),a.html(t).append(s);break;case"array":r.html(e.join(", ")),t.append(r),a.append(t);break;default:o.html(e),a.html(o).append(s)}return a.html()},$.storage_exists(e.replace("pgrdg_cache",""))&&($("#saved_history").html(""),$.each(storage.get("pgrdg_cache."+e),function(e,a){$("#saved_history").append("<h4>"+$.ucfirst(e)+"</h4>"+$.recurse_obj(a))}),$("#storage").modal("show"))},$.login=function(){if($("#login_form .input-group").removeClass("has-error"),$("#login-username").val().length>=4&&$("#login-password").val().length>=6){$("#loader").addClass("decrypt").show(),$("#loader").show(),$(".panel-body input, .panel-body label, .panel-body a").attr("disabled",!0);var e={username:$("#login-username").val(),password:$.sha1($("#login-password").val()),remember:$("#login-remember").is(":checked")?1:0};authority="",$.cryptAjax({url:"API/",dataType:"json",crossDomain:!0,type:"POST",timeout:3e4,data:{jCryption:$.jCryption.encrypt(jQuery.param(e),password),type:"login"},success:function(e){$.obj_len(e)>0&&"ok"==e[kAPI_RESPONSE_STATUS][kAPI_STATUS_STATE]&&$.obj_len(e[kAPI_RESPONSE_RESULTS])>0?($.each(e[kAPI_RESPONSE_RESULTS],function(e,a){$.storage_exists("pgrdg_user_cache.user_data.current")&&storage.remove("pgrdg_user_cache.user_data.current"),storage.set("pgrdg_user_cache.user_data.all."+a[kTAG_IDENTIFIER][kAPI_PARAM_RESPONSE_FRMT_DISP],a),storage.set("pgrdg_user_cache.user_data.current."+a[kTAG_IDENTIFIER][kAPI_PARAM_RESPONSE_FRMT_DISP],a)}),$.log_activity({action:"Logged in",icon:"fa-sign-in"}),"Signin"==current_path?window.location.href="./":location.reload()):($("#loader").hide(),$(".panel-body input, .panel-body label, .panel-body a").attr("disabled",!1),$("#login-username").closest("div.input-group").addClass("has-error"),$("#login-password").closest("div.input-group").addClass("has-error"),0===$(".signin > h4.text-danger").length&&$('<h4 class="text-danger"><span class="fa fa-exclamation"></span> '+i18n[lang].messages.login.wrong_data+"</h4>").insertAfter("div.signin > h1"))}})}else $(".panel-body input, .panel-body label, .panel-body a").attr("disabled",!1),$("#login_form .input-group").addClass("has-error"),$.each($('#login_form input[type="text"], #login_form input[type="password"]'),function(){"hp"!==$(this).attr("name")&&0===$(this).val().length&&$(this).focus()})},$.logout=function(){$("#loader").addClass("decrypt").show(),$.cryptAjax({url:"API/",dataType:"text",crossDomain:!0,type:"POST",timeout:3e4,data:{jCryption:$.jCryption.encrypt("",password),type:"logout"},success:function(e){"ok"==e&&($.log_activity({action:"Logged out",icon:"fa-sign-out"}),storage.remove("pgrdg_user_cache.user_data"),storage.remove("pgrdg_user_cache.user_activity"),$.removeCookie("l"),$.removeCookie("lv"),$.removeCookie("m"),window.location.href=document.referrer)}})},$.check_logged_user=function(){var e=$.cookie("l"),a="",t=[];void 0!==e&&null!==e&&"null"!==e&&""!==e?($.storage_exists("pgrdg_cache.session."+e)&&(a=storage.get("pgrdg_cache.session."+e+".data"),$.each(a[kTAG_ROLES][kAPI_PARAM_RESPONSE_FRMT_DISP],function(e,a){t.push(e,a.charAt(0))}),$.create_user_menu(a,t)),"Profile"==current_path&&($("#personal_form").html('<span class="fa fa-refresh fa-spin"></span> Waiting...'),$("#personal_form").generate_personal_form(a))):($.removeCookie("l"),$.remove_storage("pgrdg_cache.session"),$("#login_menu_btn").find("span").removeClass("fa-check fa-spin").addClass("fa-sign-in"),"Profile"==current_path&&$("#login").modal("show").on("hidden.bs.modal",function(){void 0===$.cookie("l")&&$("#login").modal("show")})),$("#login_menu_btn").removeClass("disabled")},$.create_user_menu=function(e,a){if(void 0!==e&&null!==e&&""!==e){var t=$("#login_menu_btn").closest("li"),r=[];$.each(roles.dictionary.groups,function(t,o){if(-1!==$.inArray(t,a)){var s=[];$.each(roles[o.label],function(a,t){-1!==$.inArray(a,e.role)&&s.push(t)});{o.label}r.push({gdlabel:{type:o.type,label:o.label,link:o.link,icon:o.icon,order:o.order,separator:o.separator,details:s},order:o.order})}}),r.sort(function(e,a){return e.order-a.order}),t.addClass("btn-group"),t.html('<a id="login_menu_btn" data-toggle="dropdown" href="javascript: void(0);" class="btn btn-link dropdown-toggle"><small class="fa fa-user"></small> '+e[kTAG_ENTITY_FNAME][kAPI_PARAM_RESPONSE_FRMT_DISP]+' <span class="fa fa-caret-down"></span></a>'),0===t.find("ul.dropdown-menu").length&&(t.append('<ul class="dropdown-menu" role="menu">'),t.find("ul").append('<li><a href="./Profile"><span class="fa fa-fw fa-gear"></span> Profile</a></li><li class="divider"></li>'),$.each(r,function(e,a){"static"!==a.gdlabel.type&&(t.find("ul").append('<li><a href="'+a.gdlabel.link+'"><small class="'+a.gdlabel.icon+'"></small> '+a.gdlabel.label+"</a></li>"),a.gdlabel.separator&&t.find("ul").append('<li role="menu" class="divider"></li>'))}),t.find("ul").append('<li class="divider"></li><li><a href="javascript: void(0);" onclick="$.logout();"><small class="fa fa-fw fa-sign-out"></small> Logout</a></li>')),$("#login").modal("hide")}},$.fn.generate_personal_form=function(e){$.fn.add_forms=function(e){if(e=$.extend({form_id:$.makeid(),data:{},tags:[],readonly_tags:[],requested_tags:[],type:"",action:"append"},e),$.recurse_disp=function(e,a){return"object"==$.type(a[e][kAPI_PARAM_RESPONSE_FRMT_DISP])?a[e][kAPI_PARAM_RESPONSE_FRMT_DISP][kAPI_PARAM_RESPONSE_FRMT_DISP]:a[e][kAPI_PARAM_RESPONSE_FRMT_DISP]},$.obj_len(e.data)>0){var a=$("<div>"),t=0;$.each(e.data,function(r){if(-1!==$.inArray(r,e.tags)){t++,1==t&&a.append("<h3>"+e.type+"</h3>");var o=$('<div class="form-group">'),s=$("<label>"),n=$('<div class="col-sm-8">'),i=$.inArray(r,e.requested_tags)<=-1||0===e.requested_tags.length?"":' <span class="text-danger">*</span>';s.append(r!=kTAG_ENTITY_PGP_KEY||""!==e.data[r][kAPI_PARAM_RESPONSE_FRMT_NAME]&&void 0!==e.data[r][kAPI_PARAM_RESPONSE_FRMT_NAME]?e.data[r][kAPI_PARAM_RESPONSE_FRMT_NAME]+i:'<span class="fa fa-lock"></span> '+e.data[r][kAPI_PARAM_RESPONSE_FRMT_NAME].replace("PGP",'<abbr title="Pretty Good Privacy">PGP</abbr>')+i),s.attr("for",$.md5(e.data[r][kAPI_PARAM_RESPONSE_FRMT_NAME])).addClass("col-sm-4 control-label"),s.appendTo(o),n.html($.inArray(r,e.readonly_tags)<=-1||0===e.readonly_tags.length?r!=kTAG_ENTITY_PGP_KEY||""!==e.data[r][kAPI_PARAM_RESPONSE_FRMT_NAME]&&void 0!==e.data[r][kAPI_PARAM_RESPONSE_FRMT_NAME]?'<input type="text" name="'+e.data[r][kAPI_PARAM_RESPONSE_FRMT_NAME]+'" required class="form-control" id="'+$.md5(e.data[r][kAPI_PARAM_RESPONSE_FRMT_NAME])+'" placeholder="'+e.data[r][kAPI_PARAM_RESPONSE_FRMT_NAME]+'" value="'+$.recurse_disp(r,e.data)+'" />':'<textarea name="'+e.data[r][kAPI_PARAM_RESPONSE_FRMT_NAME]+'" required class="form-control" id="'+$.md5(e.data[r][kAPI_PARAM_RESPONSE_FRMT_NAME])+'" placeholder="'+e.data[r][kAPI_PARAM_RESPONSE_FRMT_NAME]+'">'+$.recurse_disp(r,e.data)+"</textarea>":'<p class="form-control-static">'+$.recurse_disp(r,e.data)+"</p>"),n.appendTo(o),o.appendTo(a),a.append(o)}}),"append"==e.action?$(this).append(a):$(this).prepend(a)}else $(this).append('<div class="panel panel-danger">No user data to display</div>')};var a=$.makeid(),t="";console.warn(e),$(this).html(""),$(this).add_forms({form_id:a,data:e,tags:[kTAG_ENTITY_FNAME,kTAG_ENTITY_LNAME,kTAG_ENTITY_EMAIL],requested_tags:[kTAG_ENTITY_FNAME,kTAG_ENTITY_LNAME,kTAG_ENTITY_EMAIL],type:"Personal"}),$(this).add_forms({form_id:a,data:e,tags:[kTAG_ENTITY_AFFILIATION,kTAG_ENTITY_TYPE],readonly_tags:[kTAG_ENTITY_AFFILIATION],type:"Job"}),$(this).add_forms({form_id:a,data:e,tags:[kTAG_RECORD_CREATED,kTAG_RECORD_MODIFIED,kTAG_CONN_USER,kTAG_ENTITY_PGP_FINGERPRINT,kTAG_ENTITY_PGP_KEY],readonly_tags:[kTAG_RECORD_CREATED,kTAG_RECORD_MODIFIED,kTAG_ENTITY_PGP_FINGERPRINT],requested_tags:[kTAG_CONN_USER,kTAG_ENTITY_PGP_FINGERPRINT,kTAG_ENTITY_PGP_KEY],type:"Account"}),$(this).find("input").focus(function(e){t=e.target.value}),$(this).find("input").blur(function(e){e.target.value!==t&&apprise('Do you want to save "'+e.target.value+'"?',{confirm:"true"},function(e){})})},$.get_authority=function(e,a){var t={};t.storage_group="pgrdg_cache.session",t[kAPI_REQUEST_OPERATION]=kAPI_OP_GET_UNIT,t.parameters={},t.parameters[kAPI_REQUEST_LANGUAGE]=lang,t.parameters[kAPI_REQUEST_PARAMETERS]={},t.parameters[kAPI_REQUEST_PARAMETERS][kAPI_PARAM_LOG_REQUEST]=!0,t.parameters[kAPI_REQUEST_PARAMETERS][kAPI_PARAM_ID]=e,t.parameters[kAPI_REQUEST_PARAMETERS][kAPI_PARAM_DATA]=kAPI_RESULT_ENUM_DATA_FORMAT,$.ask_to_service(t,function(e){"ok"==e[kAPI_RESPONSE_STATUS][kAPI_STATUS_STATE]&&$.obj_len(e[kAPI_RESPONSE_RESULTS])>0&&$.each(e[kAPI_RESPONSE_RESULTS],function(e,t){return void 0===t[kTAG_ENTITY_LINK]?t[kTAG_NAME][kAPI_PARAM_RESPONSE_FRMT_DISP]:void a($.linkify(t[kTAG_NAME][kAPI_PARAM_RESPONSE_FRMT_DISP],t[kTAG_ENTITY_LINK][kAPI_PARAM_RESPONSE_FRMT_DISP][0][kAPI_PARAM_RESPONSE_FRMT_DISP]))})})},$.fn.check_activation_form_valid=function(){var e=/^(?=.*\d)(?=.*[a-z])(?=.*[A-Z])[0-9a-zA-Z]{8,}$/;e.test($("#np1").val())&&e.test($("#np2").val())?$("#np1").val()===$("#np2").val()?$.trim($("#fname").val()).length>0&&$.trim($("#lname").val()).length>0?($("#fname, #lname").closest(".form-group").removeClass("has-error"),$("#np1, #np2").closest(".input-group").removeClass("has-error"),$("#save_btn").removeClass("disabled"),$("#fname, #lname, #np1, #np2").tooltip("destroy")):(0===$.trim($("#fname").val()).length&&($("#fname").closest(".form-group").addClass("has-error"),$("#fname").tooltip({title:i18n[lang].messages.errors.this_fiels_is_required,placement:"right"}).tooltip("show")),0===$.trim($("#lname").val()).length&&($("#lname").closest(".form-group").addClass("has-error"),$("#lname").tooltip({title:i18n[lang].messages.errors.this_fiels_is_required,placement:"right"}).tooltip("show")),$("#np1, #np2").tooltip("destroy"),$("#save_btn").addClass("disabled")):($("#np1, #np2").tooltip({title:i18n[lang].messages.errors.passwords_do_not_match,placement:"left"}).tooltip("show"),$("#np1, #np2").closest(".input-group").addClass("has-error"),$("#save_btn").addClass("disabled")):($(this).closest(".input-group").addClass("has-error"),$(this).tooltip({title:i18n[lang].messages.errors.invalid_password,placement:"left"}).tooltip("show"))},$.create_user=function(e){var a=$("#user_password").serializeObject(),t={};$.each(e,function(e,r){r[kTAG_ENTITY_FNAME]=a.fname,r[kTAG_ENTITY_LNAME]=a.lname,r[kTAG_CONN_CODE]=a.um,r[kTAG_CONN_PASS]=$.sha1(a.np2),t=r}),$("#loader").show(),$.ask_cyphered_to_service({data:t,type:"create_user",force_renew:!0},function(e){$.obj_len(e)>0&&"ok"==e[kAPI_STATUS_STATE]&&(window.location.href="./Signin")})},$.build_create_user_form=function(e){var a,t,r,o,s,n=e[kAPI_RESPONSE_RESULTS][kAPI_PARAM_COLLECTION_USER];$.each(n,function(e,n){a=n[kTAG_NAME].split(" "),t=e,r=n[kTAG_ENTITY_EMAIL][0][kTAG_TEXT],s=a[a.length-1],o=$.trim(a.join(" ").replace(s,""))}),$("#loader").hide(),$("div.signin h1 > span").text(i18n[lang].messages.new_password).fitText(.8),$("div.signin h1 > small").text(i18n[lang].messages.create_new_password);var i=$("<br />"),l=$("<br />"),c=$("<br />"),d=$("<hr />"),_=$('<div class="text-right">'),p=$("<button>").attr({"class":"btn btn-default-white disabled",id:"save_btn"}).click(function(){$.create_user(n)}).html(i18n[lang].interface.btns.save+' <span class="fa fa-angle-right"></span>'),u=$('<form id="user_password">'),g=$('<div class="input-group">'),m=$('<div class="input-group">'),f=$('<div class="form-group required">'),h=$('<div class="form-group required">'),A=$('<div class="form-group required">'),E=$('<div class="form-group required">'),T=$('<label class="control-label" for="fname">').text(i18n[lang].messages.name),b=$('<label class="control-label" for="lname">').text(i18n[lang].messages.last_name),S=$('<label class="control-label" for="np1">').text(i18n[lang].messages.new_password),P=$('<label class="control-label" for="np2">').text(i18n[lang].messages.repeat_new_password),v=$('<input type="text" name="fname" id="fname" class="form-control" required="required" value="'+o+'">'),R=$('<input type="text" name="lname" id="lname" class="form-control" required="required" value="'+s+'">'),k=$('<input type="hidden" name="uid" value="'+t+'">'),y=$('<input type="hidden" name="um" value="'+r+'">'),I=$('<input type="password" name="np1" id="np1" class="form-control" required="required" size="32" value="qwerty123A">'),w=$('<input type="password" name="np2" id="np2" class="form-control" required="required" size="32" value="qwerty123A">'),N=$('<span class="input-group-addon">'),M=$('<span class="fa fa-lock text-muted">'),O=$('<span class="input-group-addon">'),x=$('<span class="fa fa-lock text-muted">');N.append(M),O.append(x),g.append(k).append(y).append(I).append(N),m.append(w).append(O),f.append(T).append(v),h.append(b).append(R),A.append(S).append(g),E.append(P).append(m),u.append(f).append(i),u.append(h).append(l),u.append(A).append(c),u.append(E),_.append(p),$("#activation_content").html(""),$("#activation_content").append(u).append(d).append(_),$("#fname, #lname, #np1, #np2").on("keyup blur",function(){$(this).check_activation_form_valid()}),$(this).check_activation_form_valid()},$.set_colour=function(e,a){var t=$.extend({range:[],colour:{r:252,g:193,b:83}},e),r={};if(void 0===a||null===a?a=1:"random"==a?a="0."+Math.floor(9*Math.random()):a>1?a=1:0>a&&(a=0),"string"==$.type(e))if("random"==e)r={r:Math.floor(256*Math.random()),g:Math.floor(256*Math.random()),b:Math.floor(256*Math.random())};
else switch(e){case"white":r={r:255,g:255,b:255};break;case"light-grey":r={r:204,g:204,b:204};break;case"dark-grey":r={r:102,g:102,b:102};break;case"black":r={r:0,g:0,b:0};break;case"red":r={r:255,g:0,b:0};break;case"orange":r={r:255,g:150,b:0};break;case"yellow":r={r:255,g:255,b:0};break;case"green":r={r:0,g:255,b:0};break;case"aqua":r={r:0,g:255,b:255};break;case"blue":r={r:0,g:0,b:255};break;case"turquoise":r={r:150,g:100,b:255};break;case"violet":r={r:150,g:0,b:255};break;case"pink":r={r:255,g:0,b:255};break;case"purple":r={r:255,g:0,b:150};break;case"brown":r={r:150,g:100,b:0};break;case"bio-green":r={r:193,g:216,b:47};break;case"bio-orange":r={r:238,g:170,b:48};break;default:r={r:t.colour.r,g:t.colour.g,b:t.colour.b}}else r={r:t.colour.r,g:t.colour.g,b:t.colour.b};return"rgba("+r.r+", "+r.g+", "+r.b+", "+a+")"},$.get_statistics=function(e){$("#se input").focus();var a={};a.storage_group="pgrdg_cache.ask",a.force_renew=!0,a.loader=e,a.loaderType=$("#statistics_loader"),a.loaderText="Acquiring data...",a[kAPI_REQUEST_OPERATION]=kAPI_OP_LIST_DOMAINS,a.parameters={},a.parameters[kAPI_REQUEST_LANGUAGE]=lang,a.parameters[kAPI_REQUEST_PARAMETERS]={},a.parameters[kAPI_REQUEST_PARAMETERS][kAPI_PARAM_LOG_REQUEST]=!0,a.colour=!0,$.ask_to_service(a,function(e){if("ok"==e[kAPI_RESPONSE_STATUS][kAPI_STATUS_STATE]){var a=e[kAPI_RESPONSE_RESULTS],t=[];$.each(a,function(e,a){t.push(a[kAPI_PARAM_RESPONSE_FRMT_NAME]+": <b>"+$.number(a[kAPI_PARAM_RESPONSE_COUNT])+"</b>")}),$("#statistics_loader").html(t.join("<br />")),setTimeout(function(){$.get_statistics(!1)},1e4)}})},$.get_definitions=function(e){return $.storage_exists("pgrdg_cache.local.definitions."+e)?storage.get("pgrdg_cache.local.definitions."+e):void $.cryptAjax({url:"API/",dataType:"json",crossDomain:!0,type:"POST",timeout:1e5,data:{definitions:e,type:"json"},success:function(a){return $.obj_len(a)>0?($.storage_exists("pgrdg_cache.local.definitions."+e)||storage.set(e,a),a):void 0}})},$(document).ready(function(){$.check_version(function(){if($("nav a[title]").tooltip({placement:"bottom",container:"body"}),$("#map_toolbox a, #map_sub_toolbox a").tooltip({placement:"left",container:"body"}).click(function(){$(this).tooltip("hide")}),$.shortcuts(),$("#login").on("shown.bs.modal",function(e){e.preventDefault(),$("#login_btn").removeClass("disabled").attr("disabled",!1),$("#login-username").focus()}),"Search"==current_path&&($.get_statistics(!0),$.obj_len(query)>0?("none"==$("#breadcrumb").css("display"),$.search_fulltext(query.q)):$.storage_exists("pgrdg_cache.search.criteria.fulltext")&&$("#search_form").val(storage.get("pgrdg_cache.search.criteria.fulltext"))),"Map"==current_path&&($("header").hasClass("map")||$("header").addClass("map"),"none"==$("#breadcrumb").css("display")),("Search"==current_path||"Advanced_search"==current_path||"Map"==current_path)&&(document.location.hash="",window.onhashchange=function(){$.manage_url(document.location.hash.replace("#",""))},$.manage_url(),$.left_panel("open")),("Search"==current_path||"Advanced_search"==current_path)&&($("#search_tips").click(function(){apprise(i18n[lang].interface.search_tips,{tag:"p",title:"Search tips",icon:"fa-keyboard-o",titleClass:"text-info",textOk:i18n[lang].interface.btns.close,okBtnClass:"btn-default-grey",allowExit:!0})}),$.get_operators_list(),config.site.developer_mode)){var e=$('<li class="btn-group">'),a=$('<a class="btn btn-link" data-toggle="dropdown" href="javascript: void(0);"><span class="fa fa-wrench"></span> Developer <span class="caret"></span>'),t=$('<ul role="menu" class="dropdown-menu">');li_divider_dev=$('<li class="divider">'),t.append('<li><a href="javascript: void(0);" onclick="storage.remove(\'pgrdg_cache\'); location.reload();"><span class="fa fa-eraser"></span>&nbsp;Reset storage</a></li>'),t.append('<li class="divider"></li>'),t.append('<li><a href="javascript: void(0);" onclick="load_firebug();"><span class="fa fa-bug"></span>&nbsp;Load Firebug-Lite</a></li>'),e.append(a),e.append(t),$("header #nav.navbar.right .navbar-collapse > ul").append(e)}if("Activation"==current_path){var r="fingerprint="+$.rawurlencode($("#f").text());$("#loader").show(),$.cryptAjax({url:"./API/",dataType:"json",crossDomain:!0,type:config.site.developer_mode?"GET":"POST",timeout:3e4,data:{jCryption:$.jCryption.encrypt(r,password),type:"activate_user"},success:function(e){$.build_create_user_form(e)}})}"Profile"==current_path&&void 0!==$.cookie("l")&&null!==$.cookie("l")&&""!==$.cookie("l"),$.breadcrumb_right_buttons(),"Search"==current_path&&$("#breadcrumb").length>0&&$("#breadcrumb .breadcrumb").prepend('<li id="goto_forms_btn"><a href="./Advanced_search#Forms"><span class="text-muted fa fa-tasks"></span><span class="txt">Forms</span></a></li>')})});